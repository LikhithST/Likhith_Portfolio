var _a;
import { B as e, C as t, U as n, _ as r, a as i, b as a, et as o, v as s, z as c } from "./chunk-ABZYJK2D-ODb6qSou.js";
import { g as l, h as u, m as d, p as f } from "./src-D8UWkQNo.js";
import { t as p } from "./channel-D2rbI65H.js";
import "./path-B-GLhb_8.js";
import "./math-O_7OW4FW.js";
import "./array-CopOK-GI.js";
import { c as m, g as h } from "./chunk-S3R3BYOJ-D8yhV3IZ.js";
import "./line-DzDDQdde.js";
import "./chunk-HN2XXSSU-SCO0eetj.js";
import "./chunk-CVBHYZKI-9IS-TY3G.js";
import "./chunk-ATLVNIR6-6j91LnhU.js";
import "./dist-DrVb-WkD.js";
import "./identity-IHMFXfGJ.js";
import "./chunk-JA3XYJ7Z-By1gQAUK.js";
import "./chunk-JZLCHNYA-BantgYUJ.js";
import "./chunk-QXUST7PY-BALPMe08.js";
import { r as g, t as _ } from "./chunk-N4CR4FBY-CKvgw20D.js";
import { t as v } from "./chunk-55IACEB6-D1XFeFgk.js";
import { t as y } from "./chunk-QN33PNHL-BgmhZT4q.js";
var b = (function() {
  var e2 = u(function(e3, t3, n3, r3) {
    for (n3 || (n3 = {}), r3 = e3.length; r3--; n3[e3[r3]] = t3) ;
    return n3;
  }, `o`), t2 = [6, 8, 10, 22, 24, 26, 28, 33, 34, 35, 36, 37, 40, 43, 44, 50], n2 = [1, 10], r2 = [1, 11], i2 = [1, 12], a2 = [1, 13], o2 = [1, 20], s2 = [1, 21], c2 = [1, 22], l2 = [1, 23], d2 = [1, 24], f2 = [1, 19], p2 = [1, 25], m2 = [1, 26], h2 = [1, 18], g2 = [1, 33], _2 = [1, 34], v2 = [1, 35], y2 = [1, 36], b2 = [1, 37], x2 = [6, 8, 10, 13, 15, 17, 20, 21, 22, 24, 26, 28, 33, 34, 35, 36, 37, 40, 43, 44, 50, 63, 64, 65, 66, 67], S2 = [1, 42], C2 = [1, 43], w2 = [1, 52], T2 = [40, 50, 68, 69], E2 = [1, 63], D = [1, 61], O = [1, 58], k = [1, 62], A = [1, 64], j = [6, 8, 10, 13, 17, 22, 24, 26, 28, 33, 34, 35, 36, 37, 40, 41, 42, 43, 44, 48, 49, 50, 63, 64, 65, 66, 67], M = [63, 64, 65, 66, 67], N = [1, 81], P = [1, 80], F = [1, 78], I = [1, 79], L = [6, 10, 42, 47], R = [6, 10, 13, 41, 42, 47, 48, 49], z = [1, 89], B = [1, 88], V = [1, 87], H = [19, 56], U = [1, 98], W = [1, 97], G = [19, 56, 58, 60], K = { trace: u(function() {
  }, `trace`), yy: {}, symbols_: { error: 2, start: 3, ER_DIAGRAM: 4, document: 5, EOF: 6, line: 7, SPACE: 8, statement: 9, NEWLINE: 10, entityName: 11, relSpec: 12, COLON: 13, role: 14, STYLE_SEPARATOR: 15, idList: 16, BLOCK_START: 17, attributes: 18, BLOCK_STOP: 19, SQS: 20, SQE: 21, title: 22, title_value: 23, acc_title: 24, acc_title_value: 25, acc_descr: 26, acc_descr_value: 27, acc_descr_multiline_value: 28, direction: 29, classDefStatement: 30, classStatement: 31, styleStatement: 32, direction_tb: 33, direction_bt: 34, direction_rl: 35, direction_lr: 36, CLASSDEF: 37, stylesOpt: 38, separator: 39, UNICODE_TEXT: 40, STYLE_TEXT: 41, COMMA: 42, CLASS: 43, STYLE: 44, style: 45, styleComponent: 46, SEMI: 47, NUM: 48, BRKT: 49, ENTITY_NAME: 50, attribute: 51, attributeType: 52, attributeName: 53, attributeKeyTypeList: 54, attributeComment: 55, ATTRIBUTE_WORD: 56, attributeKeyType: 57, ",": 58, ATTRIBUTE_KEY: 59, COMMENT: 60, cardinality: 61, relType: 62, ZERO_OR_ONE: 63, ZERO_OR_MORE: 64, ONE_OR_MORE: 65, ONLY_ONE: 66, MD_PARENT: 67, NON_IDENTIFYING: 68, IDENTIFYING: 69, WORD: 70, $accept: 0, $end: 1 }, terminals_: { 2: `error`, 4: `ER_DIAGRAM`, 6: `EOF`, 8: `SPACE`, 10: `NEWLINE`, 13: `COLON`, 15: `STYLE_SEPARATOR`, 17: `BLOCK_START`, 19: `BLOCK_STOP`, 20: `SQS`, 21: `SQE`, 22: `title`, 23: `title_value`, 24: `acc_title`, 25: `acc_title_value`, 26: `acc_descr`, 27: `acc_descr_value`, 28: `acc_descr_multiline_value`, 33: `direction_tb`, 34: `direction_bt`, 35: `direction_rl`, 36: `direction_lr`, 37: `CLASSDEF`, 40: `UNICODE_TEXT`, 41: `STYLE_TEXT`, 42: `COMMA`, 43: `CLASS`, 44: `STYLE`, 47: `SEMI`, 48: `NUM`, 49: `BRKT`, 50: `ENTITY_NAME`, 56: `ATTRIBUTE_WORD`, 58: `,`, 59: `ATTRIBUTE_KEY`, 60: `COMMENT`, 63: `ZERO_OR_ONE`, 64: `ZERO_OR_MORE`, 65: `ONE_OR_MORE`, 66: `ONLY_ONE`, 67: `MD_PARENT`, 68: `NON_IDENTIFYING`, 69: `IDENTIFYING`, 70: `WORD` }, productions_: [0, [3, 3], [5, 0], [5, 2], [7, 2], [7, 1], [7, 1], [7, 1], [9, 5], [9, 9], [9, 7], [9, 7], [9, 4], [9, 6], [9, 3], [9, 5], [9, 1], [9, 3], [9, 7], [9, 9], [9, 6], [9, 8], [9, 4], [9, 6], [9, 2], [9, 2], [9, 2], [9, 1], [9, 1], [9, 1], [9, 1], [9, 1], [29, 1], [29, 1], [29, 1], [29, 1], [30, 4], [16, 1], [16, 1], [16, 3], [16, 3], [31, 3], [32, 4], [38, 1], [38, 3], [45, 1], [45, 2], [39, 1], [39, 1], [39, 1], [46, 1], [46, 1], [46, 1], [46, 1], [11, 1], [11, 1], [18, 1], [18, 2], [51, 2], [51, 3], [51, 3], [51, 4], [52, 1], [53, 1], [54, 1], [54, 3], [57, 1], [55, 1], [12, 3], [61, 1], [61, 1], [61, 1], [61, 1], [61, 1], [62, 1], [62, 1], [14, 1], [14, 1], [14, 1]], performAction: u(function(e3, t3, n3, r3, i3, a3, o3) {
    var s3 = a3.length - 1;
    switch (i3) {
      case 1:
        break;
      case 2:
        this.$ = [];
        break;
      case 3:
        a3[s3 - 1].push(a3[s3]), this.$ = a3[s3 - 1];
        break;
      case 4:
      case 5:
        this.$ = a3[s3];
        break;
      case 6:
      case 7:
        this.$ = [];
        break;
      case 8:
        r3.addEntity(a3[s3 - 4]), r3.addEntity(a3[s3 - 2]), r3.addRelationship(a3[s3 - 4], a3[s3], a3[s3 - 2], a3[s3 - 3]);
        break;
      case 9:
        r3.addEntity(a3[s3 - 8]), r3.addEntity(a3[s3 - 4]), r3.addRelationship(a3[s3 - 8], a3[s3], a3[s3 - 4], a3[s3 - 5]), r3.setClass([a3[s3 - 8]], a3[s3 - 6]), r3.setClass([a3[s3 - 4]], a3[s3 - 2]);
        break;
      case 10:
        r3.addEntity(a3[s3 - 6]), r3.addEntity(a3[s3 - 2]), r3.addRelationship(a3[s3 - 6], a3[s3], a3[s3 - 2], a3[s3 - 3]), r3.setClass([a3[s3 - 6]], a3[s3 - 4]);
        break;
      case 11:
        r3.addEntity(a3[s3 - 6]), r3.addEntity(a3[s3 - 4]), r3.addRelationship(a3[s3 - 6], a3[s3], a3[s3 - 4], a3[s3 - 5]), r3.setClass([a3[s3 - 4]], a3[s3 - 2]);
        break;
      case 12:
        r3.addEntity(a3[s3 - 3]), r3.addAttributes(a3[s3 - 3], a3[s3 - 1]);
        break;
      case 13:
        r3.addEntity(a3[s3 - 5]), r3.addAttributes(a3[s3 - 5], a3[s3 - 1]), r3.setClass([a3[s3 - 5]], a3[s3 - 3]);
        break;
      case 14:
        r3.addEntity(a3[s3 - 2]);
        break;
      case 15:
        r3.addEntity(a3[s3 - 4]), r3.setClass([a3[s3 - 4]], a3[s3 - 2]);
        break;
      case 16:
        r3.addEntity(a3[s3]);
        break;
      case 17:
        r3.addEntity(a3[s3 - 2]), r3.setClass([a3[s3 - 2]], a3[s3]);
        break;
      case 18:
        r3.addEntity(a3[s3 - 6], a3[s3 - 4]), r3.addAttributes(a3[s3 - 6], a3[s3 - 1]);
        break;
      case 19:
        r3.addEntity(a3[s3 - 8], a3[s3 - 6]), r3.addAttributes(a3[s3 - 8], a3[s3 - 1]), r3.setClass([a3[s3 - 8]], a3[s3 - 3]);
        break;
      case 20:
        r3.addEntity(a3[s3 - 5], a3[s3 - 3]);
        break;
      case 21:
        r3.addEntity(a3[s3 - 7], a3[s3 - 5]), r3.setClass([a3[s3 - 7]], a3[s3 - 2]);
        break;
      case 22:
        r3.addEntity(a3[s3 - 3], a3[s3 - 1]);
        break;
      case 23:
        r3.addEntity(a3[s3 - 5], a3[s3 - 3]), r3.setClass([a3[s3 - 5]], a3[s3]);
        break;
      case 24:
      case 25:
        this.$ = a3[s3].trim(), r3.setAccTitle(this.$);
        break;
      case 26:
      case 27:
        this.$ = a3[s3].trim(), r3.setAccDescription(this.$);
        break;
      case 32:
        r3.setDirection(`TB`);
        break;
      case 33:
        r3.setDirection(`BT`);
        break;
      case 34:
        r3.setDirection(`RL`);
        break;
      case 35:
        r3.setDirection(`LR`);
        break;
      case 36:
        this.$ = a3[s3 - 3], r3.addClass(a3[s3 - 2], a3[s3 - 1]);
        break;
      case 37:
      case 38:
      case 56:
      case 64:
        this.$ = [a3[s3]];
        break;
      case 39:
      case 40:
        this.$ = a3[s3 - 2].concat([a3[s3]]);
        break;
      case 41:
        this.$ = a3[s3 - 2], r3.setClass(a3[s3 - 1], a3[s3]);
        break;
      case 42:
        this.$ = a3[s3 - 3], r3.addCssStyles(a3[s3 - 2], a3[s3 - 1]);
        break;
      case 43:
        this.$ = [a3[s3]];
        break;
      case 44:
        a3[s3 - 2].push(a3[s3]), this.$ = a3[s3 - 2];
        break;
      case 46:
        this.$ = a3[s3 - 1] + a3[s3];
        break;
      case 54:
      case 76:
      case 77:
        this.$ = a3[s3].replace(/"/g, ``);
        break;
      case 55:
      case 78:
        this.$ = a3[s3];
        break;
      case 57:
        a3[s3].push(a3[s3 - 1]), this.$ = a3[s3];
        break;
      case 58:
        this.$ = { type: a3[s3 - 1], name: a3[s3] };
        break;
      case 59:
        this.$ = { type: a3[s3 - 2], name: a3[s3 - 1], keys: a3[s3] };
        break;
      case 60:
        this.$ = { type: a3[s3 - 2], name: a3[s3 - 1], comment: a3[s3] };
        break;
      case 61:
        this.$ = { type: a3[s3 - 3], name: a3[s3 - 2], keys: a3[s3 - 1], comment: a3[s3] };
        break;
      case 62:
      case 63:
      case 66:
        this.$ = a3[s3];
        break;
      case 65:
        a3[s3 - 2].push(a3[s3]), this.$ = a3[s3 - 2];
        break;
      case 67:
        this.$ = a3[s3].replace(/"/g, ``);
        break;
      case 68:
        this.$ = { cardA: a3[s3], relType: a3[s3 - 1], cardB: a3[s3 - 2] };
        break;
      case 69:
        this.$ = r3.Cardinality.ZERO_OR_ONE;
        break;
      case 70:
        this.$ = r3.Cardinality.ZERO_OR_MORE;
        break;
      case 71:
        this.$ = r3.Cardinality.ONE_OR_MORE;
        break;
      case 72:
        this.$ = r3.Cardinality.ONLY_ONE;
        break;
      case 73:
        this.$ = r3.Cardinality.MD_PARENT;
        break;
      case 74:
        this.$ = r3.Identification.NON_IDENTIFYING;
        break;
      case 75:
        this.$ = r3.Identification.IDENTIFYING;
        break;
    }
  }, `anonymous`), table: [{ 3: 1, 4: [1, 2] }, { 1: [3] }, e2(t2, [2, 2], { 5: 3 }), { 6: [1, 4], 7: 5, 8: [1, 6], 9: 7, 10: [1, 8], 11: 9, 22: n2, 24: r2, 26: i2, 28: a2, 29: 14, 30: 15, 31: 16, 32: 17, 33: o2, 34: s2, 35: c2, 36: l2, 37: d2, 40: f2, 43: p2, 44: m2, 50: h2 }, e2(t2, [2, 7], { 1: [2, 1] }), e2(t2, [2, 3]), { 9: 27, 11: 9, 22: n2, 24: r2, 26: i2, 28: a2, 29: 14, 30: 15, 31: 16, 32: 17, 33: o2, 34: s2, 35: c2, 36: l2, 37: d2, 40: f2, 43: p2, 44: m2, 50: h2 }, e2(t2, [2, 5]), e2(t2, [2, 6]), e2(t2, [2, 16], { 12: 28, 61: 32, 15: [1, 29], 17: [1, 30], 20: [1, 31], 63: g2, 64: _2, 65: v2, 66: y2, 67: b2 }), { 23: [1, 38] }, { 25: [1, 39] }, { 27: [1, 40] }, e2(t2, [2, 27]), e2(t2, [2, 28]), e2(t2, [2, 29]), e2(t2, [2, 30]), e2(t2, [2, 31]), e2(x2, [2, 54]), e2(x2, [2, 55]), e2(t2, [2, 32]), e2(t2, [2, 33]), e2(t2, [2, 34]), e2(t2, [2, 35]), { 16: 41, 40: S2, 41: C2 }, { 16: 44, 40: S2, 41: C2 }, { 16: 45, 40: S2, 41: C2 }, e2(t2, [2, 4]), { 11: 46, 40: f2, 50: h2 }, { 16: 47, 40: S2, 41: C2 }, { 18: 48, 19: [1, 49], 51: 50, 52: 51, 56: w2 }, { 11: 53, 40: f2, 50: h2 }, { 62: 54, 68: [1, 55], 69: [1, 56] }, e2(T2, [2, 69]), e2(T2, [2, 70]), e2(T2, [2, 71]), e2(T2, [2, 72]), e2(T2, [2, 73]), e2(t2, [2, 24]), e2(t2, [2, 25]), e2(t2, [2, 26]), { 13: E2, 38: 57, 41: D, 42: O, 45: 59, 46: 60, 48: k, 49: A }, e2(j, [2, 37]), e2(j, [2, 38]), { 16: 65, 40: S2, 41: C2, 42: O }, { 13: E2, 38: 66, 41: D, 42: O, 45: 59, 46: 60, 48: k, 49: A }, { 13: [1, 67], 15: [1, 68] }, e2(t2, [2, 17], { 61: 32, 12: 69, 17: [1, 70], 42: O, 63: g2, 64: _2, 65: v2, 66: y2, 67: b2 }), { 19: [1, 71] }, e2(t2, [2, 14]), { 18: 72, 19: [2, 56], 51: 50, 52: 51, 56: w2 }, { 53: 73, 56: [1, 74] }, { 56: [2, 62] }, { 21: [1, 75] }, { 61: 76, 63: g2, 64: _2, 65: v2, 66: y2, 67: b2 }, e2(M, [2, 74]), e2(M, [2, 75]), { 6: N, 10: P, 39: 77, 42: F, 47: I }, { 40: [1, 82], 41: [1, 83] }, e2(L, [2, 43], { 46: 84, 13: E2, 41: D, 48: k, 49: A }), e2(R, [2, 45]), e2(R, [2, 50]), e2(R, [2, 51]), e2(R, [2, 52]), e2(R, [2, 53]), e2(t2, [2, 41], { 42: O }), { 6: N, 10: P, 39: 85, 42: F, 47: I }, { 14: 86, 40: z, 50: B, 70: V }, { 16: 90, 40: S2, 41: C2 }, { 11: 91, 40: f2, 50: h2 }, { 18: 92, 19: [1, 93], 51: 50, 52: 51, 56: w2 }, e2(t2, [2, 12]), { 19: [2, 57] }, e2(H, [2, 58], { 54: 94, 55: 95, 57: 96, 59: U, 60: W }), e2([19, 56, 59, 60], [2, 63]), e2(t2, [2, 22], { 15: [1, 100], 17: [1, 99] }), e2([40, 50], [2, 68]), e2(t2, [2, 36]), { 13: E2, 41: D, 45: 101, 46: 60, 48: k, 49: A }, e2(t2, [2, 47]), e2(t2, [2, 48]), e2(t2, [2, 49]), e2(j, [2, 39]), e2(j, [2, 40]), e2(R, [2, 46]), e2(t2, [2, 42]), e2(t2, [2, 8]), e2(t2, [2, 76]), e2(t2, [2, 77]), e2(t2, [2, 78]), { 13: [1, 102], 42: O }, { 13: [1, 104], 15: [1, 103] }, { 19: [1, 105] }, e2(t2, [2, 15]), e2(H, [2, 59], { 55: 106, 58: [1, 107], 60: W }), e2(H, [2, 60]), e2(G, [2, 64]), e2(H, [2, 67]), e2(G, [2, 66]), { 18: 108, 19: [1, 109], 51: 50, 52: 51, 56: w2 }, { 16: 110, 40: S2, 41: C2 }, e2(L, [2, 44], { 46: 84, 13: E2, 41: D, 48: k, 49: A }), { 14: 111, 40: z, 50: B, 70: V }, { 16: 112, 40: S2, 41: C2 }, { 14: 113, 40: z, 50: B, 70: V }, e2(t2, [2, 13]), e2(H, [2, 61]), { 57: 114, 59: U }, { 19: [1, 115] }, e2(t2, [2, 20]), e2(t2, [2, 23], { 17: [1, 116], 42: O }), e2(t2, [2, 11]), { 13: [1, 117], 42: O }, e2(t2, [2, 10]), e2(G, [2, 65]), e2(t2, [2, 18]), { 18: 118, 19: [1, 119], 51: 50, 52: 51, 56: w2 }, { 14: 120, 40: z, 50: B, 70: V }, { 19: [1, 121] }, e2(t2, [2, 21]), e2(t2, [2, 9]), e2(t2, [2, 19])], defaultActions: { 52: [2, 62], 72: [2, 57] }, parseError: u(function(e3, t3) {
    if (t3.recoverable) this.trace(e3);
    else {
      var n3 = Error(e3);
      throw n3.hash = t3, n3;
    }
  }, `parseError`), parse: u(function(e3) {
    var t3 = this, n3 = [0], r3 = [], i3 = [null], a3 = [], o3 = this.table, s3 = ``, c3 = 0, l3 = 0, d3 = 0, f3 = 2, p3 = 1, m3 = a3.slice.call(arguments, 1), h3 = Object.create(this.lexer), g3 = { yy: {} };
    for (var _3 in this.yy) Object.prototype.hasOwnProperty.call(this.yy, _3) && (g3.yy[_3] = this.yy[_3]);
    h3.setInput(e3, g3.yy), g3.yy.lexer = h3, g3.yy.parser = this, h3.yylloc === void 0 && (h3.yylloc = {});
    var v3 = h3.yylloc;
    a3.push(v3);
    var y3 = h3.options && h3.options.ranges;
    typeof g3.yy.parseError == `function` ? this.parseError = g3.yy.parseError : this.parseError = Object.getPrototypeOf(this).parseError;
    function b3(e4) {
      n3.length -= 2 * e4, i3.length -= e4, a3.length -= e4;
    }
    u(b3, `popStack`);
    function x3() {
      var e4 = r3.pop() || h3.lex() || p3;
      return typeof e4 != `number` && (e4 instanceof Array && (r3 = e4, e4 = r3.pop()), e4 = t3.symbols_[e4] || e4), e4;
    }
    u(x3, `lex`);
    for (var S3, C3, w3, T3, E3, D2 = {}, O2, k2, A2, j2; ; ) {
      if (w3 = n3[n3.length - 1], this.defaultActions[w3] ? T3 = this.defaultActions[w3] : (S3 ?? (S3 = x3()), T3 = o3[w3] && o3[w3][S3]), T3 === void 0 || !T3.length || !T3[0]) {
        var M2 = ``;
        for (O2 in j2 = [], o3[w3]) this.terminals_[O2] && O2 > f3 && j2.push(`'` + this.terminals_[O2] + `'`);
        M2 = h3.showPosition ? `Parse error on line ` + (c3 + 1) + `:
` + h3.showPosition() + `
Expecting ` + j2.join(`, `) + `, got '` + (this.terminals_[S3] || S3) + `'` : `Parse error on line ` + (c3 + 1) + `: Unexpected ` + (S3 == p3 ? `end of input` : `'` + (this.terminals_[S3] || S3) + `'`), this.parseError(M2, { text: h3.match, token: this.terminals_[S3] || S3, line: h3.yylineno, loc: v3, expected: j2 });
      }
      if (T3[0] instanceof Array && T3.length > 1) throw Error(`Parse Error: multiple actions possible at state: ` + w3 + `, token: ` + S3);
      switch (T3[0]) {
        case 1:
          n3.push(S3), i3.push(h3.yytext), a3.push(h3.yylloc), n3.push(T3[1]), S3 = null, C3 ? (S3 = C3, C3 = null) : (l3 = h3.yyleng, s3 = h3.yytext, c3 = h3.yylineno, v3 = h3.yylloc, d3 > 0 && d3--);
          break;
        case 2:
          if (k2 = this.productions_[T3[1]][1], D2.$ = i3[i3.length - k2], D2._$ = { first_line: a3[a3.length - (k2 || 1)].first_line, last_line: a3[a3.length - 1].last_line, first_column: a3[a3.length - (k2 || 1)].first_column, last_column: a3[a3.length - 1].last_column }, y3 && (D2._$.range = [a3[a3.length - (k2 || 1)].range[0], a3[a3.length - 1].range[1]]), E3 = this.performAction.apply(D2, [s3, l3, c3, g3.yy, T3[1], i3, a3].concat(m3)), E3 !== void 0) return E3;
          k2 && (n3 = n3.slice(0, -1 * k2 * 2), i3 = i3.slice(0, -1 * k2), a3 = a3.slice(0, -1 * k2)), n3.push(this.productions_[T3[1]][0]), i3.push(D2.$), a3.push(D2._$), A2 = o3[n3[n3.length - 2]][n3[n3.length - 1]], n3.push(A2);
          break;
        case 3:
          return true;
      }
    }
    return true;
  }, `parse`) };
  K.lexer = (function() {
    return { EOF: 1, parseError: u(function(e3, t3) {
      if (this.yy.parser) this.yy.parser.parseError(e3, t3);
      else throw Error(e3);
    }, `parseError`), setInput: u(function(e3, t3) {
      return this.yy = t3 || this.yy || {}, this._input = e3, this._more = this._backtrack = this.done = false, this.yylineno = this.yyleng = 0, this.yytext = this.matched = this.match = ``, this.conditionStack = [`INITIAL`], this.yylloc = { first_line: 1, first_column: 0, last_line: 1, last_column: 0 }, this.options.ranges && (this.yylloc.range = [0, 0]), this.offset = 0, this;
    }, `setInput`), input: u(function() {
      var e3 = this._input[0];
      return this.yytext += e3, this.yyleng++, this.offset++, this.match += e3, this.matched += e3, e3.match(/(?:\r\n?|\n).*/g) ? (this.yylineno++, this.yylloc.last_line++) : this.yylloc.last_column++, this.options.ranges && this.yylloc.range[1]++, this._input = this._input.slice(1), e3;
    }, `input`), unput: u(function(e3) {
      var t3 = e3.length, n3 = e3.split(/(?:\r\n?|\n)/g);
      this._input = e3 + this._input, this.yytext = this.yytext.substr(0, this.yytext.length - t3), this.offset -= t3;
      var r3 = this.match.split(/(?:\r\n?|\n)/g);
      this.match = this.match.substr(0, this.match.length - 1), this.matched = this.matched.substr(0, this.matched.length - 1), n3.length - 1 && (this.yylineno -= n3.length - 1);
      var i3 = this.yylloc.range;
      return this.yylloc = { first_line: this.yylloc.first_line, last_line: this.yylineno + 1, first_column: this.yylloc.first_column, last_column: n3 ? (n3.length === r3.length ? this.yylloc.first_column : 0) + r3[r3.length - n3.length].length - n3[0].length : this.yylloc.first_column - t3 }, this.options.ranges && (this.yylloc.range = [i3[0], i3[0] + this.yyleng - t3]), this.yyleng = this.yytext.length, this;
    }, `unput`), more: u(function() {
      return this._more = true, this;
    }, `more`), reject: u(function() {
      if (this.options.backtrack_lexer) this._backtrack = true;
      else return this.parseError(`Lexical error on line ` + (this.yylineno + 1) + `. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
` + this.showPosition(), { text: ``, token: null, line: this.yylineno });
      return this;
    }, `reject`), less: u(function(e3) {
      this.unput(this.match.slice(e3));
    }, `less`), pastInput: u(function() {
      var e3 = this.matched.substr(0, this.matched.length - this.match.length);
      return (e3.length > 20 ? `...` : ``) + e3.substr(-20).replace(/\n/g, ``);
    }, `pastInput`), upcomingInput: u(function() {
      var e3 = this.match;
      return e3.length < 20 && (e3 += this._input.substr(0, 20 - e3.length)), (e3.substr(0, 20) + (e3.length > 20 ? `...` : ``)).replace(/\n/g, ``);
    }, `upcomingInput`), showPosition: u(function() {
      var e3 = this.pastInput(), t3 = Array(e3.length + 1).join(`-`);
      return e3 + this.upcomingInput() + `
` + t3 + `^`;
    }, `showPosition`), test_match: u(function(e3, t3) {
      var n3, r3, i3;
      if (this.options.backtrack_lexer && (i3 = { yylineno: this.yylineno, yylloc: { first_line: this.yylloc.first_line, last_line: this.last_line, first_column: this.yylloc.first_column, last_column: this.yylloc.last_column }, yytext: this.yytext, match: this.match, matches: this.matches, matched: this.matched, yyleng: this.yyleng, offset: this.offset, _more: this._more, _input: this._input, yy: this.yy, conditionStack: this.conditionStack.slice(0), done: this.done }, this.options.ranges && (i3.yylloc.range = this.yylloc.range.slice(0))), r3 = e3[0].match(/(?:\r\n?|\n).*/g), r3 && (this.yylineno += r3.length), this.yylloc = { first_line: this.yylloc.last_line, last_line: this.yylineno + 1, first_column: this.yylloc.last_column, last_column: r3 ? r3[r3.length - 1].length - r3[r3.length - 1].match(/\r?\n?/)[0].length : this.yylloc.last_column + e3[0].length }, this.yytext += e3[0], this.match += e3[0], this.matches = e3, this.yyleng = this.yytext.length, this.options.ranges && (this.yylloc.range = [this.offset, this.offset += this.yyleng]), this._more = false, this._backtrack = false, this._input = this._input.slice(e3[0].length), this.matched += e3[0], n3 = this.performAction.call(this, this.yy, this, t3, this.conditionStack[this.conditionStack.length - 1]), this.done && this._input && (this.done = false), n3) return n3;
      if (this._backtrack) {
        for (var a3 in i3) this[a3] = i3[a3];
        return false;
      }
      return false;
    }, `test_match`), next: u(function() {
      if (this.done) return this.EOF;
      this._input || (this.done = true);
      var e3, t3, n3, r3;
      this._more || (this.yytext = ``, this.match = ``);
      for (var i3 = this._currentRules(), a3 = 0; a3 < i3.length; a3++) if (n3 = this._input.match(this.rules[i3[a3]]), n3 && (!t3 || n3[0].length > t3[0].length)) {
        if (t3 = n3, r3 = a3, this.options.backtrack_lexer) {
          if (e3 = this.test_match(n3, i3[a3]), e3 !== false) return e3;
          if (this._backtrack) {
            t3 = false;
            continue;
          } else return false;
        } else if (!this.options.flex) break;
      }
      return t3 ? (e3 = this.test_match(t3, i3[r3]), e3 === false ? false : e3) : this._input === `` ? this.EOF : this.parseError(`Lexical error on line ` + (this.yylineno + 1) + `. Unrecognized text.
` + this.showPosition(), { text: ``, token: null, line: this.yylineno });
    }, `next`), lex: u(function() {
      return this.next() || this.lex();
    }, `lex`), begin: u(function(e3) {
      this.conditionStack.push(e3);
    }, `begin`), popState: u(function() {
      return this.conditionStack.length - 1 > 0 ? this.conditionStack.pop() : this.conditionStack[0];
    }, `popState`), _currentRules: u(function() {
      return this.conditionStack.length && this.conditionStack[this.conditionStack.length - 1] ? this.conditions[this.conditionStack[this.conditionStack.length - 1]].rules : this.conditions.INITIAL.rules;
    }, `_currentRules`), topState: u(function(e3) {
      return e3 = this.conditionStack.length - 1 - Math.abs(e3 || 0), e3 >= 0 ? this.conditionStack[e3] : `INITIAL`;
    }, `topState`), pushState: u(function(e3) {
      this.begin(e3);
    }, `pushState`), stateStackSize: u(function() {
      return this.conditionStack.length;
    }, `stateStackSize`), options: { "case-insensitive": true }, performAction: u(function(e3, t3, n3, r3) {
      switch (n3) {
        case 0:
          return this.begin(`acc_title`), 24;
        case 1:
          return this.popState(), `acc_title_value`;
        case 2:
          return this.begin(`acc_descr`), 26;
        case 3:
          return this.popState(), `acc_descr_value`;
        case 4:
          this.begin(`acc_descr_multiline`);
          break;
        case 5:
          this.popState();
          break;
        case 6:
          return `acc_descr_multiline_value`;
        case 7:
          return 33;
        case 8:
          return 34;
        case 9:
          return 35;
        case 10:
          return 36;
        case 11:
          return 10;
        case 12:
          break;
        case 13:
          return 8;
        case 14:
          return 50;
        case 15:
          return 70;
        case 16:
          return 4;
        case 17:
          return this.begin(`block`), 17;
        case 18:
          return 49;
        case 19:
          return 49;
        case 20:
          return 42;
        case 21:
          return 15;
        case 22:
          return 13;
        case 23:
          break;
        case 24:
          return 59;
        case 25:
          return 56;
        case 26:
          return 56;
        case 27:
          return 60;
        case 28:
          break;
        case 29:
          return this.popState(), 19;
        case 30:
          return t3.yytext[0];
        case 31:
          return 20;
        case 32:
          return 21;
        case 33:
          return this.begin(`style`), 44;
        case 34:
          return this.popState(), 10;
        case 35:
          break;
        case 36:
          return 13;
        case 37:
          return 42;
        case 38:
          return 49;
        case 39:
          return this.begin(`style`), 37;
        case 40:
          return 43;
        case 41:
          return 63;
        case 42:
          return 65;
        case 43:
          return 65;
        case 44:
          return 65;
        case 45:
          return 63;
        case 46:
          return 63;
        case 47:
          return 64;
        case 48:
          return 64;
        case 49:
          return 64;
        case 50:
          return 64;
        case 51:
          return 64;
        case 52:
          return 65;
        case 53:
          return 64;
        case 54:
          return 65;
        case 55:
          return 66;
        case 56:
          return 66;
        case 57:
          return 66;
        case 58:
          return 66;
        case 59:
          return 63;
        case 60:
          return 64;
        case 61:
          return 65;
        case 62:
          return 67;
        case 63:
          return 68;
        case 64:
          return 69;
        case 65:
          return 69;
        case 66:
          return 68;
        case 67:
          return 68;
        case 68:
          return 68;
        case 69:
          return 41;
        case 70:
          return 47;
        case 71:
          return 40;
        case 72:
          return 48;
        case 73:
          return t3.yytext[0];
        case 74:
          return 6;
      }
    }, `anonymous`), rules: [/^(?:accTitle\s*:\s*)/i, /^(?:(?!\n||)*[^\n]*)/i, /^(?:accDescr\s*:\s*)/i, /^(?:(?!\n||)*[^\n]*)/i, /^(?:accDescr\s*\{\s*)/i, /^(?:[\}])/i, /^(?:[^\}]*)/i, /^(?:.*direction\s+TB[^\n]*)/i, /^(?:.*direction\s+BT[^\n]*)/i, /^(?:.*direction\s+RL[^\n]*)/i, /^(?:.*direction\s+LR[^\n]*)/i, /^(?:[\n]+)/i, /^(?:\s+)/i, /^(?:[\s]+)/i, /^(?:"[^"%\r\n\v\b\\]+")/i, /^(?:"[^"]*")/i, /^(?:erDiagram\b)/i, /^(?:\{)/i, /^(?:#)/i, /^(?:#)/i, /^(?:,)/i, /^(?::::)/i, /^(?::)/i, /^(?:\s+)/i, /^(?:\b((?:PK)|(?:FK)|(?:UK))\b)/i, /^(?:([^\s]*)[~].*[~]([^\s]*))/i, /^(?:([\*A-Za-z_\u00C0-\uFFFF][A-Za-z0-9\-\_\[\]\(\)\u00C0-\uFFFF\*]*))/i, /^(?:"[^"]*")/i, /^(?:[\n]+)/i, /^(?:\})/i, /^(?:.)/i, /^(?:\[)/i, /^(?:\])/i, /^(?:style\b)/i, /^(?:[\n]+)/i, /^(?:\s+)/i, /^(?::)/i, /^(?:,)/i, /^(?:#)/i, /^(?:classDef\b)/i, /^(?:class\b)/i, /^(?:one or zero\b)/i, /^(?:one or more\b)/i, /^(?:one or many\b)/i, /^(?:1\+)/i, /^(?:\|o\b)/i, /^(?:zero or one\b)/i, /^(?:zero or more\b)/i, /^(?:zero or many\b)/i, /^(?:0\+)/i, /^(?:\}o\b)/i, /^(?:many\(0\))/i, /^(?:many\(1\))/i, /^(?:many\b)/i, /^(?:\}\|)/i, /^(?:one\b)/i, /^(?:only one\b)/i, /^(?:1\b)/i, /^(?:\|\|)/i, /^(?:o\|)/i, /^(?:o\{)/i, /^(?:\|\{)/i, /^(?:\s*u\b)/i, /^(?:\.\.)/i, /^(?:--)/i, /^(?:to\b)/i, /^(?:optionally to\b)/i, /^(?:\.-)/i, /^(?:-\.)/i, /^(?:([^\x00-\x7F]|\w|-|\*)+)/i, /^(?:;)/i, /^(?:([^\x00-\x7F]|\w|-|\*)+)/i, /^(?:[0-9])/i, /^(?:.)/i, /^(?:$)/i], conditions: { style: { rules: [34, 35, 36, 37, 38, 69, 70], inclusive: false }, acc_descr_multiline: { rules: [5, 6], inclusive: false }, acc_descr: { rules: [3], inclusive: false }, acc_title: { rules: [1], inclusive: false }, block: { rules: [23, 24, 25, 26, 27, 28, 29, 30], inclusive: false }, INITIAL: { rules: [0, 2, 4, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 31, 32, 33, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 71, 72, 73, 74], inclusive: true } } };
  })();
  function q() {
    this.yy = {};
  }
  return u(q, `Parser`), q.prototype = K, K.Parser = q, new q();
})();
b.parser = b;
var x = b, S = (_a = class {
  constructor() {
    this.entities = /* @__PURE__ */ new Map(), this.relationships = [], this.classes = /* @__PURE__ */ new Map(), this.direction = `TB`, this.Cardinality = { ZERO_OR_ONE: `ZERO_OR_ONE`, ZERO_OR_MORE: `ZERO_OR_MORE`, ONE_OR_MORE: `ONE_OR_MORE`, ONLY_ONE: `ONLY_ONE`, MD_PARENT: `MD_PARENT` }, this.Identification = { NON_IDENTIFYING: `NON_IDENTIFYING`, IDENTIFYING: `IDENTIFYING` }, this.setAccTitle = e, this.getAccTitle = s, this.setAccDescription = c, this.getAccDescription = r, this.setDiagramTitle = n, this.getDiagramTitle = t, this.getConfig = u(() => a().er, `getConfig`), this.clear(), this.addEntity = this.addEntity.bind(this), this.addAttributes = this.addAttributes.bind(this), this.addRelationship = this.addRelationship.bind(this), this.setDirection = this.setDirection.bind(this), this.addCssStyles = this.addCssStyles.bind(this), this.addClass = this.addClass.bind(this), this.setClass = this.setClass.bind(this), this.setAccTitle = this.setAccTitle.bind(this), this.setAccDescription = this.setAccDescription.bind(this);
  }
  addEntity(e2, t2 = ``) {
    var _a2;
    return this.entities.has(e2) ? !((_a2 = this.entities.get(e2)) == null ? void 0 : _a2.alias) && t2 && (this.entities.get(e2).alias = t2, l.info(`Add alias '${t2}' to entity '${e2}'`)) : (this.entities.set(e2, { id: `entity-${e2}-${this.entities.size}`, label: e2, attributes: [], alias: t2, shape: `erBox`, look: a().look ?? `default`, cssClasses: `default`, cssStyles: [] }), l.info(`Added new entity :`, e2)), this.entities.get(e2);
  }
  getEntity(e2) {
    return this.entities.get(e2);
  }
  getEntities() {
    return this.entities;
  }
  getClasses() {
    return this.classes;
  }
  addAttributes(e2, t2) {
    let n2 = this.addEntity(e2), r2;
    for (r2 = t2.length - 1; r2 >= 0; r2--) t2[r2].keys || (t2[r2].keys = []), t2[r2].comment || (t2[r2].comment = ``), n2.attributes.push(t2[r2]), l.debug(`Added attribute `, t2[r2].name);
  }
  addRelationship(e2, t2, n2, r2) {
    let i2 = this.entities.get(e2), a2 = this.entities.get(n2);
    if (!i2 || !a2) return;
    let o2 = { entityA: i2.id, roleA: t2, entityB: a2.id, relSpec: r2 };
    this.relationships.push(o2), l.debug(`Added new relationship :`, o2);
  }
  getRelationships() {
    return this.relationships;
  }
  getDirection() {
    return this.direction;
  }
  setDirection(e2) {
    this.direction = e2;
  }
  getCompiledStyles(e2) {
    let t2 = [];
    for (let n2 of e2) {
      let e3 = this.classes.get(n2);
      (e3 == null ? void 0 : e3.styles) && (t2 = [...t2, ...e3.styles ?? []].map((e4) => e4.trim())), (e3 == null ? void 0 : e3.textStyles) && (t2 = [...t2, ...e3.textStyles ?? []].map((e4) => e4.trim()));
    }
    return t2;
  }
  addCssStyles(e2, t2) {
    for (let n2 of e2) {
      let e3 = this.entities.get(n2);
      if (!t2 || !e3) return;
      for (let n3 of t2) e3.cssStyles.push(n3);
    }
  }
  addClass(e2, t2) {
    e2.forEach((e3) => {
      let n2 = this.classes.get(e3);
      n2 === void 0 && (n2 = { id: e3, styles: [], textStyles: [] }, this.classes.set(e3, n2)), t2 && t2.forEach(function(e4) {
        if (/color/.exec(e4)) {
          let t3 = e4.replace(`fill`, `bgFill`);
          n2.textStyles.push(t3);
        }
        n2.styles.push(e4);
      });
    });
  }
  setClass(e2, t2) {
    for (let n2 of e2) {
      let e3 = this.entities.get(n2);
      if (e3) for (let n3 of t2) e3.cssClasses += ` ` + n3;
    }
  }
  clear() {
    this.entities = /* @__PURE__ */ new Map(), this.classes = /* @__PURE__ */ new Map(), this.relationships = [], i();
  }
  getData() {
    let e2 = [], t2 = [], n2 = a();
    for (let t3 of this.entities.keys()) {
      let n3 = this.entities.get(t3);
      n3 && (n3.cssCompiledStyles = this.getCompiledStyles(n3.cssClasses.split(` `)), e2.push(n3));
    }
    let r2 = 0;
    for (let e3 of this.relationships) {
      let i2 = { id: m(e3.entityA, e3.entityB, { prefix: `id`, counter: r2++ }), type: `normal`, curve: `basis`, start: e3.entityA, end: e3.entityB, label: e3.roleA, labelpos: `c`, thickness: `normal`, classes: `relationshipLine`, arrowTypeStart: e3.relSpec.cardB.toLowerCase(), arrowTypeEnd: e3.relSpec.cardA.toLowerCase(), pattern: e3.relSpec.relType == `IDENTIFYING` ? `solid` : `dashed`, look: n2.look };
      t2.push(i2);
    }
    return { nodes: e2, edges: t2, other: {}, config: n2, direction: `TB` };
  }
}, u(_a, `ErDB`), _a), C = {};
d(C, { draw: () => w });
var w = u(async function(e2, t2, n2, r2) {
  l.info(`REF0:`), l.info(`Drawing er diagram (unified)`, t2);
  let { securityLevel: i2, er: o2, layout: s2 } = a(), c2 = r2.db.getData(), u2 = v(t2, i2);
  c2.type = r2.type, c2.layoutAlgorithm = _(s2), c2.config.flowchart.nodeSpacing = (o2 == null ? void 0 : o2.nodeSpacing) || 140, c2.config.flowchart.rankSpacing = (o2 == null ? void 0 : o2.rankSpacing) || 80, c2.direction = r2.db.getDirection(), c2.markers = [`only_one`, `zero_or_one`, `one_or_more`, `zero_or_more`], c2.diagramId = t2, await g(c2, u2), c2.layoutAlgorithm === `elk` && u2.select(`.edges`).lower();
  let d2 = u2.selectAll(`[id*="-background"]`);
  Array.from(d2).length > 0 && d2.each(function() {
    let e3 = f(this), t3 = e3.attr(`id`).replace(`-background`, ``), n3 = u2.select(`#${CSS.escape(t3)}`);
    if (!n3.empty()) {
      let t4 = n3.attr(`transform`);
      e3.attr(`transform`, t4);
    }
  }), h.insertTitle(u2, `erDiagramTitleText`, (o2 == null ? void 0 : o2.titleTopMargin) ?? 25, r2.db.getDiagramTitle()), y(u2, 8, `erDiagram`, (o2 == null ? void 0 : o2.useMaxWidth) ?? true);
}, `draw`), T = u((e2, t2) => {
  let n2 = p;
  return o(n2(e2, `r`), n2(e2, `g`), n2(e2, `b`), t2);
}, `fade`), E = { parser: x, get db() {
  return new S();
}, renderer: C, styles: u((e2) => `
  .entityBox {
    fill: ${e2.mainBkg};
    stroke: ${e2.nodeBorder};
  }

  .relationshipLabelBox {
    fill: ${e2.tertiaryColor};
    opacity: 0.7;
    background-color: ${e2.tertiaryColor};
      rect {
        opacity: 0.5;
      }
  }

  .labelBkg {
    background-color: ${T(e2.tertiaryColor, 0.5)};
  }

  .edgeLabel .label {
    fill: ${e2.nodeBorder};
    font-size: 14px;
  }

  .label {
    font-family: ${e2.fontFamily};
    color: ${e2.nodeTextColor || e2.textColor};
  }

  .edge-pattern-dashed {
    stroke-dasharray: 8,8;
  }

  .node rect,
  .node circle,
  .node ellipse,
  .node polygon
  {
    fill: ${e2.mainBkg};
    stroke: ${e2.nodeBorder};
    stroke-width: 1px;
  }

  .relationshipLine {
    stroke: ${e2.lineColor};
    stroke-width: 1;
    fill: none;
  }

  .marker {
    fill: none !important;
    stroke: ${e2.lineColor} !important;
    stroke-width: 1;
  }
`, `getStyles`) };
export {
  E as diagram
};

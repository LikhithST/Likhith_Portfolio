var _a;
import { B as e, C as t, E as n, H as r, I as i, N as a, O as o, U as s, _ as c, a as l, b as u, c as d, i as f, r as p, s as m, v as h, y as g, z as _ } from "./chunk-ABZYJK2D-ODb6qSou.js";
import { g as v, h as y, p as b } from "./src-D8UWkQNo.js";
import "./math-O_7OW4FW.js";
import { g as x, p as S, t as C } from "./chunk-S3R3BYOJ-D8yhV3IZ.js";
import { n as w, t as T } from "./chunk-MI3HLSF2-BT3n8yzv.js";
import { t as E } from "./dist-DrVb-WkD.js";
import "./identity-IHMFXfGJ.js";
import { i as D, n as O, o as k, r as A, s as j, t as M } from "./chunk-TZMSLE5B-IRLonryi.js";
import { t as N } from "./chunk-QZHKN3VN-D1KcrvSB.js";
var P = E(), F = (function() {
  var e2 = y(function(e3, t3, n3, r3) {
    for (n3 || (n3 = {}), r3 = e3.length; r3--; n3[e3[r3]] = t3) ;
    return n3;
  }, `o`), t2 = [1, 2], n2 = [1, 3], r2 = [1, 4], i2 = [2, 4], a2 = [1, 9], o2 = [1, 11], s2 = [1, 13], c2 = [1, 14], l2 = [1, 16], u2 = [1, 17], d2 = [1, 18], f2 = [1, 24], p2 = [1, 25], m2 = [1, 26], h2 = [1, 27], g2 = [1, 28], _2 = [1, 29], v2 = [1, 30], b2 = [1, 31], x2 = [1, 32], S2 = [1, 33], C2 = [1, 34], w2 = [1, 35], T2 = [1, 36], E2 = [1, 37], D2 = [1, 38], O2 = [1, 39], k2 = [1, 41], A2 = [1, 42], j2 = [1, 43], M2 = [1, 44], N2 = [1, 45], P2 = [1, 46], F2 = [1, 4, 5, 13, 14, 16, 18, 21, 23, 29, 30, 31, 33, 35, 36, 37, 38, 39, 41, 43, 44, 46, 47, 48, 49, 50, 52, 53, 55, 60, 61, 62, 63, 71], I2 = [2, 71], L2 = [4, 5, 16, 50, 52, 53], R2 = [4, 5, 13, 14, 16, 18, 21, 23, 29, 30, 31, 33, 35, 36, 37, 38, 39, 41, 43, 44, 46, 50, 52, 53, 55, 60, 61, 62, 63, 71], ee2 = [4, 5, 13, 14, 16, 18, 21, 23, 29, 30, 31, 33, 35, 36, 37, 38, 39, 41, 43, 44, 46, 49, 50, 52, 53, 55, 60, 61, 62, 63, 71], z2 = [4, 5, 13, 14, 16, 18, 21, 23, 29, 30, 31, 33, 35, 36, 37, 38, 39, 41, 43, 44, 46, 48, 50, 52, 53, 55, 60, 61, 62, 63, 71], te2 = [4, 5, 13, 14, 16, 18, 21, 23, 29, 30, 31, 33, 35, 36, 37, 38, 39, 41, 43, 44, 46, 47, 50, 52, 53, 55, 60, 61, 62, 63, 71], B2 = [69, 70, 71], V2 = [1, 127], H2 = { trace: y(function() {
  }, `trace`), yy: {}, symbols_: { error: 2, start: 3, SPACE: 4, NEWLINE: 5, SD: 6, document: 7, line: 8, statement: 9, box_section: 10, box_line: 11, participant_statement: 12, create: 13, box: 14, restOfLine: 15, end: 16, signal: 17, autonumber: 18, NUM: 19, off: 20, activate: 21, actor: 22, deactivate: 23, note_statement: 24, links_statement: 25, link_statement: 26, properties_statement: 27, details_statement: 28, title: 29, legacy_title: 30, acc_title: 31, acc_title_value: 32, acc_descr: 33, acc_descr_value: 34, acc_descr_multiline_value: 35, loop: 36, rect: 37, opt: 38, alt: 39, else_sections: 40, par: 41, par_sections: 42, par_over: 43, critical: 44, option_sections: 45, break: 46, option: 47, and: 48, else: 49, participant: 50, AS: 51, participant_actor: 52, destroy: 53, actor_with_config: 54, note: 55, placement: 56, text2: 57, over: 58, actor_pair: 59, links: 60, link: 61, properties: 62, details: 63, spaceList: 64, ",": 65, left_of: 66, right_of: 67, signaltype: 68, "+": 69, "-": 70, ACTOR: 71, config_object: 72, CONFIG_START: 73, CONFIG_CONTENT: 74, CONFIG_END: 75, SOLID_OPEN_ARROW: 76, DOTTED_OPEN_ARROW: 77, SOLID_ARROW: 78, BIDIRECTIONAL_SOLID_ARROW: 79, DOTTED_ARROW: 80, BIDIRECTIONAL_DOTTED_ARROW: 81, SOLID_CROSS: 82, DOTTED_CROSS: 83, SOLID_POINT: 84, DOTTED_POINT: 85, TXT: 86, $accept: 0, $end: 1 }, terminals_: { 2: `error`, 4: `SPACE`, 5: `NEWLINE`, 6: `SD`, 13: `create`, 14: `box`, 15: `restOfLine`, 16: `end`, 18: `autonumber`, 19: `NUM`, 20: `off`, 21: `activate`, 23: `deactivate`, 29: `title`, 30: `legacy_title`, 31: `acc_title`, 32: `acc_title_value`, 33: `acc_descr`, 34: `acc_descr_value`, 35: `acc_descr_multiline_value`, 36: `loop`, 37: `rect`, 38: `opt`, 39: `alt`, 41: `par`, 43: `par_over`, 44: `critical`, 46: `break`, 47: `option`, 48: `and`, 49: `else`, 50: `participant`, 51: `AS`, 52: `participant_actor`, 53: `destroy`, 55: `note`, 58: `over`, 60: `links`, 61: `link`, 62: `properties`, 63: `details`, 65: `,`, 66: `left_of`, 67: `right_of`, 69: `+`, 70: `-`, 71: `ACTOR`, 73: `CONFIG_START`, 74: `CONFIG_CONTENT`, 75: `CONFIG_END`, 76: `SOLID_OPEN_ARROW`, 77: `DOTTED_OPEN_ARROW`, 78: `SOLID_ARROW`, 79: `BIDIRECTIONAL_SOLID_ARROW`, 80: `DOTTED_ARROW`, 81: `BIDIRECTIONAL_DOTTED_ARROW`, 82: `SOLID_CROSS`, 83: `DOTTED_CROSS`, 84: `SOLID_POINT`, 85: `DOTTED_POINT`, 86: `TXT` }, productions_: [0, [3, 2], [3, 2], [3, 2], [7, 0], [7, 2], [8, 2], [8, 1], [8, 1], [10, 0], [10, 2], [11, 2], [11, 1], [11, 1], [9, 1], [9, 2], [9, 4], [9, 2], [9, 4], [9, 3], [9, 3], [9, 2], [9, 3], [9, 3], [9, 2], [9, 2], [9, 2], [9, 2], [9, 2], [9, 1], [9, 1], [9, 2], [9, 2], [9, 1], [9, 4], [9, 4], [9, 4], [9, 4], [9, 4], [9, 4], [9, 4], [9, 4], [45, 1], [45, 4], [42, 1], [42, 4], [40, 1], [40, 4], [12, 5], [12, 3], [12, 5], [12, 3], [12, 3], [12, 3], [24, 4], [24, 4], [25, 3], [26, 3], [27, 3], [28, 3], [64, 2], [64, 1], [59, 3], [59, 1], [56, 1], [56, 1], [17, 5], [17, 5], [17, 4], [54, 2], [72, 3], [22, 1], [68, 1], [68, 1], [68, 1], [68, 1], [68, 1], [68, 1], [68, 1], [68, 1], [68, 1], [68, 1], [57, 1]], performAction: y(function(e3, t3, n3, r3, i3, a3, o3) {
    var s3 = a3.length - 1;
    switch (i3) {
      case 3:
        return r3.apply(a3[s3]), a3[s3];
      case 4:
      case 9:
        this.$ = [];
        break;
      case 5:
      case 10:
        a3[s3 - 1].push(a3[s3]), this.$ = a3[s3 - 1];
        break;
      case 6:
      case 7:
      case 11:
      case 12:
        this.$ = a3[s3];
        break;
      case 8:
      case 13:
        this.$ = [];
        break;
      case 15:
        a3[s3].type = `createParticipant`, this.$ = a3[s3];
        break;
      case 16:
        a3[s3 - 1].unshift({ type: `boxStart`, boxData: r3.parseBoxData(a3[s3 - 2]) }), a3[s3 - 1].push({ type: `boxEnd`, boxText: a3[s3 - 2] }), this.$ = a3[s3 - 1];
        break;
      case 18:
        this.$ = { type: `sequenceIndex`, sequenceIndex: Number(a3[s3 - 2]), sequenceIndexStep: Number(a3[s3 - 1]), sequenceVisible: true, signalType: r3.LINETYPE.AUTONUMBER };
        break;
      case 19:
        this.$ = { type: `sequenceIndex`, sequenceIndex: Number(a3[s3 - 1]), sequenceIndexStep: 1, sequenceVisible: true, signalType: r3.LINETYPE.AUTONUMBER };
        break;
      case 20:
        this.$ = { type: `sequenceIndex`, sequenceVisible: false, signalType: r3.LINETYPE.AUTONUMBER };
        break;
      case 21:
        this.$ = { type: `sequenceIndex`, sequenceVisible: true, signalType: r3.LINETYPE.AUTONUMBER };
        break;
      case 22:
        this.$ = { type: `activeStart`, signalType: r3.LINETYPE.ACTIVE_START, actor: a3[s3 - 1].actor };
        break;
      case 23:
        this.$ = { type: `activeEnd`, signalType: r3.LINETYPE.ACTIVE_END, actor: a3[s3 - 1].actor };
        break;
      case 29:
        r3.setDiagramTitle(a3[s3].substring(6)), this.$ = a3[s3].substring(6);
        break;
      case 30:
        r3.setDiagramTitle(a3[s3].substring(7)), this.$ = a3[s3].substring(7);
        break;
      case 31:
        this.$ = a3[s3].trim(), r3.setAccTitle(this.$);
        break;
      case 32:
      case 33:
        this.$ = a3[s3].trim(), r3.setAccDescription(this.$);
        break;
      case 34:
        a3[s3 - 1].unshift({ type: `loopStart`, loopText: r3.parseMessage(a3[s3 - 2]), signalType: r3.LINETYPE.LOOP_START }), a3[s3 - 1].push({ type: `loopEnd`, loopText: a3[s3 - 2], signalType: r3.LINETYPE.LOOP_END }), this.$ = a3[s3 - 1];
        break;
      case 35:
        a3[s3 - 1].unshift({ type: `rectStart`, color: r3.parseMessage(a3[s3 - 2]), signalType: r3.LINETYPE.RECT_START }), a3[s3 - 1].push({ type: `rectEnd`, color: r3.parseMessage(a3[s3 - 2]), signalType: r3.LINETYPE.RECT_END }), this.$ = a3[s3 - 1];
        break;
      case 36:
        a3[s3 - 1].unshift({ type: `optStart`, optText: r3.parseMessage(a3[s3 - 2]), signalType: r3.LINETYPE.OPT_START }), a3[s3 - 1].push({ type: `optEnd`, optText: r3.parseMessage(a3[s3 - 2]), signalType: r3.LINETYPE.OPT_END }), this.$ = a3[s3 - 1];
        break;
      case 37:
        a3[s3 - 1].unshift({ type: `altStart`, altText: r3.parseMessage(a3[s3 - 2]), signalType: r3.LINETYPE.ALT_START }), a3[s3 - 1].push({ type: `altEnd`, signalType: r3.LINETYPE.ALT_END }), this.$ = a3[s3 - 1];
        break;
      case 38:
        a3[s3 - 1].unshift({ type: `parStart`, parText: r3.parseMessage(a3[s3 - 2]), signalType: r3.LINETYPE.PAR_START }), a3[s3 - 1].push({ type: `parEnd`, signalType: r3.LINETYPE.PAR_END }), this.$ = a3[s3 - 1];
        break;
      case 39:
        a3[s3 - 1].unshift({ type: `parStart`, parText: r3.parseMessage(a3[s3 - 2]), signalType: r3.LINETYPE.PAR_OVER_START }), a3[s3 - 1].push({ type: `parEnd`, signalType: r3.LINETYPE.PAR_END }), this.$ = a3[s3 - 1];
        break;
      case 40:
        a3[s3 - 1].unshift({ type: `criticalStart`, criticalText: r3.parseMessage(a3[s3 - 2]), signalType: r3.LINETYPE.CRITICAL_START }), a3[s3 - 1].push({ type: `criticalEnd`, signalType: r3.LINETYPE.CRITICAL_END }), this.$ = a3[s3 - 1];
        break;
      case 41:
        a3[s3 - 1].unshift({ type: `breakStart`, breakText: r3.parseMessage(a3[s3 - 2]), signalType: r3.LINETYPE.BREAK_START }), a3[s3 - 1].push({ type: `breakEnd`, optText: r3.parseMessage(a3[s3 - 2]), signalType: r3.LINETYPE.BREAK_END }), this.$ = a3[s3 - 1];
        break;
      case 43:
        this.$ = a3[s3 - 3].concat([{ type: `option`, optionText: r3.parseMessage(a3[s3 - 1]), signalType: r3.LINETYPE.CRITICAL_OPTION }, a3[s3]]);
        break;
      case 45:
        this.$ = a3[s3 - 3].concat([{ type: `and`, parText: r3.parseMessage(a3[s3 - 1]), signalType: r3.LINETYPE.PAR_AND }, a3[s3]]);
        break;
      case 47:
        this.$ = a3[s3 - 3].concat([{ type: `else`, altText: r3.parseMessage(a3[s3 - 1]), signalType: r3.LINETYPE.ALT_ELSE }, a3[s3]]);
        break;
      case 48:
        a3[s3 - 3].draw = `participant`, a3[s3 - 3].type = `addParticipant`, a3[s3 - 3].description = r3.parseMessage(a3[s3 - 1]), this.$ = a3[s3 - 3];
        break;
      case 49:
        a3[s3 - 1].draw = `participant`, a3[s3 - 1].type = `addParticipant`, this.$ = a3[s3 - 1];
        break;
      case 50:
        a3[s3 - 3].draw = `actor`, a3[s3 - 3].type = `addParticipant`, a3[s3 - 3].description = r3.parseMessage(a3[s3 - 1]), this.$ = a3[s3 - 3];
        break;
      case 51:
        a3[s3 - 1].draw = `actor`, a3[s3 - 1].type = `addParticipant`, this.$ = a3[s3 - 1];
        break;
      case 52:
        a3[s3 - 1].type = `destroyParticipant`, this.$ = a3[s3 - 1];
        break;
      case 53:
        a3[s3 - 1].draw = `participant`, a3[s3 - 1].type = `addParticipant`, this.$ = a3[s3 - 1];
        break;
      case 54:
        this.$ = [a3[s3 - 1], { type: `addNote`, placement: a3[s3 - 2], actor: a3[s3 - 1].actor, text: a3[s3] }];
        break;
      case 55:
        a3[s3 - 2] = [].concat(a3[s3 - 1], a3[s3 - 1]).slice(0, 2), a3[s3 - 2][0] = a3[s3 - 2][0].actor, a3[s3 - 2][1] = a3[s3 - 2][1].actor, this.$ = [a3[s3 - 1], { type: `addNote`, placement: r3.PLACEMENT.OVER, actor: a3[s3 - 2].slice(0, 2), text: a3[s3] }];
        break;
      case 56:
        this.$ = [a3[s3 - 1], { type: `addLinks`, actor: a3[s3 - 1].actor, text: a3[s3] }];
        break;
      case 57:
        this.$ = [a3[s3 - 1], { type: `addALink`, actor: a3[s3 - 1].actor, text: a3[s3] }];
        break;
      case 58:
        this.$ = [a3[s3 - 1], { type: `addProperties`, actor: a3[s3 - 1].actor, text: a3[s3] }];
        break;
      case 59:
        this.$ = [a3[s3 - 1], { type: `addDetails`, actor: a3[s3 - 1].actor, text: a3[s3] }];
        break;
      case 62:
        this.$ = [a3[s3 - 2], a3[s3]];
        break;
      case 63:
        this.$ = a3[s3];
        break;
      case 64:
        this.$ = r3.PLACEMENT.LEFTOF;
        break;
      case 65:
        this.$ = r3.PLACEMENT.RIGHTOF;
        break;
      case 66:
        this.$ = [a3[s3 - 4], a3[s3 - 1], { type: `addMessage`, from: a3[s3 - 4].actor, to: a3[s3 - 1].actor, signalType: a3[s3 - 3], msg: a3[s3], activate: true }, { type: `activeStart`, signalType: r3.LINETYPE.ACTIVE_START, actor: a3[s3 - 1].actor }];
        break;
      case 67:
        this.$ = [a3[s3 - 4], a3[s3 - 1], { type: `addMessage`, from: a3[s3 - 4].actor, to: a3[s3 - 1].actor, signalType: a3[s3 - 3], msg: a3[s3] }, { type: `activeEnd`, signalType: r3.LINETYPE.ACTIVE_END, actor: a3[s3 - 4].actor }];
        break;
      case 68:
        this.$ = [a3[s3 - 3], a3[s3 - 1], { type: `addMessage`, from: a3[s3 - 3].actor, to: a3[s3 - 1].actor, signalType: a3[s3 - 2], msg: a3[s3] }];
        break;
      case 69:
        this.$ = { type: `addParticipant`, actor: a3[s3 - 1], config: a3[s3] };
        break;
      case 70:
        this.$ = a3[s3 - 1].trim();
        break;
      case 71:
        this.$ = { type: `addParticipant`, actor: a3[s3] };
        break;
      case 72:
        this.$ = r3.LINETYPE.SOLID_OPEN;
        break;
      case 73:
        this.$ = r3.LINETYPE.DOTTED_OPEN;
        break;
      case 74:
        this.$ = r3.LINETYPE.SOLID;
        break;
      case 75:
        this.$ = r3.LINETYPE.BIDIRECTIONAL_SOLID;
        break;
      case 76:
        this.$ = r3.LINETYPE.DOTTED;
        break;
      case 77:
        this.$ = r3.LINETYPE.BIDIRECTIONAL_DOTTED;
        break;
      case 78:
        this.$ = r3.LINETYPE.SOLID_CROSS;
        break;
      case 79:
        this.$ = r3.LINETYPE.DOTTED_CROSS;
        break;
      case 80:
        this.$ = r3.LINETYPE.SOLID_POINT;
        break;
      case 81:
        this.$ = r3.LINETYPE.DOTTED_POINT;
        break;
      case 82:
        this.$ = r3.parseMessage(a3[s3].trim().substring(1));
        break;
    }
  }, `anonymous`), table: [{ 3: 1, 4: t2, 5: n2, 6: r2 }, { 1: [3] }, { 3: 5, 4: t2, 5: n2, 6: r2 }, { 3: 6, 4: t2, 5: n2, 6: r2 }, e2([1, 4, 5, 13, 14, 18, 21, 23, 29, 30, 31, 33, 35, 36, 37, 38, 39, 41, 43, 44, 46, 50, 52, 53, 55, 60, 61, 62, 63, 71], i2, { 7: 7 }), { 1: [2, 1] }, { 1: [2, 2] }, { 1: [2, 3], 4: a2, 5: o2, 8: 8, 9: 10, 12: 12, 13: s2, 14: c2, 17: 15, 18: l2, 21: u2, 22: 40, 23: d2, 24: 19, 25: 20, 26: 21, 27: 22, 28: 23, 29: f2, 30: p2, 31: m2, 33: h2, 35: g2, 36: _2, 37: v2, 38: b2, 39: x2, 41: S2, 43: C2, 44: w2, 46: T2, 50: E2, 52: D2, 53: O2, 55: k2, 60: A2, 61: j2, 62: M2, 63: N2, 71: P2 }, e2(F2, [2, 5]), { 9: 47, 12: 12, 13: s2, 14: c2, 17: 15, 18: l2, 21: u2, 22: 40, 23: d2, 24: 19, 25: 20, 26: 21, 27: 22, 28: 23, 29: f2, 30: p2, 31: m2, 33: h2, 35: g2, 36: _2, 37: v2, 38: b2, 39: x2, 41: S2, 43: C2, 44: w2, 46: T2, 50: E2, 52: D2, 53: O2, 55: k2, 60: A2, 61: j2, 62: M2, 63: N2, 71: P2 }, e2(F2, [2, 7]), e2(F2, [2, 8]), e2(F2, [2, 14]), { 12: 48, 50: E2, 52: D2, 53: O2 }, { 15: [1, 49] }, { 5: [1, 50] }, { 5: [1, 53], 19: [1, 51], 20: [1, 52] }, { 22: 54, 71: P2 }, { 22: 55, 71: P2 }, { 5: [1, 56] }, { 5: [1, 57] }, { 5: [1, 58] }, { 5: [1, 59] }, { 5: [1, 60] }, e2(F2, [2, 29]), e2(F2, [2, 30]), { 32: [1, 61] }, { 34: [1, 62] }, e2(F2, [2, 33]), { 15: [1, 63] }, { 15: [1, 64] }, { 15: [1, 65] }, { 15: [1, 66] }, { 15: [1, 67] }, { 15: [1, 68] }, { 15: [1, 69] }, { 15: [1, 70] }, { 22: 71, 54: 72, 71: [1, 73] }, { 22: 74, 71: P2 }, { 22: 75, 71: P2 }, { 68: 76, 76: [1, 77], 77: [1, 78], 78: [1, 79], 79: [1, 80], 80: [1, 81], 81: [1, 82], 82: [1, 83], 83: [1, 84], 84: [1, 85], 85: [1, 86] }, { 56: 87, 58: [1, 88], 66: [1, 89], 67: [1, 90] }, { 22: 91, 71: P2 }, { 22: 92, 71: P2 }, { 22: 93, 71: P2 }, { 22: 94, 71: P2 }, e2([5, 51, 65, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86], I2), e2(F2, [2, 6]), e2(F2, [2, 15]), e2(L2, [2, 9], { 10: 95 }), e2(F2, [2, 17]), { 5: [1, 97], 19: [1, 96] }, { 5: [1, 98] }, e2(F2, [2, 21]), { 5: [1, 99] }, { 5: [1, 100] }, e2(F2, [2, 24]), e2(F2, [2, 25]), e2(F2, [2, 26]), e2(F2, [2, 27]), e2(F2, [2, 28]), e2(F2, [2, 31]), e2(F2, [2, 32]), e2(R2, i2, { 7: 101 }), e2(R2, i2, { 7: 102 }), e2(R2, i2, { 7: 103 }), e2(ee2, i2, { 40: 104, 7: 105 }), e2(z2, i2, { 42: 106, 7: 107 }), e2(z2, i2, { 7: 107, 42: 108 }), e2(te2, i2, { 45: 109, 7: 110 }), e2(R2, i2, { 7: 111 }), { 5: [1, 113], 51: [1, 112] }, { 5: [1, 114] }, e2([5, 51], I2, { 72: 115, 73: [1, 116] }), { 5: [1, 118], 51: [1, 117] }, { 5: [1, 119] }, { 22: 122, 69: [1, 120], 70: [1, 121], 71: P2 }, e2(B2, [2, 72]), e2(B2, [2, 73]), e2(B2, [2, 74]), e2(B2, [2, 75]), e2(B2, [2, 76]), e2(B2, [2, 77]), e2(B2, [2, 78]), e2(B2, [2, 79]), e2(B2, [2, 80]), e2(B2, [2, 81]), { 22: 123, 71: P2 }, { 22: 125, 59: 124, 71: P2 }, { 71: [2, 64] }, { 71: [2, 65] }, { 57: 126, 86: V2 }, { 57: 128, 86: V2 }, { 57: 129, 86: V2 }, { 57: 130, 86: V2 }, { 4: [1, 133], 5: [1, 135], 11: 132, 12: 134, 16: [1, 131], 50: E2, 52: D2, 53: O2 }, { 5: [1, 136] }, e2(F2, [2, 19]), e2(F2, [2, 20]), e2(F2, [2, 22]), e2(F2, [2, 23]), { 4: a2, 5: o2, 8: 8, 9: 10, 12: 12, 13: s2, 14: c2, 16: [1, 137], 17: 15, 18: l2, 21: u2, 22: 40, 23: d2, 24: 19, 25: 20, 26: 21, 27: 22, 28: 23, 29: f2, 30: p2, 31: m2, 33: h2, 35: g2, 36: _2, 37: v2, 38: b2, 39: x2, 41: S2, 43: C2, 44: w2, 46: T2, 50: E2, 52: D2, 53: O2, 55: k2, 60: A2, 61: j2, 62: M2, 63: N2, 71: P2 }, { 4: a2, 5: o2, 8: 8, 9: 10, 12: 12, 13: s2, 14: c2, 16: [1, 138], 17: 15, 18: l2, 21: u2, 22: 40, 23: d2, 24: 19, 25: 20, 26: 21, 27: 22, 28: 23, 29: f2, 30: p2, 31: m2, 33: h2, 35: g2, 36: _2, 37: v2, 38: b2, 39: x2, 41: S2, 43: C2, 44: w2, 46: T2, 50: E2, 52: D2, 53: O2, 55: k2, 60: A2, 61: j2, 62: M2, 63: N2, 71: P2 }, { 4: a2, 5: o2, 8: 8, 9: 10, 12: 12, 13: s2, 14: c2, 16: [1, 139], 17: 15, 18: l2, 21: u2, 22: 40, 23: d2, 24: 19, 25: 20, 26: 21, 27: 22, 28: 23, 29: f2, 30: p2, 31: m2, 33: h2, 35: g2, 36: _2, 37: v2, 38: b2, 39: x2, 41: S2, 43: C2, 44: w2, 46: T2, 50: E2, 52: D2, 53: O2, 55: k2, 60: A2, 61: j2, 62: M2, 63: N2, 71: P2 }, { 16: [1, 140] }, { 4: a2, 5: o2, 8: 8, 9: 10, 12: 12, 13: s2, 14: c2, 16: [2, 46], 17: 15, 18: l2, 21: u2, 22: 40, 23: d2, 24: 19, 25: 20, 26: 21, 27: 22, 28: 23, 29: f2, 30: p2, 31: m2, 33: h2, 35: g2, 36: _2, 37: v2, 38: b2, 39: x2, 41: S2, 43: C2, 44: w2, 46: T2, 49: [1, 141], 50: E2, 52: D2, 53: O2, 55: k2, 60: A2, 61: j2, 62: M2, 63: N2, 71: P2 }, { 16: [1, 142] }, { 4: a2, 5: o2, 8: 8, 9: 10, 12: 12, 13: s2, 14: c2, 16: [2, 44], 17: 15, 18: l2, 21: u2, 22: 40, 23: d2, 24: 19, 25: 20, 26: 21, 27: 22, 28: 23, 29: f2, 30: p2, 31: m2, 33: h2, 35: g2, 36: _2, 37: v2, 38: b2, 39: x2, 41: S2, 43: C2, 44: w2, 46: T2, 48: [1, 143], 50: E2, 52: D2, 53: O2, 55: k2, 60: A2, 61: j2, 62: M2, 63: N2, 71: P2 }, { 16: [1, 144] }, { 16: [1, 145] }, { 4: a2, 5: o2, 8: 8, 9: 10, 12: 12, 13: s2, 14: c2, 16: [2, 42], 17: 15, 18: l2, 21: u2, 22: 40, 23: d2, 24: 19, 25: 20, 26: 21, 27: 22, 28: 23, 29: f2, 30: p2, 31: m2, 33: h2, 35: g2, 36: _2, 37: v2, 38: b2, 39: x2, 41: S2, 43: C2, 44: w2, 46: T2, 47: [1, 146], 50: E2, 52: D2, 53: O2, 55: k2, 60: A2, 61: j2, 62: M2, 63: N2, 71: P2 }, { 4: a2, 5: o2, 8: 8, 9: 10, 12: 12, 13: s2, 14: c2, 16: [1, 147], 17: 15, 18: l2, 21: u2, 22: 40, 23: d2, 24: 19, 25: 20, 26: 21, 27: 22, 28: 23, 29: f2, 30: p2, 31: m2, 33: h2, 35: g2, 36: _2, 37: v2, 38: b2, 39: x2, 41: S2, 43: C2, 44: w2, 46: T2, 50: E2, 52: D2, 53: O2, 55: k2, 60: A2, 61: j2, 62: M2, 63: N2, 71: P2 }, { 15: [1, 148] }, e2(F2, [2, 49]), e2(F2, [2, 53]), { 5: [2, 69] }, { 74: [1, 149] }, { 15: [1, 150] }, e2(F2, [2, 51]), e2(F2, [2, 52]), { 22: 151, 71: P2 }, { 22: 152, 71: P2 }, { 57: 153, 86: V2 }, { 57: 154, 86: V2 }, { 57: 155, 86: V2 }, { 65: [1, 156], 86: [2, 63] }, { 5: [2, 56] }, { 5: [2, 82] }, { 5: [2, 57] }, { 5: [2, 58] }, { 5: [2, 59] }, e2(F2, [2, 16]), e2(L2, [2, 10]), { 12: 157, 50: E2, 52: D2, 53: O2 }, e2(L2, [2, 12]), e2(L2, [2, 13]), e2(F2, [2, 18]), e2(F2, [2, 34]), e2(F2, [2, 35]), e2(F2, [2, 36]), e2(F2, [2, 37]), { 15: [1, 158] }, e2(F2, [2, 38]), { 15: [1, 159] }, e2(F2, [2, 39]), e2(F2, [2, 40]), { 15: [1, 160] }, e2(F2, [2, 41]), { 5: [1, 161] }, { 75: [1, 162] }, { 5: [1, 163] }, { 57: 164, 86: V2 }, { 57: 165, 86: V2 }, { 5: [2, 68] }, { 5: [2, 54] }, { 5: [2, 55] }, { 22: 166, 71: P2 }, e2(L2, [2, 11]), e2(ee2, i2, { 7: 105, 40: 167 }), e2(z2, i2, { 7: 107, 42: 168 }), e2(te2, i2, { 7: 110, 45: 169 }), e2(F2, [2, 48]), { 5: [2, 70] }, e2(F2, [2, 50]), { 5: [2, 66] }, { 5: [2, 67] }, { 86: [2, 62] }, { 16: [2, 47] }, { 16: [2, 45] }, { 16: [2, 43] }], defaultActions: { 5: [2, 1], 6: [2, 2], 89: [2, 64], 90: [2, 65], 115: [2, 69], 126: [2, 56], 127: [2, 82], 128: [2, 57], 129: [2, 58], 130: [2, 59], 153: [2, 68], 154: [2, 54], 155: [2, 55], 162: [2, 70], 164: [2, 66], 165: [2, 67], 166: [2, 62], 167: [2, 47], 168: [2, 45], 169: [2, 43] }, parseError: y(function(e3, t3) {
    if (t3.recoverable) this.trace(e3);
    else {
      var n3 = Error(e3);
      throw n3.hash = t3, n3;
    }
  }, `parseError`), parse: y(function(e3) {
    var t3 = this, n3 = [0], r3 = [], i3 = [null], a3 = [], o3 = this.table, s3 = ``, c3 = 0, l3 = 0, u3 = 0, d3 = 2, f3 = 1, p3 = a3.slice.call(arguments, 1), m3 = Object.create(this.lexer), h3 = { yy: {} };
    for (var g3 in this.yy) Object.prototype.hasOwnProperty.call(this.yy, g3) && (h3.yy[g3] = this.yy[g3]);
    m3.setInput(e3, h3.yy), h3.yy.lexer = m3, h3.yy.parser = this, m3.yylloc === void 0 && (m3.yylloc = {});
    var _3 = m3.yylloc;
    a3.push(_3);
    var v3 = m3.options && m3.options.ranges;
    typeof h3.yy.parseError == `function` ? this.parseError = h3.yy.parseError : this.parseError = Object.getPrototypeOf(this).parseError;
    function b3(e4) {
      n3.length -= 2 * e4, i3.length -= e4, a3.length -= e4;
    }
    y(b3, `popStack`);
    function x3() {
      var e4 = r3.pop() || m3.lex() || f3;
      return typeof e4 != `number` && (e4 instanceof Array && (r3 = e4, e4 = r3.pop()), e4 = t3.symbols_[e4] || e4), e4;
    }
    y(x3, `lex`);
    for (var S3, C3, w3, T3, E3, D3 = {}, O3, k3, A3, j3; ; ) {
      if (w3 = n3[n3.length - 1], this.defaultActions[w3] ? T3 = this.defaultActions[w3] : (S3 ?? (S3 = x3()), T3 = o3[w3] && o3[w3][S3]), T3 === void 0 || !T3.length || !T3[0]) {
        var M3 = ``;
        for (O3 in j3 = [], o3[w3]) this.terminals_[O3] && O3 > d3 && j3.push(`'` + this.terminals_[O3] + `'`);
        M3 = m3.showPosition ? `Parse error on line ` + (c3 + 1) + `:
` + m3.showPosition() + `
Expecting ` + j3.join(`, `) + `, got '` + (this.terminals_[S3] || S3) + `'` : `Parse error on line ` + (c3 + 1) + `: Unexpected ` + (S3 == f3 ? `end of input` : `'` + (this.terminals_[S3] || S3) + `'`), this.parseError(M3, { text: m3.match, token: this.terminals_[S3] || S3, line: m3.yylineno, loc: _3, expected: j3 });
      }
      if (T3[0] instanceof Array && T3.length > 1) throw Error(`Parse Error: multiple actions possible at state: ` + w3 + `, token: ` + S3);
      switch (T3[0]) {
        case 1:
          n3.push(S3), i3.push(m3.yytext), a3.push(m3.yylloc), n3.push(T3[1]), S3 = null, C3 ? (S3 = C3, C3 = null) : (l3 = m3.yyleng, s3 = m3.yytext, c3 = m3.yylineno, _3 = m3.yylloc, u3 > 0 && u3--);
          break;
        case 2:
          if (k3 = this.productions_[T3[1]][1], D3.$ = i3[i3.length - k3], D3._$ = { first_line: a3[a3.length - (k3 || 1)].first_line, last_line: a3[a3.length - 1].last_line, first_column: a3[a3.length - (k3 || 1)].first_column, last_column: a3[a3.length - 1].last_column }, v3 && (D3._$.range = [a3[a3.length - (k3 || 1)].range[0], a3[a3.length - 1].range[1]]), E3 = this.performAction.apply(D3, [s3, l3, c3, h3.yy, T3[1], i3, a3].concat(p3)), E3 !== void 0) return E3;
          k3 && (n3 = n3.slice(0, -1 * k3 * 2), i3 = i3.slice(0, -1 * k3), a3 = a3.slice(0, -1 * k3)), n3.push(this.productions_[T3[1]][0]), i3.push(D3.$), a3.push(D3._$), A3 = o3[n3[n3.length - 2]][n3[n3.length - 1]], n3.push(A3);
          break;
        case 3:
          return true;
      }
    }
    return true;
  }, `parse`) };
  H2.lexer = (function() {
    return { EOF: 1, parseError: y(function(e3, t3) {
      if (this.yy.parser) this.yy.parser.parseError(e3, t3);
      else throw Error(e3);
    }, `parseError`), setInput: y(function(e3, t3) {
      return this.yy = t3 || this.yy || {}, this._input = e3, this._more = this._backtrack = this.done = false, this.yylineno = this.yyleng = 0, this.yytext = this.matched = this.match = ``, this.conditionStack = [`INITIAL`], this.yylloc = { first_line: 1, first_column: 0, last_line: 1, last_column: 0 }, this.options.ranges && (this.yylloc.range = [0, 0]), this.offset = 0, this;
    }, `setInput`), input: y(function() {
      var e3 = this._input[0];
      return this.yytext += e3, this.yyleng++, this.offset++, this.match += e3, this.matched += e3, e3.match(/(?:\r\n?|\n).*/g) ? (this.yylineno++, this.yylloc.last_line++) : this.yylloc.last_column++, this.options.ranges && this.yylloc.range[1]++, this._input = this._input.slice(1), e3;
    }, `input`), unput: y(function(e3) {
      var t3 = e3.length, n3 = e3.split(/(?:\r\n?|\n)/g);
      this._input = e3 + this._input, this.yytext = this.yytext.substr(0, this.yytext.length - t3), this.offset -= t3;
      var r3 = this.match.split(/(?:\r\n?|\n)/g);
      this.match = this.match.substr(0, this.match.length - 1), this.matched = this.matched.substr(0, this.matched.length - 1), n3.length - 1 && (this.yylineno -= n3.length - 1);
      var i3 = this.yylloc.range;
      return this.yylloc = { first_line: this.yylloc.first_line, last_line: this.yylineno + 1, first_column: this.yylloc.first_column, last_column: n3 ? (n3.length === r3.length ? this.yylloc.first_column : 0) + r3[r3.length - n3.length].length - n3[0].length : this.yylloc.first_column - t3 }, this.options.ranges && (this.yylloc.range = [i3[0], i3[0] + this.yyleng - t3]), this.yyleng = this.yytext.length, this;
    }, `unput`), more: y(function() {
      return this._more = true, this;
    }, `more`), reject: y(function() {
      if (this.options.backtrack_lexer) this._backtrack = true;
      else return this.parseError(`Lexical error on line ` + (this.yylineno + 1) + `. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
` + this.showPosition(), { text: ``, token: null, line: this.yylineno });
      return this;
    }, `reject`), less: y(function(e3) {
      this.unput(this.match.slice(e3));
    }, `less`), pastInput: y(function() {
      var e3 = this.matched.substr(0, this.matched.length - this.match.length);
      return (e3.length > 20 ? `...` : ``) + e3.substr(-20).replace(/\n/g, ``);
    }, `pastInput`), upcomingInput: y(function() {
      var e3 = this.match;
      return e3.length < 20 && (e3 += this._input.substr(0, 20 - e3.length)), (e3.substr(0, 20) + (e3.length > 20 ? `...` : ``)).replace(/\n/g, ``);
    }, `upcomingInput`), showPosition: y(function() {
      var e3 = this.pastInput(), t3 = Array(e3.length + 1).join(`-`);
      return e3 + this.upcomingInput() + `
` + t3 + `^`;
    }, `showPosition`), test_match: y(function(e3, t3) {
      var n3, r3, i3;
      if (this.options.backtrack_lexer && (i3 = { yylineno: this.yylineno, yylloc: { first_line: this.yylloc.first_line, last_line: this.last_line, first_column: this.yylloc.first_column, last_column: this.yylloc.last_column }, yytext: this.yytext, match: this.match, matches: this.matches, matched: this.matched, yyleng: this.yyleng, offset: this.offset, _more: this._more, _input: this._input, yy: this.yy, conditionStack: this.conditionStack.slice(0), done: this.done }, this.options.ranges && (i3.yylloc.range = this.yylloc.range.slice(0))), r3 = e3[0].match(/(?:\r\n?|\n).*/g), r3 && (this.yylineno += r3.length), this.yylloc = { first_line: this.yylloc.last_line, last_line: this.yylineno + 1, first_column: this.yylloc.last_column, last_column: r3 ? r3[r3.length - 1].length - r3[r3.length - 1].match(/\r?\n?/)[0].length : this.yylloc.last_column + e3[0].length }, this.yytext += e3[0], this.match += e3[0], this.matches = e3, this.yyleng = this.yytext.length, this.options.ranges && (this.yylloc.range = [this.offset, this.offset += this.yyleng]), this._more = false, this._backtrack = false, this._input = this._input.slice(e3[0].length), this.matched += e3[0], n3 = this.performAction.call(this, this.yy, this, t3, this.conditionStack[this.conditionStack.length - 1]), this.done && this._input && (this.done = false), n3) return n3;
      if (this._backtrack) {
        for (var a3 in i3) this[a3] = i3[a3];
        return false;
      }
      return false;
    }, `test_match`), next: y(function() {
      if (this.done) return this.EOF;
      this._input || (this.done = true);
      var e3, t3, n3, r3;
      this._more || (this.yytext = ``, this.match = ``);
      for (var i3 = this._currentRules(), a3 = 0; a3 < i3.length; a3++) if (n3 = this._input.match(this.rules[i3[a3]]), n3 && (!t3 || n3[0].length > t3[0].length)) {
        if (t3 = n3, r3 = a3, this.options.backtrack_lexer) {
          if (e3 = this.test_match(n3, i3[a3]), e3 !== false) return e3;
          if (this._backtrack) {
            t3 = false;
            continue;
          } else return false;
        } else if (!this.options.flex) break;
      }
      return t3 ? (e3 = this.test_match(t3, i3[r3]), e3 === false ? false : e3) : this._input === `` ? this.EOF : this.parseError(`Lexical error on line ` + (this.yylineno + 1) + `. Unrecognized text.
` + this.showPosition(), { text: ``, token: null, line: this.yylineno });
    }, `next`), lex: y(function() {
      return this.next() || this.lex();
    }, `lex`), begin: y(function(e3) {
      this.conditionStack.push(e3);
    }, `begin`), popState: y(function() {
      return this.conditionStack.length - 1 > 0 ? this.conditionStack.pop() : this.conditionStack[0];
    }, `popState`), _currentRules: y(function() {
      return this.conditionStack.length && this.conditionStack[this.conditionStack.length - 1] ? this.conditions[this.conditionStack[this.conditionStack.length - 1]].rules : this.conditions.INITIAL.rules;
    }, `_currentRules`), topState: y(function(e3) {
      return e3 = this.conditionStack.length - 1 - Math.abs(e3 || 0), e3 >= 0 ? this.conditionStack[e3] : `INITIAL`;
    }, `topState`), pushState: y(function(e3) {
      this.begin(e3);
    }, `pushState`), stateStackSize: y(function() {
      return this.conditionStack.length;
    }, `stateStackSize`), options: { "case-insensitive": true }, performAction: y(function(e3, t3, n3, r3) {
      switch (n3) {
        case 0:
          return 5;
        case 1:
          break;
        case 2:
          break;
        case 3:
          break;
        case 4:
          break;
        case 5:
          break;
        case 6:
          return 19;
        case 7:
          return this.begin(`CONFIG`), 73;
        case 8:
          return 74;
        case 9:
          return this.popState(), this.popState(), 75;
        case 10:
          return t3.yytext = t3.yytext.trim(), 71;
        case 11:
          return t3.yytext = t3.yytext.trim(), this.begin(`ALIAS`), 71;
        case 12:
          return this.begin(`LINE`), 14;
        case 13:
          return this.begin(`ID`), 50;
        case 14:
          return this.begin(`ID`), 52;
        case 15:
          return 13;
        case 16:
          return this.begin(`ID`), 53;
        case 17:
          return t3.yytext = t3.yytext.trim(), this.begin(`ALIAS`), 71;
        case 18:
          return this.popState(), this.popState(), this.begin(`LINE`), 51;
        case 19:
          return this.popState(), this.popState(), 5;
        case 20:
          return this.begin(`LINE`), 36;
        case 21:
          return this.begin(`LINE`), 37;
        case 22:
          return this.begin(`LINE`), 38;
        case 23:
          return this.begin(`LINE`), 39;
        case 24:
          return this.begin(`LINE`), 49;
        case 25:
          return this.begin(`LINE`), 41;
        case 26:
          return this.begin(`LINE`), 43;
        case 27:
          return this.begin(`LINE`), 48;
        case 28:
          return this.begin(`LINE`), 44;
        case 29:
          return this.begin(`LINE`), 47;
        case 30:
          return this.begin(`LINE`), 46;
        case 31:
          return this.popState(), 15;
        case 32:
          return 16;
        case 33:
          return 66;
        case 34:
          return 67;
        case 35:
          return 60;
        case 36:
          return 61;
        case 37:
          return 62;
        case 38:
          return 63;
        case 39:
          return 58;
        case 40:
          return 55;
        case 41:
          return this.begin(`ID`), 21;
        case 42:
          return this.begin(`ID`), 23;
        case 43:
          return 29;
        case 44:
          return 30;
        case 45:
          return this.begin(`acc_title`), 31;
        case 46:
          return this.popState(), `acc_title_value`;
        case 47:
          return this.begin(`acc_descr`), 33;
        case 48:
          return this.popState(), `acc_descr_value`;
        case 49:
          this.begin(`acc_descr_multiline`);
          break;
        case 50:
          this.popState();
          break;
        case 51:
          return `acc_descr_multiline_value`;
        case 52:
          return 6;
        case 53:
          return 18;
        case 54:
          return 20;
        case 55:
          return 65;
        case 56:
          return 5;
        case 57:
          return t3.yytext = t3.yytext.trim(), 71;
        case 58:
          return 78;
        case 59:
          return 79;
        case 60:
          return 80;
        case 61:
          return 81;
        case 62:
          return 76;
        case 63:
          return 77;
        case 64:
          return 82;
        case 65:
          return 83;
        case 66:
          return 84;
        case 67:
          return 85;
        case 68:
          return 86;
        case 69:
          return 86;
        case 70:
          return 69;
        case 71:
          return 70;
        case 72:
          return 5;
        case 73:
          return `INVALID`;
      }
    }, `anonymous`), rules: [/^(?:[\n]+)/i, /^(?:\s+)/i, /^(?:((?!\n)\s)+)/i, /^(?:#[^\n]*)/i, /^(?:%(?!\{)[^\n]*)/i, /^(?:[^\}]%%[^\n]*)/i, /^(?:[0-9]+(?=[ \n]+))/i, /^(?:@\{)/i, /^(?:[^\}]+)/i, /^(?:\})/i, /^(?:[^\<->\->:\n,;@\s]+(?=@\{))/i, /^(?:[^\<->\->:\n,;@]+?([\-]*[^\<->\->:\n,;@]+?)*?(?=((?!\n)\s)+as(?!\n)\s|[#\n;]|$))/i, /^(?:box\b)/i, /^(?:participant\b)/i, /^(?:actor\b)/i, /^(?:create\b)/i, /^(?:destroy\b)/i, /^(?:[^<\->\->:\n,;]+?([\-]*[^<\->\->:\n,;]+?)*?(?=((?!\n)\s)+as(?!\n)\s|[#\n;]|$))/i, /^(?:as\b)/i, /^(?:(?:))/i, /^(?:loop\b)/i, /^(?:rect\b)/i, /^(?:opt\b)/i, /^(?:alt\b)/i, /^(?:else\b)/i, /^(?:par\b)/i, /^(?:par_over\b)/i, /^(?:and\b)/i, /^(?:critical\b)/i, /^(?:option\b)/i, /^(?:break\b)/i, /^(?:(?:[:]?(?:no)?wrap)?[^#\n;]*)/i, /^(?:end\b)/i, /^(?:left of\b)/i, /^(?:right of\b)/i, /^(?:links\b)/i, /^(?:link\b)/i, /^(?:properties\b)/i, /^(?:details\b)/i, /^(?:over\b)/i, /^(?:note\b)/i, /^(?:activate\b)/i, /^(?:deactivate\b)/i, /^(?:title\s[^#\n;]+)/i, /^(?:title:\s[^#\n;]+)/i, /^(?:accTitle\s*:\s*)/i, /^(?:(?!\n||)*[^\n]*)/i, /^(?:accDescr\s*:\s*)/i, /^(?:(?!\n||)*[^\n]*)/i, /^(?:accDescr\s*\{\s*)/i, /^(?:[\}])/i, /^(?:[^\}]*)/i, /^(?:sequenceDiagram\b)/i, /^(?:autonumber\b)/i, /^(?:off\b)/i, /^(?:,)/i, /^(?:;)/i, /^(?:[^+<\->\->:\n,;]+((?!(-x|--x|-\)|--\)))[\-]*[^\+<\->\->:\n,;]+)*)/i, /^(?:->>)/i, /^(?:<<->>)/i, /^(?:-->>)/i, /^(?:<<-->>)/i, /^(?:->)/i, /^(?:-->)/i, /^(?:-[x])/i, /^(?:--[x])/i, /^(?:-[\)])/i, /^(?:--[\)])/i, /^(?::(?:(?:no)?wrap)?[^#\n;]*)/i, /^(?::)/i, /^(?:\+)/i, /^(?:-)/i, /^(?:$)/i, /^(?:.)/i], conditions: { acc_descr_multiline: { rules: [50, 51], inclusive: false }, acc_descr: { rules: [48], inclusive: false }, acc_title: { rules: [46], inclusive: false }, ID: { rules: [2, 3, 7, 10, 11, 17], inclusive: false }, ALIAS: { rules: [2, 3, 18, 19], inclusive: false }, LINE: { rules: [2, 3, 31], inclusive: false }, CONFIG: { rules: [8, 9], inclusive: false }, CONFIG_DATA: { rules: [], inclusive: false }, INITIAL: { rules: [0, 1, 3, 4, 5, 6, 12, 13, 14, 15, 16, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 47, 49, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73], inclusive: true } } };
  })();
  function U2() {
    this.yy = {};
  }
  return y(U2, `Parser`), U2.prototype = H2, H2.Parser = U2, new U2();
})();
F.parser = F;
var I = F, L = { SOLID: 0, DOTTED: 1, NOTE: 2, SOLID_CROSS: 3, DOTTED_CROSS: 4, SOLID_OPEN: 5, DOTTED_OPEN: 6, LOOP_START: 10, LOOP_END: 11, ALT_START: 12, ALT_ELSE: 13, ALT_END: 14, OPT_START: 15, OPT_END: 16, ACTIVE_START: 17, ACTIVE_END: 18, PAR_START: 19, PAR_AND: 20, PAR_END: 21, RECT_START: 22, RECT_END: 23, SOLID_POINT: 24, DOTTED_POINT: 25, AUTONUMBER: 26, CRITICAL_START: 27, CRITICAL_OPTION: 28, CRITICAL_END: 29, BREAK_START: 30, BREAK_END: 31, PAR_OVER_START: 32, BIDIRECTIONAL_SOLID: 33, BIDIRECTIONAL_DOTTED: 34 }, R = { FILLED: 0, OPEN: 1 }, ee = { LEFTOF: 0, RIGHTOF: 1, OVER: 2 }, z = { ACTOR: `actor`, BOUNDARY: `boundary`, COLLECTIONS: `collections`, CONTROL: `control`, DATABASE: `database`, ENTITY: `entity`, PARTICIPANT: `participant`, QUEUE: `queue` }, te = (_a = class {
  constructor() {
    this.state = new N(() => ({ prevActor: void 0, actors: /* @__PURE__ */ new Map(), createdActors: /* @__PURE__ */ new Map(), destroyedActors: /* @__PURE__ */ new Map(), boxes: [], messages: [], notes: [], sequenceNumbersEnabled: false, wrapEnabled: void 0, currentBox: void 0, lastCreated: void 0, lastDestroyed: void 0 })), this.setAccTitle = e, this.setAccDescription = _, this.setDiagramTitle = s, this.getAccTitle = h, this.getAccDescription = c, this.getDiagramTitle = t, this.apply = this.apply.bind(this), this.parseBoxData = this.parseBoxData.bind(this), this.parseMessage = this.parseMessage.bind(this), this.clear(), this.setWrap(u().wrap), this.LINETYPE = L, this.ARROWTYPE = R, this.PLACEMENT = ee;
  }
  addBox(e2) {
    this.state.records.boxes.push({ name: e2.text, wrap: e2.wrap ?? this.autoWrap(), fill: e2.color, actorKeys: [] }), this.state.records.currentBox = this.state.records.boxes.slice(-1)[0];
  }
  addActor(e2, t2, n2, r2, i2) {
    let a2 = this.state.records.currentBox, o2;
    if (i2 !== void 0) {
      let e3;
      e3 = i2.includes(`
`) ? i2 + `
` : `{
` + i2 + `
}`, o2 = w(e3, { schema: T });
    }
    r2 = (o2 == null ? void 0 : o2.type) ?? r2;
    let s2 = this.state.records.actors.get(e2);
    if (s2) {
      if (this.state.records.currentBox && s2.box && this.state.records.currentBox !== s2.box) throw Error(`A same participant should only be defined in one Box: ${s2.name} can't be in '${s2.box.name}' and in '${this.state.records.currentBox.name}' at the same time.`);
      if (a2 = s2.box ? s2.box : this.state.records.currentBox, s2.box = a2, s2 && t2 === s2.name && n2 == null) return;
    }
    if ((n2 == null ? void 0 : n2.text) ?? (n2 = { text: t2, type: r2 }), (r2 == null || n2.text == null) && (n2 = { text: t2, type: r2 }), this.state.records.actors.set(e2, { box: a2, name: t2, description: n2.text, wrap: n2.wrap ?? this.autoWrap(), prevActor: this.state.records.prevActor, links: {}, properties: {}, actorCnt: null, rectData: null, type: r2 ?? `participant` }), this.state.records.prevActor) {
      let t3 = this.state.records.actors.get(this.state.records.prevActor);
      t3 && (t3.nextActor = e2);
    }
    this.state.records.currentBox && this.state.records.currentBox.actorKeys.push(e2), this.state.records.prevActor = e2;
  }
  activationCount(e2) {
    let t2, n2 = 0;
    if (!e2) return 0;
    for (t2 = 0; t2 < this.state.records.messages.length; t2++) this.state.records.messages[t2].type === this.LINETYPE.ACTIVE_START && this.state.records.messages[t2].from === e2 && n2++, this.state.records.messages[t2].type === this.LINETYPE.ACTIVE_END && this.state.records.messages[t2].from === e2 && n2--;
    return n2;
  }
  addMessage(e2, t2, n2, r2) {
    this.state.records.messages.push({ id: this.state.records.messages.length.toString(), from: e2, to: t2, message: n2.text, wrap: n2.wrap ?? this.autoWrap(), answer: r2 });
  }
  addSignal(e2, t2, n2, r2, i2 = false) {
    if (r2 === this.LINETYPE.ACTIVE_END && this.activationCount(e2 ?? ``) < 1) {
      let t3 = Error(`Trying to inactivate an inactive participant (` + e2 + `)`);
      throw t3.hash = { text: `->>-`, token: `->>-`, line: `1`, loc: { first_line: 1, last_line: 1, first_column: 1, last_column: 1 }, expected: [`'ACTIVE_PARTICIPANT'`] }, t3;
    }
    return this.state.records.messages.push({ id: this.state.records.messages.length.toString(), from: e2, to: t2, message: (n2 == null ? void 0 : n2.text) ?? ``, wrap: (n2 == null ? void 0 : n2.wrap) ?? this.autoWrap(), type: r2, activate: i2 }), true;
  }
  hasAtLeastOneBox() {
    return this.state.records.boxes.length > 0;
  }
  hasAtLeastOneBoxWithTitle() {
    return this.state.records.boxes.some((e2) => e2.name);
  }
  getMessages() {
    return this.state.records.messages;
  }
  getBoxes() {
    return this.state.records.boxes;
  }
  getActors() {
    return this.state.records.actors;
  }
  getCreatedActors() {
    return this.state.records.createdActors;
  }
  getDestroyedActors() {
    return this.state.records.destroyedActors;
  }
  getActor(e2) {
    return this.state.records.actors.get(e2);
  }
  getActorKeys() {
    return [...this.state.records.actors.keys()];
  }
  enableSequenceNumbers() {
    this.state.records.sequenceNumbersEnabled = true;
  }
  disableSequenceNumbers() {
    this.state.records.sequenceNumbersEnabled = false;
  }
  showSequenceNumbers() {
    return this.state.records.sequenceNumbersEnabled;
  }
  setWrap(e2) {
    this.state.records.wrapEnabled = e2;
  }
  extractWrap(e2) {
    if (e2 === void 0) return {};
    e2 = e2.trim();
    let t2 = /^:?wrap:/.exec(e2) === null ? /^:?nowrap:/.exec(e2) === null ? void 0 : false : true;
    return { cleanedText: (t2 === void 0 ? e2 : e2.replace(/^:?(?:no)?wrap:/, ``)).trim(), wrap: t2 };
  }
  autoWrap() {
    var _a2;
    return this.state.records.wrapEnabled === void 0 ? ((_a2 = u().sequence) == null ? void 0 : _a2.wrap) ?? false : this.state.records.wrapEnabled;
  }
  clear() {
    this.state.reset(), l();
  }
  parseMessage(e2) {
    let t2 = e2.trim(), { wrap: n2, cleanedText: r2 } = this.extractWrap(t2), i2 = { text: r2, wrap: n2 };
    return v.debug(`parseMessage: ${JSON.stringify(i2)}`), i2;
  }
  parseBoxData(e2) {
    let t2 = /^((?:rgba?|hsla?)\s*\(.*\)|\w*)(.*)$/.exec(e2), n2 = (t2 == null ? void 0 : t2[1]) ? t2[1].trim() : `transparent`, r2 = (t2 == null ? void 0 : t2[2]) ? t2[2].trim() : void 0;
    if (window == null ? void 0 : window.CSS) window.CSS.supports(`color`, n2) || (n2 = `transparent`, r2 = e2.trim());
    else {
      let t3 = new Option().style;
      t3.color = n2, t3.color !== n2 && (n2 = `transparent`, r2 = e2.trim());
    }
    let { wrap: a2, cleanedText: o2 } = this.extractWrap(r2);
    return { text: o2 ? i(o2, u()) : void 0, color: n2, wrap: a2 };
  }
  addNote(e2, t2, n2) {
    let r2 = { actor: e2, placement: t2, message: n2.text, wrap: n2.wrap ?? this.autoWrap() }, i2 = [].concat(e2, e2);
    this.state.records.notes.push(r2), this.state.records.messages.push({ id: this.state.records.messages.length.toString(), from: i2[0], to: i2[1], message: n2.text, wrap: n2.wrap ?? this.autoWrap(), type: this.LINETYPE.NOTE, placement: t2 });
  }
  addLinks(e2, t2) {
    let n2 = this.getActor(e2);
    try {
      let e3 = i(t2.text, u());
      e3 = e3.replace(/&equals;/g, `=`), e3 = e3.replace(/&amp;/g, `&`);
      let r2 = JSON.parse(e3);
      this.insertLinks(n2, r2);
    } catch (e3) {
      v.error(`error while parsing actor link text`, e3);
    }
  }
  addALink(e2, t2) {
    let n2 = this.getActor(e2);
    try {
      let e3 = {}, r2 = i(t2.text, u()), a2 = r2.indexOf(`@`);
      r2 = r2.replace(/&equals;/g, `=`), r2 = r2.replace(/&amp;/g, `&`);
      let o2 = r2.slice(0, a2 - 1).trim();
      e3[o2] = r2.slice(a2 + 1).trim(), this.insertLinks(n2, e3);
    } catch (e3) {
      v.error(`error while parsing actor link text`, e3);
    }
  }
  insertLinks(e2, t2) {
    if (e2.links == null) e2.links = t2;
    else for (let n2 in t2) e2.links[n2] = t2[n2];
  }
  addProperties(e2, t2) {
    let n2 = this.getActor(e2);
    try {
      let e3 = i(t2.text, u()), r2 = JSON.parse(e3);
      this.insertProperties(n2, r2);
    } catch (e3) {
      v.error(`error while parsing actor properties text`, e3);
    }
  }
  insertProperties(e2, t2) {
    if (e2.properties == null) e2.properties = t2;
    else for (let n2 in t2) e2.properties[n2] = t2[n2];
  }
  boxEnd() {
    this.state.records.currentBox = void 0;
  }
  addDetails(e2, t2) {
    let n2 = this.getActor(e2), r2 = document.getElementById(t2.text);
    try {
      let e3 = r2.innerHTML, t3 = JSON.parse(e3);
      t3.properties && this.insertProperties(n2, t3.properties), t3.links && this.insertLinks(n2, t3.links);
    } catch (e3) {
      v.error(`error while parsing actor details text`, e3);
    }
  }
  getActorProperty(e2, t2) {
    if ((e2 == null ? void 0 : e2.properties) !== void 0) return e2.properties[t2];
  }
  apply(t2) {
    if (Array.isArray(t2)) t2.forEach((e2) => {
      this.apply(e2);
    });
    else switch (t2.type) {
      case `sequenceIndex`:
        this.state.records.messages.push({ id: this.state.records.messages.length.toString(), from: void 0, to: void 0, message: { start: t2.sequenceIndex, step: t2.sequenceIndexStep, visible: t2.sequenceVisible }, wrap: false, type: t2.signalType });
        break;
      case `addParticipant`:
        this.addActor(t2.actor, t2.actor, t2.description, t2.draw, t2.config);
        break;
      case `createParticipant`:
        if (this.state.records.actors.has(t2.actor)) throw Error(`It is not possible to have actors with the same id, even if one is destroyed before the next is created. Use 'AS' aliases to simulate the behavior`);
        this.state.records.lastCreated = t2.actor, this.addActor(t2.actor, t2.actor, t2.description, t2.draw, t2.config), this.state.records.createdActors.set(t2.actor, this.state.records.messages.length);
        break;
      case `destroyParticipant`:
        this.state.records.lastDestroyed = t2.actor, this.state.records.destroyedActors.set(t2.actor, this.state.records.messages.length);
        break;
      case `activeStart`:
        this.addSignal(t2.actor, void 0, void 0, t2.signalType);
        break;
      case `activeEnd`:
        this.addSignal(t2.actor, void 0, void 0, t2.signalType);
        break;
      case `addNote`:
        this.addNote(t2.actor, t2.placement, t2.text);
        break;
      case `addLinks`:
        this.addLinks(t2.actor, t2.text);
        break;
      case `addALink`:
        this.addALink(t2.actor, t2.text);
        break;
      case `addProperties`:
        this.addProperties(t2.actor, t2.text);
        break;
      case `addDetails`:
        this.addDetails(t2.actor, t2.text);
        break;
      case `addMessage`:
        if (this.state.records.lastCreated) {
          if (t2.to !== this.state.records.lastCreated) throw Error(`The created participant ` + this.state.records.lastCreated.name + ` does not have an associated creating message after its declaration. Please check the sequence diagram.`);
          this.state.records.lastCreated = void 0;
        } else if (this.state.records.lastDestroyed) {
          if (t2.to !== this.state.records.lastDestroyed && t2.from !== this.state.records.lastDestroyed) throw Error(`The destroyed participant ` + this.state.records.lastDestroyed.name + ` does not have an associated destroying message after its declaration. Please check the sequence diagram.`);
          this.state.records.lastDestroyed = void 0;
        }
        this.addSignal(t2.from, t2.to, t2.msg, t2.signalType, t2.activate);
        break;
      case `boxStart`:
        this.addBox(t2.boxData);
        break;
      case `boxEnd`:
        this.boxEnd();
        break;
      case `loopStart`:
        this.addSignal(void 0, void 0, t2.loopText, t2.signalType);
        break;
      case `loopEnd`:
        this.addSignal(void 0, void 0, void 0, t2.signalType);
        break;
      case `rectStart`:
        this.addSignal(void 0, void 0, t2.color, t2.signalType);
        break;
      case `rectEnd`:
        this.addSignal(void 0, void 0, void 0, t2.signalType);
        break;
      case `optStart`:
        this.addSignal(void 0, void 0, t2.optText, t2.signalType);
        break;
      case `optEnd`:
        this.addSignal(void 0, void 0, void 0, t2.signalType);
        break;
      case `altStart`:
        this.addSignal(void 0, void 0, t2.altText, t2.signalType);
        break;
      case `else`:
        this.addSignal(void 0, void 0, t2.altText, t2.signalType);
        break;
      case `altEnd`:
        this.addSignal(void 0, void 0, void 0, t2.signalType);
        break;
      case `setAccTitle`:
        e(t2.text);
        break;
      case `parStart`:
        this.addSignal(void 0, void 0, t2.parText, t2.signalType);
        break;
      case `and`:
        this.addSignal(void 0, void 0, t2.parText, t2.signalType);
        break;
      case `parEnd`:
        this.addSignal(void 0, void 0, void 0, t2.signalType);
        break;
      case `criticalStart`:
        this.addSignal(void 0, void 0, t2.criticalText, t2.signalType);
        break;
      case `option`:
        this.addSignal(void 0, void 0, t2.optionText, t2.signalType);
        break;
      case `criticalEnd`:
        this.addSignal(void 0, void 0, void 0, t2.signalType);
        break;
      case `breakStart`:
        this.addSignal(void 0, void 0, t2.breakText, t2.signalType);
        break;
      case `breakEnd`:
        this.addSignal(void 0, void 0, void 0, t2.signalType);
        break;
    }
  }
  getConfig() {
    return u().sequence;
  }
}, y(_a, `SequenceDB`), _a), B = y((e2) => `.actor {
    stroke: ${e2.actorBorder};
    fill: ${e2.actorBkg};
  }

  text.actor > tspan {
    fill: ${e2.actorTextColor};
    stroke: none;
  }

  .actor-line {
    stroke: ${e2.actorLineColor};
  }
  
  .innerArc {
    stroke-width: 1.5;
    stroke-dasharray: none;
  }

  .messageLine0 {
    stroke-width: 1.5;
    stroke-dasharray: none;
    stroke: ${e2.signalColor};
  }

  .messageLine1 {
    stroke-width: 1.5;
    stroke-dasharray: 2, 2;
    stroke: ${e2.signalColor};
  }

  #arrowhead path {
    fill: ${e2.signalColor};
    stroke: ${e2.signalColor};
  }

  .sequenceNumber {
    fill: ${e2.sequenceNumberColor};
  }

  #sequencenumber {
    fill: ${e2.signalColor};
  }

  #crosshead path {
    fill: ${e2.signalColor};
    stroke: ${e2.signalColor};
  }

  .messageText {
    fill: ${e2.signalTextColor};
    stroke: none;
  }

  .labelBox {
    stroke: ${e2.labelBoxBorderColor};
    fill: ${e2.labelBoxBkgColor};
  }

  .labelText, .labelText > tspan {
    fill: ${e2.labelTextColor};
    stroke: none;
  }

  .loopText, .loopText > tspan {
    fill: ${e2.loopTextColor};
    stroke: none;
  }

  .loopLine {
    stroke-width: 2px;
    stroke-dasharray: 2, 2;
    stroke: ${e2.labelBoxBorderColor};
    fill: ${e2.labelBoxBorderColor};
  }

  .note {
    //stroke: #decc93;
    stroke: ${e2.noteBorderColor};
    fill: ${e2.noteBkgColor};
  }

  .noteText, .noteText > tspan {
    fill: ${e2.noteTextColor};
    stroke: none;
  }

  .activation0 {
    fill: ${e2.activationBkgColor};
    stroke: ${e2.activationBorderColor};
  }

  .activation1 {
    fill: ${e2.activationBkgColor};
    stroke: ${e2.activationBorderColor};
  }

  .activation2 {
    fill: ${e2.activationBkgColor};
    stroke: ${e2.activationBorderColor};
  }

  .actorPopupMenu {
    position: absolute;
  }

  .actorPopupMenuPanel {
    position: absolute;
    fill: ${e2.actorBkg};
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    filter: drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));
}
  .actor-man line {
    stroke: ${e2.actorBorder};
    fill: ${e2.actorBkg};
  }
  .actor-man circle, line {
    stroke: ${e2.actorBorder};
    fill: ${e2.actorBkg};
    stroke-width: 2px;
  }

`, `getStyles`), V = 36, H = `actor-top`, U = `actor-bottom`, ne = `actor-box`, W = `actor-man`, re = y(function(e2, t2) {
  return D(e2, t2);
}, `drawRect`), ie = y(function(e2, t2, n2, r2, i2) {
  if (t2.links === void 0 || t2.links === null || Object.keys(t2.links).length === 0) return { height: 0, width: 0 };
  let a2 = t2.links, o2 = t2.actorCnt, s2 = t2.rectData;
  var c2 = `none`;
  i2 && (c2 = `block !important`);
  let l2 = e2.append(`g`);
  l2.attr(`id`, `actor` + o2 + `_popup`), l2.attr(`class`, `actorPopupMenu`), l2.attr(`display`, c2);
  var u2 = ``;
  s2.class !== void 0 && (u2 = ` ` + s2.class);
  let d2 = s2.width > n2 ? s2.width : n2, f2 = l2.append(`rect`);
  if (f2.attr(`class`, `actorPopupMenuPanel` + u2), f2.attr(`x`, s2.x), f2.attr(`y`, s2.height), f2.attr(`fill`, s2.fill), f2.attr(`stroke`, s2.stroke), f2.attr(`width`, d2), f2.attr(`height`, s2.height), f2.attr(`rx`, s2.rx), f2.attr(`ry`, s2.ry), a2 != null) {
    var p2 = 20;
    for (let e3 in a2) {
      var m2 = l2.append(`a`), h2 = (0, P.sanitizeUrl)(a2[e3]);
      m2.attr(`xlink:href`, h2), m2.attr(`target`, `_blank`), Me(r2)(e3, m2, s2.x + 10, s2.height + p2, d2, 20, { class: `actor` }, r2), p2 += 30;
    }
  }
  return f2.attr(`height`, p2), { height: s2.height + p2, width: d2 };
}, `drawPopup`), ae = y(function(e2) {
  return `var pu = document.getElementById('` + e2 + `'); if (pu != null) { pu.style.display = pu.style.display == 'block' ? 'none' : 'block'; }`;
}, `popupMenuToggle`), oe = y(async function(e2, t2, n2 = null) {
  let r2 = e2.append(`foreignObject`), i2 = await a(t2.text, g()), o2 = r2.append(`xhtml:div`).attr(`style`, `width: fit-content;`).attr(`xmlns`, `http://www.w3.org/1999/xhtml`).html(i2).node().getBoundingClientRect();
  if (r2.attr(`height`, Math.round(o2.height)).attr(`width`, Math.round(o2.width)), t2.class === `noteText`) {
    let n3 = e2.node().firstChild;
    n3.setAttribute(`height`, o2.height + 2 * t2.textMargin);
    let i3 = n3.getBBox();
    r2.attr(`x`, Math.round(i3.x + i3.width / 2 - o2.width / 2)).attr(`y`, Math.round(i3.y + i3.height / 2 - o2.height / 2));
  } else if (n2) {
    let { startx: e3, stopx: i3, starty: a2 } = n2;
    if (e3 > i3) {
      let t3 = e3;
      e3 = i3, i3 = t3;
    }
    r2.attr(`x`, Math.round(e3 + Math.abs(e3 - i3) / 2 - o2.width / 2)), t2.class === `loopText` ? r2.attr(`y`, Math.round(a2)) : r2.attr(`y`, Math.round(a2 - o2.height));
  }
  return [r2];
}, `drawKatex`), G = y(function(e2, t2) {
  let n2 = 0, r2 = 0, i2 = t2.text.split(m.lineBreakRegex), [a2, o2] = S(t2.fontSize), s2 = [], c2 = 0, l2 = y(() => t2.y, `yfunc`);
  if (t2.valign !== void 0 && t2.textMargin !== void 0 && t2.textMargin > 0) switch (t2.valign) {
    case `top`:
    case `start`:
      l2 = y(() => Math.round(t2.y + t2.textMargin), `yfunc`);
      break;
    case `middle`:
    case `center`:
      l2 = y(() => Math.round(t2.y + (n2 + r2 + t2.textMargin) / 2), `yfunc`);
      break;
    case `bottom`:
    case `end`:
      l2 = y(() => Math.round(t2.y + (n2 + r2 + 2 * t2.textMargin) - t2.textMargin), `yfunc`);
      break;
  }
  if (t2.anchor !== void 0 && t2.textMargin !== void 0 && t2.width !== void 0) switch (t2.anchor) {
    case `left`:
    case `start`:
      t2.x = Math.round(t2.x + t2.textMargin), t2.anchor = `start`, t2.dominantBaseline = `middle`, t2.alignmentBaseline = `middle`;
      break;
    case `middle`:
    case `center`:
      t2.x = Math.round(t2.x + t2.width / 2), t2.anchor = `middle`, t2.dominantBaseline = `middle`, t2.alignmentBaseline = `middle`;
      break;
    case `right`:
    case `end`:
      t2.x = Math.round(t2.x + t2.width - t2.textMargin), t2.anchor = `end`, t2.dominantBaseline = `middle`, t2.alignmentBaseline = `middle`;
      break;
  }
  for (let [u2, d2] of i2.entries()) {
    t2.textMargin !== void 0 && t2.textMargin === 0 && a2 !== void 0 && (c2 = u2 * a2);
    let i3 = e2.append(`text`);
    i3.attr(`x`, t2.x), i3.attr(`y`, l2()), t2.anchor !== void 0 && i3.attr(`text-anchor`, t2.anchor).attr(`dominant-baseline`, t2.dominantBaseline).attr(`alignment-baseline`, t2.alignmentBaseline), t2.fontFamily !== void 0 && i3.style(`font-family`, t2.fontFamily), o2 !== void 0 && i3.style(`font-size`, o2), t2.fontWeight !== void 0 && i3.style(`font-weight`, t2.fontWeight), t2.fill !== void 0 && i3.attr(`fill`, t2.fill), t2.class !== void 0 && i3.attr(`class`, t2.class), t2.dy === void 0 ? c2 !== 0 && i3.attr(`dy`, c2) : i3.attr(`dy`, t2.dy);
    let f2 = d2 || `\u200B`;
    if (t2.tspan) {
      let e3 = i3.append(`tspan`);
      e3.attr(`x`, t2.x), t2.fill !== void 0 && e3.attr(`fill`, t2.fill), e3.text(f2);
    } else i3.text(f2);
    t2.valign !== void 0 && t2.textMargin !== void 0 && t2.textMargin > 0 && (r2 += (i3._groups || i3)[0][0].getBBox().height, n2 = r2), s2.push(i3);
  }
  return s2;
}, `drawText`), se = y(function(e2, t2) {
  function n2(e3, t3, n3, r3, i2) {
    return e3 + `,` + t3 + ` ` + (e3 + n3) + `,` + t3 + ` ` + (e3 + n3) + `,` + (t3 + r3 - i2) + ` ` + (e3 + n3 - i2 * 1.2) + `,` + (t3 + r3) + ` ` + e3 + `,` + (t3 + r3);
  }
  y(n2, `genPoints`);
  let r2 = e2.append(`polygon`);
  return r2.attr(`points`, n2(t2.x, t2.y, t2.width, t2.height, 7)), r2.attr(`class`, `labelBox`), t2.y += t2.height / 2, G(e2, t2), r2;
}, `drawLabel`), K = -1, ce = y((e2, t2, n2, r2) => {
  e2.select && n2.forEach((n3) => {
    let i2 = t2.get(n3), a2 = e2.select(`#actor` + i2.actorCnt);
    !r2.mirrorActors && i2.stopy ? a2.attr(`y2`, i2.stopy + i2.height / 2) : r2.mirrorActors && a2.attr(`y2`, i2.stopy);
  });
}, `fixLifeLineHeights`), le = y(function(e2, t2, n2, r2) {
  var _a2, _b;
  let i2 = r2 ? t2.stopy : t2.starty, a2 = t2.x + t2.width / 2, s2 = i2 + t2.height, c2 = e2.append(`g`).lower();
  var l2 = c2;
  r2 || (K++, Object.keys(t2.links || {}).length && !n2.forceMenus && l2.attr(`onclick`, ae(`actor${K}_popup`)).attr(`cursor`, `pointer`), l2.append(`line`).attr(`id`, `actor` + K).attr(`x1`, a2).attr(`y1`, s2).attr(`x2`, a2).attr(`y2`, 2e3).attr(`class`, `actor-line 200`).attr(`stroke-width`, `0.5px`).attr(`stroke`, `#999`).attr(`name`, t2.name), l2 = c2.append(`g`), t2.actorCnt = K, t2.links != null && l2.attr(`id`, `root-` + K));
  let u2 = k();
  var d2 = `actor`;
  ((_a2 = t2.properties) == null ? void 0 : _a2.class) ? d2 = t2.properties.class : u2.fill = `#eaeaea`, r2 ? d2 += ` ${U}` : d2 += ` ${H}`, u2.x = t2.x, u2.y = i2, u2.width = t2.width, u2.height = t2.height, u2.class = d2, u2.rx = 3, u2.ry = 3, u2.name = t2.name;
  let f2 = re(l2, u2);
  if (t2.rectData = u2, (_b = t2.properties) == null ? void 0 : _b.icon) {
    let e3 = t2.properties.icon.trim();
    e3.charAt(0) === `@` ? O(l2, u2.x + u2.width - 20, u2.y + 10, e3.substr(1)) : A(l2, u2.x + u2.width - 20, u2.y + 10, e3);
  }
  q(n2, o(t2.description))(t2.description, l2, u2.x, u2.y, u2.width, u2.height, { class: `actor ${ne}` }, n2);
  let p2 = t2.height;
  if (f2.node) {
    let e3 = f2.node().getBBox();
    t2.height = e3.height, p2 = e3.height;
  }
  return p2;
}, `drawActorTypeParticipant`), ue = y(function(e2, t2, n2, r2) {
  var _a2, _b;
  let i2 = r2 ? t2.stopy : t2.starty, a2 = t2.x + t2.width / 2, s2 = i2 + t2.height, c2 = e2.append(`g`).lower();
  var l2 = c2;
  r2 || (K++, Object.keys(t2.links || {}).length && !n2.forceMenus && l2.attr(`onclick`, ae(`actor${K}_popup`)).attr(`cursor`, `pointer`), l2.append(`line`).attr(`id`, `actor` + K).attr(`x1`, a2).attr(`y1`, s2).attr(`x2`, a2).attr(`y2`, 2e3).attr(`class`, `actor-line 200`).attr(`stroke-width`, `0.5px`).attr(`stroke`, `#999`).attr(`name`, t2.name), l2 = c2.append(`g`), t2.actorCnt = K, t2.links != null && l2.attr(`id`, `root-` + K));
  let u2 = k();
  var d2 = `actor`;
  ((_a2 = t2.properties) == null ? void 0 : _a2.class) ? d2 = t2.properties.class : u2.fill = `#eaeaea`, r2 ? d2 += ` ${U}` : d2 += ` ${H}`, u2.x = t2.x, u2.y = i2, u2.width = t2.width, u2.height = t2.height, u2.class = d2, u2.name = t2.name;
  let f2 = { ...u2, x: u2.x + -6, y: u2.y + 6, class: `actor` }, p2 = re(l2, u2);
  if (re(l2, f2), t2.rectData = u2, (_b = t2.properties) == null ? void 0 : _b.icon) {
    let e3 = t2.properties.icon.trim();
    e3.charAt(0) === `@` ? O(l2, u2.x + u2.width - 20, u2.y + 10, e3.substr(1)) : A(l2, u2.x + u2.width - 20, u2.y + 10, e3);
  }
  q(n2, o(t2.description))(t2.description, l2, u2.x - 6, u2.y + 6, u2.width, u2.height, { class: `actor ${ne}` }, n2);
  let m2 = t2.height;
  if (p2.node) {
    let e3 = p2.node().getBBox();
    t2.height = e3.height, m2 = e3.height;
  }
  return m2;
}, `drawActorTypeCollections`), de = y(function(e2, t2, n2, r2) {
  var _a2, _b;
  let i2 = r2 ? t2.stopy : t2.starty, a2 = t2.x + t2.width / 2, s2 = i2 + t2.height, c2 = e2.append(`g`).lower(), l2 = c2;
  r2 || (K++, Object.keys(t2.links || {}).length && !n2.forceMenus && l2.attr(`onclick`, ae(`actor${K}_popup`)).attr(`cursor`, `pointer`), l2.append(`line`).attr(`id`, `actor` + K).attr(`x1`, a2).attr(`y1`, s2).attr(`x2`, a2).attr(`y2`, 2e3).attr(`class`, `actor-line 200`).attr(`stroke-width`, `0.5px`).attr(`stroke`, `#999`).attr(`name`, t2.name), l2 = c2.append(`g`), t2.actorCnt = K, t2.links != null && l2.attr(`id`, `root-` + K));
  let u2 = k(), d2 = `actor`;
  ((_a2 = t2.properties) == null ? void 0 : _a2.class) ? d2 = t2.properties.class : u2.fill = `#eaeaea`, r2 ? d2 += ` ${U}` : d2 += ` ${H}`, u2.x = t2.x, u2.y = i2, u2.width = t2.width, u2.height = t2.height, u2.class = d2, u2.name = t2.name;
  let f2 = u2.height / 2, p2 = f2 / (2.5 + u2.height / 50), m2 = l2.append(`g`), h2 = l2.append(`g`);
  if (m2.append(`path`).attr(`d`, `M ${u2.x},${u2.y + f2}
    a ${p2},${f2} 0 0 0 0,${u2.height}
    h ${u2.width - 2 * p2}
    a ${p2},${f2} 0 0 0 0,-${u2.height}
    Z
  `).attr(`class`, d2), h2.append(`path`).attr(`d`, `M ${u2.x},${u2.y + f2}
      a ${p2},${f2} 0 0 0 0,${u2.height}`).attr(`stroke`, `#666`).attr(`stroke-width`, `1px`).attr(`class`, d2), m2.attr(`transform`, `translate(${p2}, ${-(u2.height / 2)})`), h2.attr(`transform`, `translate(${u2.width - p2}, ${-u2.height / 2})`), t2.rectData = u2, (_b = t2.properties) == null ? void 0 : _b.icon) {
    let e3 = t2.properties.icon.trim(), n3 = u2.x + u2.width - 20, r3 = u2.y + 10;
    e3.charAt(0) === `@` ? O(l2, n3, r3, e3.substr(1)) : A(l2, n3, r3, e3);
  }
  q(n2, o(t2.description))(t2.description, l2, u2.x, u2.y, u2.width, u2.height, { class: `actor ${ne}` }, n2);
  let g2 = t2.height, _2 = m2.select(`path:last-child`);
  if (_2.node()) {
    let e3 = _2.node().getBBox();
    t2.height = e3.height, g2 = e3.height;
  }
  return g2;
}, `drawActorTypeQueue`), fe = y(function(e2, t2, n2, r2) {
  var _a2;
  let i2 = r2 ? t2.stopy : t2.starty, a2 = t2.x + t2.width / 2, s2 = i2 + 75, c2 = e2.append(`g`).lower();
  r2 || (K++, c2.append(`line`).attr(`id`, `actor` + K).attr(`x1`, a2).attr(`y1`, s2).attr(`x2`, a2).attr(`y2`, 2e3).attr(`class`, `actor-line 200`).attr(`stroke-width`, `0.5px`).attr(`stroke`, `#999`).attr(`name`, t2.name), t2.actorCnt = K);
  let l2 = e2.append(`g`), u2 = W;
  r2 ? u2 += ` ${U}` : u2 += ` ${H}`, l2.attr(`class`, u2), l2.attr(`name`, t2.name);
  let d2 = k();
  d2.x = t2.x, d2.y = i2, d2.fill = `#eaeaea`, d2.width = t2.width, d2.height = t2.height, d2.class = `actor`;
  let f2 = t2.x + t2.width / 2, p2 = i2 + 30;
  return l2.append(`defs`).append(`marker`).attr(`id`, `filled-head-control`).attr(`refX`, 11).attr(`refY`, 5.8).attr(`markerWidth`, 20).attr(`markerHeight`, 28).attr(`orient`, `172.5`).append(`path`).attr(`d`, `M 14.4 5.6 L 7.2 10.4 L 8.8 5.6 L 7.2 0.8 Z`), l2.append(`circle`).attr(`cx`, f2).attr(`cy`, p2).attr(`r`, 18).attr(`fill`, `#eaeaf7`).attr(`stroke`, `#666`).attr(`stroke-width`, 1.2), l2.append(`line`).attr(`marker-end`, `url(#filled-head-control)`).attr(`transform`, `translate(${f2}, ${p2 - 18})`), t2.height = l2.node().getBBox().height + 2 * (((_a2 = n2 == null ? void 0 : n2.sequence) == null ? void 0 : _a2.labelBoxHeight) ?? 0), q(n2, o(t2.description))(t2.description, l2, d2.x, d2.y + 18 + (r2 ? 5 : 10), d2.width, d2.height, { class: `actor ${W}` }, n2), t2.height;
}, `drawActorTypeControl`), pe = y(function(e2, t2, n2, r2) {
  var _a2;
  let i2 = r2 ? t2.stopy : t2.starty, a2 = t2.x + t2.width / 2, s2 = i2 + 75, c2 = e2.append(`g`).lower(), l2 = e2.append(`g`), u2 = W;
  r2 ? u2 += ` ${U}` : u2 += ` ${H}`, l2.attr(`class`, u2), l2.attr(`name`, t2.name);
  let d2 = k();
  d2.x = t2.x, d2.y = i2, d2.fill = `#eaeaea`, d2.width = t2.width, d2.height = t2.height, d2.class = `actor`;
  let f2 = t2.x + t2.width / 2, p2 = i2 + (r2 ? 10 : 25);
  return l2.append(`circle`).attr(`cx`, f2).attr(`cy`, p2).attr(`r`, 18).attr(`width`, t2.width).attr(`height`, t2.height), l2.append(`line`).attr(`x1`, f2 - 18).attr(`x2`, f2 + 18).attr(`y1`, p2 + 18).attr(`y2`, p2 + 18).attr(`stroke`, `#333`).attr(`stroke-width`, 2), t2.height = l2.node().getBBox().height + (((_a2 = n2 == null ? void 0 : n2.sequence) == null ? void 0 : _a2.labelBoxHeight) ?? 0), r2 || (K++, c2.append(`line`).attr(`id`, `actor` + K).attr(`x1`, a2).attr(`y1`, s2).attr(`x2`, a2).attr(`y2`, 2e3).attr(`class`, `actor-line 200`).attr(`stroke-width`, `0.5px`).attr(`stroke`, `#999`).attr(`name`, t2.name), t2.actorCnt = K), q(n2, o(t2.description))(t2.description, l2, d2.x, d2.y + (r2 ? (p2 - i2 + 18 - 5) / 2 : (p2 + 18 - i2) / 2), d2.width, d2.height, { class: `actor ${W}` }, n2), l2.attr(`transform`, `translate(0, ${18 / 2})`), t2.height;
}, `drawActorTypeEntity`), me = y(function(e2, t2, n2, r2) {
  var _a2;
  let i2 = r2 ? t2.stopy : t2.starty, a2 = t2.x + t2.width / 2, s2 = i2 + t2.height + 2 * n2.boxTextMargin, c2 = e2.append(`g`).lower(), l2 = c2;
  r2 || (K++, Object.keys(t2.links || {}).length && !n2.forceMenus && l2.attr(`onclick`, ae(`actor${K}_popup`)).attr(`cursor`, `pointer`), l2.append(`line`).attr(`id`, `actor` + K).attr(`x1`, a2).attr(`y1`, s2).attr(`x2`, a2).attr(`y2`, 2e3).attr(`class`, `actor-line 200`).attr(`stroke-width`, `0.5px`).attr(`stroke`, `#999`).attr(`name`, t2.name), l2 = c2.append(`g`), t2.actorCnt = K, t2.links != null && l2.attr(`id`, `root-` + K));
  let u2 = k(), d2 = `actor`;
  ((_a2 = t2.properties) == null ? void 0 : _a2.class) ? d2 = t2.properties.class : u2.fill = `#eaeaea`, r2 ? d2 += ` ${U}` : d2 += ` ${H}`, u2.x = t2.x, u2.y = i2, u2.width = t2.width, u2.height = t2.height, u2.class = d2, u2.name = t2.name, u2.x = t2.x, u2.y = i2;
  let f2 = u2.width / 4, p2 = u2.width / 4, m2 = f2 / 2, h2 = m2 / (2.5 + f2 / 50), g2 = l2.append(`g`), _2 = `
  M ${u2.x},${u2.y + h2}
  a ${m2},${h2} 0 0 0 ${f2},0
  a ${m2},${h2} 0 0 0 -${f2},0
  l 0,${p2 - 2 * h2}
  a ${m2},${h2} 0 0 0 ${f2},0
  l 0,-${p2 - 2 * h2}
`;
  g2.append(`path`).attr(`d`, _2).attr(`fill`, `#eaeaea`).attr(`stroke`, `#000`).attr(`stroke-width`, 1).attr(`class`, d2), r2 ? g2.attr(`transform`, `translate(${f2 * 1.5}, ${u2.height / 4 - 2 * h2})`) : g2.attr(`transform`, `translate(${f2 * 1.5}, ${(u2.height + h2) / 4})`), t2.rectData = u2, q(n2, o(t2.description))(t2.description, l2, u2.x, u2.y + (r2 ? (u2.height + p2) / 4 : (u2.height + h2) / 2), u2.width, u2.height, { class: `actor ${ne}` }, n2);
  let v2 = g2.select(`path:last-child`);
  return v2.node() && (t2.height = v2.node().getBBox().height + (n2.sequence.labelBoxHeight ?? 0)), t2.height;
}, `drawActorTypeDatabase`), he = y(function(e2, t2, n2, r2) {
  let i2 = r2 ? t2.stopy : t2.starty, a2 = t2.x + t2.width / 2, s2 = i2 + 80, c2 = e2.append(`g`).lower();
  r2 || (K++, c2.append(`line`).attr(`id`, `actor` + K).attr(`x1`, a2).attr(`y1`, s2).attr(`x2`, a2).attr(`y2`, 2e3).attr(`class`, `actor-line 200`).attr(`stroke-width`, `0.5px`).attr(`stroke`, `#999`).attr(`name`, t2.name), t2.actorCnt = K);
  let l2 = e2.append(`g`), u2 = W;
  r2 ? u2 += ` ${U}` : u2 += ` ${H}`, l2.attr(`class`, u2), l2.attr(`name`, t2.name);
  let d2 = k();
  return d2.x = t2.x, d2.y = i2, d2.fill = `#eaeaea`, d2.width = t2.width, d2.height = t2.height, d2.class = `actor`, l2.append(`line`).attr(`id`, `actor-man-torso` + K).attr(`x1`, t2.x + t2.width / 2 - 30 * 2.5).attr(`y1`, i2 + 10).attr(`x2`, t2.x + t2.width / 2 - 15).attr(`y2`, i2 + 10), l2.append(`line`).attr(`id`, `actor-man-arms` + K).attr(`x1`, t2.x + t2.width / 2 - 30 * 2.5).attr(`y1`, i2 + 0).attr(`x2`, t2.x + t2.width / 2 - 30 * 2.5).attr(`y2`, i2 + 20), l2.append(`circle`).attr(`cx`, t2.x + t2.width / 2).attr(`cy`, i2 + 10).attr(`r`, 30), t2.height = l2.node().getBBox().height + (n2.sequence.labelBoxHeight ?? 0), q(n2, o(t2.description))(t2.description, l2, d2.x, d2.y + (r2 ? 30 / 2 - 4 : 18), d2.width, d2.height, { class: `actor ${W}` }, n2), l2.attr(`transform`, `translate(0,22)`), t2.height;
}, `drawActorTypeBoundary`), ge = y(function(e2, t2, n2, r2) {
  let i2 = r2 ? t2.stopy : t2.starty, a2 = t2.x + t2.width / 2, s2 = i2 + 80, c2 = e2.append(`g`).lower();
  r2 || (K++, c2.append(`line`).attr(`id`, `actor` + K).attr(`x1`, a2).attr(`y1`, s2).attr(`x2`, a2).attr(`y2`, 2e3).attr(`class`, `actor-line 200`).attr(`stroke-width`, `0.5px`).attr(`stroke`, `#999`).attr(`name`, t2.name), t2.actorCnt = K);
  let l2 = e2.append(`g`), u2 = W;
  r2 ? u2 += ` ${U}` : u2 += ` ${H}`, l2.attr(`class`, u2), l2.attr(`name`, t2.name);
  let d2 = k();
  d2.x = t2.x, d2.y = i2, d2.fill = `#eaeaea`, d2.width = t2.width, d2.height = t2.height, d2.class = `actor`, d2.rx = 3, d2.ry = 3, l2.append(`line`).attr(`id`, `actor-man-torso` + K).attr(`x1`, a2).attr(`y1`, i2 + 25).attr(`x2`, a2).attr(`y2`, i2 + 45), l2.append(`line`).attr(`id`, `actor-man-arms` + K).attr(`x1`, a2 - V / 2).attr(`y1`, i2 + 33).attr(`x2`, a2 + V / 2).attr(`y2`, i2 + 33), l2.append(`line`).attr(`x1`, a2 - V / 2).attr(`y1`, i2 + 60).attr(`x2`, a2).attr(`y2`, i2 + 45), l2.append(`line`).attr(`x1`, a2).attr(`y1`, i2 + 45).attr(`x2`, a2 + V / 2 - 2).attr(`y2`, i2 + 60);
  let f2 = l2.append(`circle`);
  return f2.attr(`cx`, t2.x + t2.width / 2), f2.attr(`cy`, i2 + 10), f2.attr(`r`, 15), f2.attr(`width`, t2.width), f2.attr(`height`, t2.height), t2.height = l2.node().getBBox().height, q(n2, o(t2.description))(t2.description, l2, d2.x, d2.y + 35, d2.width, d2.height, { class: `actor ${W}` }, n2), t2.height;
}, `drawActorTypeActor`), _e = y(async function(e2, t2, n2, r2) {
  switch (t2.type) {
    case `actor`:
      return await ge(e2, t2, n2, r2);
    case `participant`:
      return await le(e2, t2, n2, r2);
    case `boundary`:
      return await he(e2, t2, n2, r2);
    case `control`:
      return await fe(e2, t2, n2, r2);
    case `entity`:
      return await pe(e2, t2, n2, r2);
    case `database`:
      return await me(e2, t2, n2, r2);
    case `collections`:
      return await ue(e2, t2, n2, r2);
    case `queue`:
      return await de(e2, t2, n2, r2);
  }
}, `drawActor`), ve = y(function(e2, t2, n2) {
  let r2 = e2.append(`g`);
  Se(r2, t2), t2.name && q(n2)(t2.name, r2, t2.x, t2.y + n2.boxTextMargin + (t2.textMaxHeight || 0) / 2, t2.width, 0, { class: `text` }, n2), r2.lower();
}, `drawBox`), ye = y(function(e2) {
  return e2.append(`g`);
}, `anchorElement`), be = y(function(e2, t2, n2, r2, i2) {
  let a2 = k(), o2 = t2.anchored;
  a2.x = t2.startx, a2.y = t2.starty, a2.class = `activation` + i2 % 3, a2.width = t2.stopx - t2.startx, a2.height = n2 - t2.starty, re(o2, a2);
}, `drawActivation`), xe = y(async function(e2, t2, n2, r2) {
  let { boxMargin: i2, boxTextMargin: a2, labelBoxHeight: s2, labelBoxWidth: c2, messageFontFamily: l2, messageFontSize: u2, messageFontWeight: d2 } = r2, f2 = e2.append(`g`), p2 = y(function(e3, t3, n3, r3) {
    return f2.append(`line`).attr(`x1`, e3).attr(`y1`, t3).attr(`x2`, n3).attr(`y2`, r3).attr(`class`, `loopLine`);
  }, `drawLoopLine`);
  p2(t2.startx, t2.starty, t2.stopx, t2.starty), p2(t2.stopx, t2.starty, t2.stopx, t2.stopy), p2(t2.startx, t2.stopy, t2.stopx, t2.stopy), p2(t2.startx, t2.starty, t2.startx, t2.stopy), t2.sections !== void 0 && t2.sections.forEach(function(e3) {
    p2(t2.startx, e3.y, t2.stopx, e3.y).style(`stroke-dasharray`, `3, 3`);
  });
  let m2 = j();
  m2.text = n2, m2.x = t2.startx, m2.y = t2.starty, m2.fontFamily = l2, m2.fontSize = u2, m2.fontWeight = d2, m2.anchor = `middle`, m2.valign = `middle`, m2.tspan = false, m2.width = c2 || 50, m2.height = s2 || 20, m2.textMargin = a2, m2.class = `labelText`, se(f2, m2), m2 = Ae(), m2.text = t2.title, m2.x = t2.startx + c2 / 2 + (t2.stopx - t2.startx) / 2, m2.y = t2.starty + i2 + a2, m2.anchor = `middle`, m2.valign = `middle`, m2.textMargin = a2, m2.class = `loopText`, m2.fontFamily = l2, m2.fontSize = u2, m2.fontWeight = d2, m2.wrap = true;
  let h2 = o(m2.text) ? await oe(f2, m2, t2) : G(f2, m2);
  if (t2.sectionTitles !== void 0) {
    for (let [e3, n3] of Object.entries(t2.sectionTitles)) if (n3.message) {
      m2.text = n3.message, m2.x = t2.startx + (t2.stopx - t2.startx) / 2, m2.y = t2.sections[e3].y + i2 + a2, m2.class = `loopText`, m2.anchor = `middle`, m2.valign = `middle`, m2.tspan = false, m2.fontFamily = l2, m2.fontSize = u2, m2.fontWeight = d2, m2.wrap = t2.wrap, o(m2.text) ? (t2.starty = t2.sections[e3].y, await oe(f2, m2, t2)) : G(f2, m2);
      let r3 = Math.round(h2.map((e4) => (e4._groups || e4)[0][0].getBBox().height).reduce((e4, t3) => e4 + t3));
      t2.sections[e3].height += r3 - (i2 + a2);
    }
  }
  return t2.height = Math.round(t2.stopy - t2.starty), f2;
}, `drawLoop`), Se = y(function(e2, t2) {
  M(e2, t2);
}, `drawBackgroundRect`), Ce = y(function(e2) {
  e2.append(`defs`).append(`symbol`).attr(`id`, `database`).attr(`fill-rule`, `evenodd`).attr(`clip-rule`, `evenodd`).append(`path`).attr(`transform`, `scale(.5)`).attr(`d`, `M12.258.001l.256.004.255.005.253.008.251.01.249.012.247.015.246.016.242.019.241.02.239.023.236.024.233.027.231.028.229.031.225.032.223.034.22.036.217.038.214.04.211.041.208.043.205.045.201.046.198.048.194.05.191.051.187.053.183.054.18.056.175.057.172.059.168.06.163.061.16.063.155.064.15.066.074.033.073.033.071.034.07.034.069.035.068.035.067.035.066.035.064.036.064.036.062.036.06.036.06.037.058.037.058.037.055.038.055.038.053.038.052.038.051.039.05.039.048.039.047.039.045.04.044.04.043.04.041.04.04.041.039.041.037.041.036.041.034.041.033.042.032.042.03.042.029.042.027.042.026.043.024.043.023.043.021.043.02.043.018.044.017.043.015.044.013.044.012.044.011.045.009.044.007.045.006.045.004.045.002.045.001.045v17l-.001.045-.002.045-.004.045-.006.045-.007.045-.009.044-.011.045-.012.044-.013.044-.015.044-.017.043-.018.044-.02.043-.021.043-.023.043-.024.043-.026.043-.027.042-.029.042-.03.042-.032.042-.033.042-.034.041-.036.041-.037.041-.039.041-.04.041-.041.04-.043.04-.044.04-.045.04-.047.039-.048.039-.05.039-.051.039-.052.038-.053.038-.055.038-.055.038-.058.037-.058.037-.06.037-.06.036-.062.036-.064.036-.064.036-.066.035-.067.035-.068.035-.069.035-.07.034-.071.034-.073.033-.074.033-.15.066-.155.064-.16.063-.163.061-.168.06-.172.059-.175.057-.18.056-.183.054-.187.053-.191.051-.194.05-.198.048-.201.046-.205.045-.208.043-.211.041-.214.04-.217.038-.22.036-.223.034-.225.032-.229.031-.231.028-.233.027-.236.024-.239.023-.241.02-.242.019-.246.016-.247.015-.249.012-.251.01-.253.008-.255.005-.256.004-.258.001-.258-.001-.256-.004-.255-.005-.253-.008-.251-.01-.249-.012-.247-.015-.245-.016-.243-.019-.241-.02-.238-.023-.236-.024-.234-.027-.231-.028-.228-.031-.226-.032-.223-.034-.22-.036-.217-.038-.214-.04-.211-.041-.208-.043-.204-.045-.201-.046-.198-.048-.195-.05-.19-.051-.187-.053-.184-.054-.179-.056-.176-.057-.172-.059-.167-.06-.164-.061-.159-.063-.155-.064-.151-.066-.074-.033-.072-.033-.072-.034-.07-.034-.069-.035-.068-.035-.067-.035-.066-.035-.064-.036-.063-.036-.062-.036-.061-.036-.06-.037-.058-.037-.057-.037-.056-.038-.055-.038-.053-.038-.052-.038-.051-.039-.049-.039-.049-.039-.046-.039-.046-.04-.044-.04-.043-.04-.041-.04-.04-.041-.039-.041-.037-.041-.036-.041-.034-.041-.033-.042-.032-.042-.03-.042-.029-.042-.027-.042-.026-.043-.024-.043-.023-.043-.021-.043-.02-.043-.018-.044-.017-.043-.015-.044-.013-.044-.012-.044-.011-.045-.009-.044-.007-.045-.006-.045-.004-.045-.002-.045-.001-.045v-17l.001-.045.002-.045.004-.045.006-.045.007-.045.009-.044.011-.045.012-.044.013-.044.015-.044.017-.043.018-.044.02-.043.021-.043.023-.043.024-.043.026-.043.027-.042.029-.042.03-.042.032-.042.033-.042.034-.041.036-.041.037-.041.039-.041.04-.041.041-.04.043-.04.044-.04.046-.04.046-.039.049-.039.049-.039.051-.039.052-.038.053-.038.055-.038.056-.038.057-.037.058-.037.06-.037.061-.036.062-.036.063-.036.064-.036.066-.035.067-.035.068-.035.069-.035.07-.034.072-.034.072-.033.074-.033.151-.066.155-.064.159-.063.164-.061.167-.06.172-.059.176-.057.179-.056.184-.054.187-.053.19-.051.195-.05.198-.048.201-.046.204-.045.208-.043.211-.041.214-.04.217-.038.22-.036.223-.034.226-.032.228-.031.231-.028.234-.027.236-.024.238-.023.241-.02.243-.019.245-.016.247-.015.249-.012.251-.01.253-.008.255-.005.256-.004.258-.001.258.001zm-9.258 20.499v.01l.001.021.003.021.004.022.005.021.006.022.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.023.018.024.019.024.021.024.022.025.023.024.024.025.052.049.056.05.061.051.066.051.07.051.075.051.079.052.084.052.088.052.092.052.097.052.102.051.105.052.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.048.144.049.147.047.152.047.155.047.16.045.163.045.167.043.171.043.176.041.178.041.183.039.187.039.19.037.194.035.197.035.202.033.204.031.209.03.212.029.216.027.219.025.222.024.226.021.23.02.233.018.236.016.24.015.243.012.246.01.249.008.253.005.256.004.259.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.021.224-.024.22-.026.216-.027.212-.028.21-.031.205-.031.202-.034.198-.034.194-.036.191-.037.187-.039.183-.04.179-.04.175-.042.172-.043.168-.044.163-.045.16-.046.155-.046.152-.047.148-.048.143-.049.139-.049.136-.05.131-.05.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.053.083-.051.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.05.023-.024.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.023.01-.022.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.127l-.077.055-.08.053-.083.054-.085.053-.087.052-.09.052-.093.051-.095.05-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.045-.118.044-.12.043-.122.042-.124.042-.126.041-.128.04-.13.04-.132.038-.134.038-.135.037-.138.037-.139.035-.142.035-.143.034-.144.033-.147.032-.148.031-.15.03-.151.03-.153.029-.154.027-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.01-.179.008-.179.008-.181.006-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.006-.179-.008-.179-.008-.178-.01-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.027-.153-.029-.151-.03-.15-.03-.148-.031-.146-.032-.145-.033-.143-.034-.141-.035-.14-.035-.137-.037-.136-.037-.134-.038-.132-.038-.13-.04-.128-.04-.126-.041-.124-.042-.122-.042-.12-.044-.117-.043-.116-.045-.113-.045-.112-.046-.109-.047-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.05-.093-.052-.09-.051-.087-.052-.085-.053-.083-.054-.08-.054-.077-.054v4.127zm0-5.654v.011l.001.021.003.021.004.021.005.022.006.022.007.022.009.022.01.022.011.023.012.023.013.023.015.024.016.023.017.024.018.024.019.024.021.024.022.024.023.025.024.024.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.052.11.051.114.051.119.052.123.05.127.051.131.05.135.049.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.044.171.042.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.022.23.02.233.018.236.016.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.012.241-.015.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.048.139-.05.136-.049.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.051.051-.049.023-.025.023-.024.021-.025.02-.024.019-.024.018-.024.017-.024.015-.023.014-.023.013-.024.012-.022.01-.023.01-.023.008-.022.006-.022.006-.022.004-.021.004-.022.001-.021.001-.021v-4.139l-.077.054-.08.054-.083.054-.085.052-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.044-.118.044-.12.044-.122.042-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.035-.143.033-.144.033-.147.033-.148.031-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.009-.179.009-.179.007-.181.007-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.007-.179-.007-.179-.009-.178-.009-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.031-.146-.033-.145-.033-.143-.033-.141-.035-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.04-.126-.041-.124-.042-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.051-.093-.051-.09-.051-.087-.053-.085-.052-.083-.054-.08-.054-.077-.054v4.139zm0-5.666v.011l.001.02.003.022.004.021.005.022.006.021.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.024.018.023.019.024.021.025.022.024.023.024.024.025.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.051.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.043.171.043.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.021.23.02.233.018.236.017.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.013.241-.014.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.049.139-.049.136-.049.131-.051.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.049.023-.025.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.022.01-.023.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.153l-.077.054-.08.054-.083.053-.085.053-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.048-.105.048-.106.048-.109.046-.111.046-.114.046-.115.044-.118.044-.12.043-.122.043-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.034-.143.034-.144.033-.147.032-.148.032-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.024-.161.024-.162.023-.163.023-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.01-.178.01-.179.009-.179.007-.181.006-.182.006-.182.004-.184.003-.184.001-.185.001-.185-.001-.184-.001-.184-.003-.182-.004-.182-.006-.181-.006-.179-.007-.179-.009-.178-.01-.176-.01-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.023-.162-.023-.161-.024-.159-.024-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.032-.146-.032-.145-.033-.143-.034-.141-.034-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.041-.126-.041-.124-.041-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.048-.105-.048-.102-.048-.1-.05-.097-.049-.095-.051-.093-.051-.09-.052-.087-.052-.085-.053-.083-.053-.08-.054-.077-.054v4.153zm8.74-8.179l-.257.004-.254.005-.25.008-.247.011-.244.012-.241.014-.237.016-.233.018-.231.021-.226.022-.224.023-.22.026-.216.027-.212.028-.21.031-.205.032-.202.033-.198.034-.194.036-.191.038-.187.038-.183.04-.179.041-.175.042-.172.043-.168.043-.163.045-.16.046-.155.046-.152.048-.148.048-.143.048-.139.049-.136.05-.131.05-.126.051-.123.051-.118.051-.114.052-.11.052-.106.052-.101.052-.096.052-.092.052-.088.052-.083.052-.079.052-.074.051-.07.052-.065.051-.06.05-.056.05-.051.05-.023.025-.023.024-.021.024-.02.025-.019.024-.018.024-.017.023-.015.024-.014.023-.013.023-.012.023-.01.023-.01.022-.008.022-.006.023-.006.021-.004.022-.004.021-.001.021-.001.021.001.021.001.021.004.021.004.022.006.021.006.023.008.022.01.022.01.023.012.023.013.023.014.023.015.024.017.023.018.024.019.024.02.025.021.024.023.024.023.025.051.05.056.05.06.05.065.051.07.052.074.051.079.052.083.052.088.052.092.052.096.052.101.052.106.052.11.052.114.052.118.051.123.051.126.051.131.05.136.05.139.049.143.048.148.048.152.048.155.046.16.046.163.045.168.043.172.043.175.042.179.041.183.04.187.038.191.038.194.036.198.034.202.033.205.032.21.031.212.028.216.027.22.026.224.023.226.022.231.021.233.018.237.016.241.014.244.012.247.011.25.008.254.005.257.004.26.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.022.224-.023.22-.026.216-.027.212-.028.21-.031.205-.032.202-.033.198-.034.194-.036.191-.038.187-.038.183-.04.179-.041.175-.042.172-.043.168-.043.163-.045.16-.046.155-.046.152-.048.148-.048.143-.048.139-.049.136-.05.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.05.051-.05.023-.025.023-.024.021-.024.02-.025.019-.024.018-.024.017-.023.015-.024.014-.023.013-.023.012-.023.01-.023.01-.022.008-.022.006-.023.006-.021.004-.022.004-.021.001-.021.001-.021-.001-.021-.001-.021-.004-.021-.004-.022-.006-.021-.006-.023-.008-.022-.01-.022-.01-.023-.012-.023-.013-.023-.014-.023-.015-.024-.017-.023-.018-.024-.019-.024-.02-.025-.021-.024-.023-.024-.023-.025-.051-.05-.056-.05-.06-.05-.065-.051-.07-.052-.074-.051-.079-.052-.083-.052-.088-.052-.092-.052-.096-.052-.101-.052-.106-.052-.11-.052-.114-.052-.118-.051-.123-.051-.126-.051-.131-.05-.136-.05-.139-.049-.143-.048-.148-.048-.152-.048-.155-.046-.16-.046-.163-.045-.168-.043-.172-.043-.175-.042-.179-.041-.183-.04-.187-.038-.191-.038-.194-.036-.198-.034-.202-.033-.205-.032-.21-.031-.212-.028-.216-.027-.22-.026-.224-.023-.226-.022-.231-.021-.233-.018-.237-.016-.241-.014-.244-.012-.247-.011-.25-.008-.254-.005-.257-.004-.26-.001-.26.001z`);
}, `insertDatabaseIcon`), we = y(function(e2) {
  e2.append(`defs`).append(`symbol`).attr(`id`, `computer`).attr(`width`, `24`).attr(`height`, `24`).append(`path`).attr(`transform`, `scale(.5)`).attr(`d`, `M2 2v13h20v-13h-20zm18 11h-16v-9h16v9zm-10.228 6l.466-1h3.524l.467 1h-4.457zm14.228 3h-24l2-6h2.104l-1.33 4h18.45l-1.297-4h2.073l2 6zm-5-10h-14v-7h14v7z`);
}, `insertComputerIcon`), Te = y(function(e2) {
  e2.append(`defs`).append(`symbol`).attr(`id`, `clock`).attr(`width`, `24`).attr(`height`, `24`).append(`path`).attr(`transform`, `scale(.5)`).attr(`d`, `M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.848 12.459c.202.038.202.333.001.372-1.907.361-6.045 1.111-6.547 1.111-.719 0-1.301-.582-1.301-1.301 0-.512.77-5.447 1.125-7.445.034-.192.312-.181.343.014l.985 6.238 5.394 1.011z`);
}, `insertClockIcon`), Ee = y(function(e2) {
  e2.append(`defs`).append(`marker`).attr(`id`, `arrowhead`).attr(`refX`, 7.9).attr(`refY`, 5).attr(`markerUnits`, `userSpaceOnUse`).attr(`markerWidth`, 12).attr(`markerHeight`, 12).attr(`orient`, `auto-start-reverse`).append(`path`).attr(`d`, `M -1 0 L 10 5 L 0 10 z`);
}, `insertArrowHead`), De = y(function(e2) {
  e2.append(`defs`).append(`marker`).attr(`id`, `filled-head`).attr(`refX`, 15.5).attr(`refY`, 7).attr(`markerWidth`, 20).attr(`markerHeight`, 28).attr(`orient`, `auto`).append(`path`).attr(`d`, `M 18,7 L9,13 L14,7 L9,1 Z`);
}, `insertArrowFilledHead`), Oe = y(function(e2) {
  e2.append(`defs`).append(`marker`).attr(`id`, `sequencenumber`).attr(`refX`, 15).attr(`refY`, 15).attr(`markerWidth`, 60).attr(`markerHeight`, 40).attr(`orient`, `auto`).append(`circle`).attr(`cx`, 15).attr(`cy`, 15).attr(`r`, 6);
}, `insertSequenceNumber`), ke = y(function(e2) {
  e2.append(`defs`).append(`marker`).attr(`id`, `crosshead`).attr(`markerWidth`, 15).attr(`markerHeight`, 8).attr(`orient`, `auto`).attr(`refX`, 4).attr(`refY`, 4.5).append(`path`).attr(`fill`, `none`).attr(`stroke`, `#000000`).style(`stroke-dasharray`, `0, 0`).attr(`stroke-width`, `1pt`).attr(`d`, `M 1,2 L 6,7 M 6,2 L 1,7`);
}, `insertArrowCrossHead`), Ae = y(function() {
  return { x: 0, y: 0, fill: void 0, anchor: void 0, style: `#666`, width: void 0, height: void 0, textMargin: 0, rx: 0, ry: 0, tspan: true, valign: void 0 };
}, `getTextObj`), je = y(function() {
  return { x: 0, y: 0, fill: `#EDF2AE`, stroke: `#666`, width: 100, anchor: `start`, height: 100, rx: 0, ry: 0 };
}, `getNoteRect`), q = (function() {
  function e2(e3, t3, n3, r3, a2, o2, s2) {
    i2(t3.append(`text`).attr(`x`, n3 + a2 / 2).attr(`y`, r3 + o2 / 2 + 5).style(`text-anchor`, `middle`).text(e3), s2);
  }
  y(e2, `byText`);
  function t2(e3, t3, n3, r3, a2, o2, s2, c2) {
    let { actorFontSize: l2, actorFontFamily: u2, actorFontWeight: d2 } = c2, [f2, p2] = S(l2), h2 = e3.split(m.lineBreakRegex);
    for (let e4 = 0; e4 < h2.length; e4++) {
      let c3 = e4 * f2 - f2 * (h2.length - 1) / 2, l3 = t3.append(`text`).attr(`x`, n3 + a2 / 2).attr(`y`, r3).style(`text-anchor`, `middle`).style(`font-size`, p2).style(`font-weight`, d2).style(`font-family`, u2);
      l3.append(`tspan`).attr(`x`, n3 + a2 / 2).attr(`dy`, c3).text(h2[e4]), l3.attr(`y`, r3 + o2 / 2).attr(`dominant-baseline`, `central`).attr(`alignment-baseline`, `central`), i2(l3, s2);
    }
  }
  y(t2, `byTspan`);
  function n2(e3, n3, r3, a2, o2, s2, c2, l2) {
    let u2 = n3.append(`switch`), d2 = u2.append(`foreignObject`).attr(`x`, r3).attr(`y`, a2).attr(`width`, o2).attr(`height`, s2).append(`xhtml:div`).style(`display`, `table`).style(`height`, `100%`).style(`width`, `100%`);
    d2.append(`div`).style(`display`, `table-cell`).style(`text-align`, `center`).style(`vertical-align`, `middle`).text(e3), t2(e3, u2, r3, a2, o2, s2, c2, l2), i2(d2, c2);
  }
  y(n2, `byFo`);
  async function r2(e3, n3, r3, o2, s2, c2, l2, u2) {
    let d2 = await f(e3, g()), p2 = n3.append(`switch`), m2 = p2.append(`foreignObject`).attr(`x`, r3 + s2 / 2 - d2.width / 2).attr(`y`, o2 + c2 / 2 - d2.height / 2).attr(`width`, d2.width).attr(`height`, d2.height).append(`xhtml:div`).style(`height`, `100%`).style(`width`, `100%`);
    m2.append(`div`).style(`text-align`, `center`).style(`vertical-align`, `middle`).html(await a(e3, g())), t2(e3, p2, r3, o2, s2, c2, l2, u2), i2(m2, l2);
  }
  y(r2, `byKatex`);
  function i2(e3, t3) {
    for (let n3 in t3) t3.hasOwnProperty(n3) && e3.attr(n3, t3[n3]);
  }
  return y(i2, `_setTextAttrs`), function(i3, a2 = false) {
    return a2 ? r2 : i3.textPlacement === `fo` ? n2 : i3.textPlacement === `old` ? e2 : t2;
  };
})(), Me = (function() {
  function e2(e3, t3, n3, i2, a2, o2, s2) {
    r2(t3.append(`text`).attr(`x`, n3).attr(`y`, i2).style(`text-anchor`, `start`).text(e3), s2);
  }
  y(e2, `byText`);
  function t2(e3, t3, n3, i2, a2, o2, s2, c2) {
    let { actorFontSize: l2, actorFontFamily: u2, actorFontWeight: d2 } = c2, f2 = e3.split(m.lineBreakRegex);
    for (let e4 = 0; e4 < f2.length; e4++) {
      let a3 = e4 * l2 - l2 * (f2.length - 1) / 2, c3 = t3.append(`text`).attr(`x`, n3).attr(`y`, i2).style(`text-anchor`, `start`).style(`font-size`, l2).style(`font-weight`, d2).style(`font-family`, u2);
      c3.append(`tspan`).attr(`x`, n3).attr(`dy`, a3).text(f2[e4]), c3.attr(`y`, i2 + o2 / 2).attr(`dominant-baseline`, `central`).attr(`alignment-baseline`, `central`), r2(c3, s2);
    }
  }
  y(t2, `byTspan`);
  function n2(e3, n3, i2, a2, o2, s2, c2, l2) {
    let u2 = n3.append(`switch`), d2 = u2.append(`foreignObject`).attr(`x`, i2).attr(`y`, a2).attr(`width`, o2).attr(`height`, s2).append(`xhtml:div`).style(`display`, `table`).style(`height`, `100%`).style(`width`, `100%`);
    d2.append(`div`).style(`display`, `table-cell`).style(`text-align`, `center`).style(`vertical-align`, `middle`).text(e3), t2(e3, u2, i2, a2, o2, s2, c2, l2), r2(d2, c2);
  }
  y(n2, `byFo`);
  function r2(e3, t3) {
    for (let n3 in t3) t3.hasOwnProperty(n3) && e3.attr(n3, t3[n3]);
  }
  return y(r2, `_setTextAttrs`), function(r3) {
    return r3.textPlacement === `fo` ? n2 : r3.textPlacement === `old` ? e2 : t2;
  };
})(), J = { drawRect: re, drawText: G, drawLabel: se, drawActor: _e, drawBox: ve, drawPopup: ie, anchorElement: ye, drawActivation: be, drawLoop: xe, drawBackgroundRect: Se, insertArrowHead: Ee, insertArrowFilledHead: De, insertSequenceNumber: Oe, insertArrowCrossHead: ke, insertDatabaseIcon: Ce, insertComputerIcon: we, insertClockIcon: Te, getTextObj: Ae, getNoteRect: je, fixLifeLineHeights: ce, sanitizeUrl: P.sanitizeUrl }, Y = {}, X = { data: { startx: void 0, stopx: void 0, starty: void 0, stopy: void 0 }, verticalPos: 0, sequenceItems: [], activations: [], models: { getHeight: y(function() {
  return Math.max.apply(null, this.actors.length === 0 ? [0] : this.actors.map((e2) => e2.height || 0)) + (this.loops.length === 0 ? 0 : this.loops.map((e2) => e2.height || 0).reduce((e2, t2) => e2 + t2)) + (this.messages.length === 0 ? 0 : this.messages.map((e2) => e2.height || 0).reduce((e2, t2) => e2 + t2)) + (this.notes.length === 0 ? 0 : this.notes.map((e2) => e2.height || 0).reduce((e2, t2) => e2 + t2));
}, `getHeight`), clear: y(function() {
  this.actors = [], this.boxes = [], this.loops = [], this.messages = [], this.notes = [];
}, `clear`), addBox: y(function(e2) {
  this.boxes.push(e2);
}, `addBox`), addActor: y(function(e2) {
  this.actors.push(e2);
}, `addActor`), addLoop: y(function(e2) {
  this.loops.push(e2);
}, `addLoop`), addMessage: y(function(e2) {
  this.messages.push(e2);
}, `addMessage`), addNote: y(function(e2) {
  this.notes.push(e2);
}, `addNote`), lastActor: y(function() {
  return this.actors[this.actors.length - 1];
}, `lastActor`), lastLoop: y(function() {
  return this.loops[this.loops.length - 1];
}, `lastLoop`), lastMessage: y(function() {
  return this.messages[this.messages.length - 1];
}, `lastMessage`), lastNote: y(function() {
  return this.notes[this.notes.length - 1];
}, `lastNote`), actors: [], boxes: [], loops: [], messages: [], notes: [] }, init: y(function() {
  this.sequenceItems = [], this.activations = [], this.models.clear(), this.data = { startx: void 0, stopx: void 0, starty: void 0, stopy: void 0 }, this.verticalPos = 0, Be(u());
}, `init`), updateVal: y(function(e2, t2, n2, r2) {
  e2[t2] === void 0 ? e2[t2] = n2 : e2[t2] = r2(n2, e2[t2]);
}, `updateVal`), updateBounds: y(function(e2, t2, n2, r2) {
  let i2 = this, a2 = 0;
  function o2(o3) {
    return y(function(s2) {
      a2++;
      let c2 = i2.sequenceItems.length - a2 + 1;
      i2.updateVal(s2, `starty`, t2 - c2 * Y.boxMargin, Math.min), i2.updateVal(s2, `stopy`, r2 + c2 * Y.boxMargin, Math.max), i2.updateVal(X.data, `startx`, e2 - c2 * Y.boxMargin, Math.min), i2.updateVal(X.data, `stopx`, n2 + c2 * Y.boxMargin, Math.max), o3 !== `activation` && (i2.updateVal(s2, `startx`, e2 - c2 * Y.boxMargin, Math.min), i2.updateVal(s2, `stopx`, n2 + c2 * Y.boxMargin, Math.max), i2.updateVal(X.data, `starty`, t2 - c2 * Y.boxMargin, Math.min), i2.updateVal(X.data, `stopy`, r2 + c2 * Y.boxMargin, Math.max));
    }, `updateItemBounds`);
  }
  y(o2, `updateFn`), this.sequenceItems.forEach(o2()), this.activations.forEach(o2(`activation`));
}, `updateBounds`), insert: y(function(e2, t2, n2, r2) {
  let i2 = m.getMin(e2, n2), a2 = m.getMax(e2, n2), o2 = m.getMin(t2, r2), s2 = m.getMax(t2, r2);
  this.updateVal(X.data, `startx`, i2, Math.min), this.updateVal(X.data, `starty`, o2, Math.min), this.updateVal(X.data, `stopx`, a2, Math.max), this.updateVal(X.data, `stopy`, s2, Math.max), this.updateBounds(i2, o2, a2, s2);
}, `insert`), newActivation: y(function(e2, t2, n2) {
  let r2 = n2.get(e2.from), i2 = Ve(e2.from).length || 0, a2 = r2.x + r2.width / 2 + (i2 - 1) * Y.activationWidth / 2;
  this.activations.push({ startx: a2, starty: this.verticalPos + 2, stopx: a2 + Y.activationWidth, stopy: void 0, actor: e2.from, anchored: J.anchorElement(t2) });
}, `newActivation`), endActivation: y(function(e2) {
  let t2 = this.activations.map(function(e3) {
    return e3.actor;
  }).lastIndexOf(e2.from);
  return this.activations.splice(t2, 1)[0];
}, `endActivation`), createLoop: y(function(e2 = { message: void 0, wrap: false, width: void 0 }, t2) {
  return { startx: void 0, starty: this.verticalPos, stopx: void 0, stopy: void 0, title: e2.message, wrap: e2.wrap, width: e2.width, height: 0, fill: t2 };
}, `createLoop`), newLoop: y(function(e2 = { message: void 0, wrap: false, width: void 0 }, t2) {
  this.sequenceItems.push(this.createLoop(e2, t2));
}, `newLoop`), endLoop: y(function() {
  return this.sequenceItems.pop();
}, `endLoop`), isLoopOverlap: y(function() {
  return this.sequenceItems.length ? this.sequenceItems[this.sequenceItems.length - 1].overlap : false;
}, `isLoopOverlap`), addSectionToLoop: y(function(e2) {
  let t2 = this.sequenceItems.pop();
  t2.sections = t2.sections || [], t2.sectionTitles = t2.sectionTitles || [], t2.sections.push({ y: X.getVerticalPos(), height: 0 }), t2.sectionTitles.push(e2), this.sequenceItems.push(t2);
}, `addSectionToLoop`), saveVerticalPos: y(function() {
  this.isLoopOverlap() && (this.savedVerticalPos = this.verticalPos);
}, `saveVerticalPos`), resetVerticalPos: y(function() {
  this.isLoopOverlap() && (this.verticalPos = this.savedVerticalPos);
}, `resetVerticalPos`), bumpVerticalPos: y(function(e2) {
  this.verticalPos += e2, this.data.stopy = m.getMax(this.data.stopy, this.verticalPos);
}, `bumpVerticalPos`), getVerticalPos: y(function() {
  return this.verticalPos;
}, `getVerticalPos`), getBounds: y(function() {
  return { bounds: this.data, models: this.models };
}, `getBounds`) }, Ne = y(async function(e2, t2) {
  X.bumpVerticalPos(Y.boxMargin), t2.height = Y.boxMargin, t2.starty = X.getVerticalPos();
  let n2 = k();
  n2.x = t2.startx, n2.y = t2.starty, n2.width = t2.width || Y.width, n2.class = `note`;
  let r2 = e2.append(`g`), i2 = J.drawRect(r2, n2), a2 = j();
  a2.x = t2.startx, a2.y = t2.starty, a2.width = n2.width, a2.dy = `1em`, a2.text = t2.message, a2.class = `noteText`, a2.fontFamily = Y.noteFontFamily, a2.fontSize = Y.noteFontSize, a2.fontWeight = Y.noteFontWeight, a2.anchor = Y.noteAlign, a2.textMargin = Y.noteMargin, a2.valign = `center`;
  let s2 = o(a2.text) ? await oe(r2, a2) : G(r2, a2), c2 = Math.round(s2.map((e3) => (e3._groups || e3)[0][0].getBBox().height).reduce((e3, t3) => e3 + t3));
  i2.attr(`height`, c2 + 2 * Y.noteMargin), t2.height += c2 + 2 * Y.noteMargin, X.bumpVerticalPos(c2 + 2 * Y.noteMargin), t2.stopy = t2.starty + c2 + 2 * Y.noteMargin, t2.stopx = t2.startx + n2.width, X.insert(t2.startx, t2.starty, t2.stopx, t2.stopy), X.models.addNote(t2);
}, `drawNote`), Z = y((e2) => ({ fontFamily: e2.messageFontFamily, fontSize: e2.messageFontSize, fontWeight: e2.messageFontWeight }), `messageFont`), Q = y((e2) => ({ fontFamily: e2.noteFontFamily, fontSize: e2.noteFontSize, fontWeight: e2.noteFontWeight }), `noteFont`), Pe = y((e2) => ({ fontFamily: e2.actorFontFamily, fontSize: e2.actorFontSize, fontWeight: e2.actorFontWeight }), `actorFont`);
async function Fe(e2, t2) {
  X.bumpVerticalPos(10);
  let { startx: n2, stopx: r2, message: i2 } = t2, a2 = m.splitBreaks(i2).length, s2 = o(i2), c2 = s2 ? await f(i2, u()) : x.calculateTextDimensions(i2, Z(Y));
  if (!s2) {
    let e3 = c2.height / a2;
    t2.height += e3, X.bumpVerticalPos(e3);
  }
  let l2, d2 = c2.height - 10, p2 = c2.width;
  if (n2 === r2) {
    l2 = X.getVerticalPos() + d2, Y.rightAngles || (d2 += Y.boxMargin, l2 = X.getVerticalPos() + d2), d2 += 30;
    let e3 = m.getMax(p2 / 2, Y.width / 2);
    X.insert(n2 - e3, X.getVerticalPos() - 10 + d2, r2 + e3, X.getVerticalPos() + 30 + d2);
  } else d2 += Y.boxMargin, l2 = X.getVerticalPos() + d2, X.insert(n2, l2 - 10, r2, l2);
  return X.bumpVerticalPos(d2), t2.height += d2, t2.stopy = t2.starty + t2.height, X.insert(t2.fromBounds, t2.starty, t2.toBounds, t2.stopy), l2;
}
y(Fe, `boundMessage`);
var Ie = y(async function(e2, t2, r2, i2) {
  let { startx: a2, stopx: s2, starty: c2, message: l2, type: u2, sequenceIndex: d2, sequenceVisible: f2 } = t2, p2 = x.calculateTextDimensions(l2, Z(Y)), h2 = j();
  h2.x = a2, h2.y = c2 + 10, h2.width = s2 - a2, h2.class = `messageText`, h2.dy = `1em`, h2.text = l2, h2.fontFamily = Y.messageFontFamily, h2.fontSize = Y.messageFontSize, h2.fontWeight = Y.messageFontWeight, h2.anchor = Y.messageAlign, h2.valign = `center`, h2.textMargin = Y.wrapPadding, h2.tspan = false, o(h2.text) ? await oe(e2, h2, { startx: a2, stopx: s2, starty: r2 }) : G(e2, h2);
  let g2 = p2.width, _2;
  a2 === s2 ? _2 = Y.rightAngles ? e2.append(`path`).attr(`d`, `M  ${a2},${r2} H ${a2 + m.getMax(Y.width / 2, g2 / 2)} V ${r2 + 25} H ${a2}`) : e2.append(`path`).attr(`d`, `M ` + a2 + `,` + r2 + ` C ` + (a2 + 60) + `,` + (r2 - 10) + ` ` + (a2 + 60) + `,` + (r2 + 30) + ` ` + a2 + `,` + (r2 + 20)) : (_2 = e2.append(`line`), _2.attr(`x1`, a2), _2.attr(`y1`, r2), _2.attr(`x2`, s2), _2.attr(`y2`, r2)), u2 === i2.db.LINETYPE.DOTTED || u2 === i2.db.LINETYPE.DOTTED_CROSS || u2 === i2.db.LINETYPE.DOTTED_POINT || u2 === i2.db.LINETYPE.DOTTED_OPEN || u2 === i2.db.LINETYPE.BIDIRECTIONAL_DOTTED ? (_2.style(`stroke-dasharray`, `3, 3`), _2.attr(`class`, `messageLine1`)) : _2.attr(`class`, `messageLine0`);
  let v2 = ``;
  Y.arrowMarkerAbsolute && (v2 = n(true)), _2.attr(`stroke-width`, 2), _2.attr(`stroke`, `none`), _2.style(`fill`, `none`), (u2 === i2.db.LINETYPE.SOLID || u2 === i2.db.LINETYPE.DOTTED) && _2.attr(`marker-end`, `url(` + v2 + `#arrowhead)`), (u2 === i2.db.LINETYPE.BIDIRECTIONAL_SOLID || u2 === i2.db.LINETYPE.BIDIRECTIONAL_DOTTED) && (_2.attr(`marker-start`, `url(` + v2 + `#arrowhead)`), _2.attr(`marker-end`, `url(` + v2 + `#arrowhead)`)), (u2 === i2.db.LINETYPE.SOLID_POINT || u2 === i2.db.LINETYPE.DOTTED_POINT) && _2.attr(`marker-end`, `url(` + v2 + `#filled-head)`), (u2 === i2.db.LINETYPE.SOLID_CROSS || u2 === i2.db.LINETYPE.DOTTED_CROSS) && _2.attr(`marker-end`, `url(` + v2 + `#crosshead)`), (f2 || Y.showSequenceNumbers) && ((u2 === i2.db.LINETYPE.BIDIRECTIONAL_SOLID || u2 === i2.db.LINETYPE.BIDIRECTIONAL_DOTTED) && (a2 < s2 ? _2.attr(`x1`, a2 + 12) : _2.attr(`x1`, a2 + 6)), e2.append(`line`).attr(`x1`, a2).attr(`y1`, r2).attr(`x2`, a2).attr(`y2`, r2).attr(`stroke-width`, 0).attr(`marker-start`, `url(` + v2 + `#sequencenumber)`), e2.append(`text`).attr(`x`, a2).attr(`y`, r2 + 4).attr(`font-family`, `sans-serif`).attr(`font-size`, `12px`).attr(`text-anchor`, `middle`).attr(`class`, `sequenceNumber`).text(d2));
}, `drawMessage`), Le = y(function(e2, t2, n2, r2, i2, a2, o2) {
  let s2 = 0, c2 = 0, l2, u2 = 0;
  for (let e3 of r2) {
    let r3 = t2.get(e3), a3 = r3.box;
    l2 && l2 != a3 && (o2 || X.models.addBox(l2), c2 += Y.boxMargin + l2.margin), a3 && a3 != l2 && (o2 || (a3.x = s2 + c2, a3.y = i2), c2 += a3.margin), r3.width = r3.width || Y.width, r3.height = m.getMax(r3.height || Y.height, Y.height), r3.margin = r3.margin || Y.actorMargin, u2 = m.getMax(u2, r3.height), n2.get(r3.name) && (c2 += r3.width / 2), r3.x = s2 + c2, r3.starty = X.getVerticalPos(), X.insert(r3.x, i2, r3.x + r3.width, r3.height), s2 += r3.width + c2, r3.box && (r3.box.width = s2 + a3.margin - r3.box.x), c2 = r3.margin, l2 = r3.box, X.models.addActor(r3);
  }
  l2 && !o2 && X.models.addBox(l2), X.bumpVerticalPos(u2);
}, `addActorRenderingData`), Re = y(async function(e2, t2, n2, r2) {
  if (r2) {
    let r3 = 0;
    X.bumpVerticalPos(Y.boxMargin * 2);
    for (let i2 of n2) {
      let n3 = t2.get(i2);
      n3.stopy || (n3.stopy = X.getVerticalPos());
      let a2 = await J.drawActor(e2, n3, Y, true);
      r3 = m.getMax(r3, a2);
    }
    X.bumpVerticalPos(r3 + Y.boxMargin);
  } else for (let r3 of n2) {
    let n3 = t2.get(r3);
    await J.drawActor(e2, n3, Y, false);
  }
}, `drawActors`), ze = y(function(e2, t2, n2, r2) {
  let i2 = 0, a2 = 0;
  for (let o2 of n2) {
    let n3 = t2.get(o2), s2 = Ke(n3), c2 = J.drawPopup(e2, n3, s2, Y, Y.forceMenus, r2);
    c2.height > i2 && (i2 = c2.height), c2.width + n3.x > a2 && (a2 = c2.width + n3.x);
  }
  return { maxHeight: i2, maxWidth: a2 };
}, `drawActorsPopup`), Be = y(function(e2) {
  p(Y, e2), e2.fontFamily && (Y.actorFontFamily = Y.noteFontFamily = Y.messageFontFamily = e2.fontFamily), e2.fontSize && (Y.actorFontSize = Y.noteFontSize = Y.messageFontSize = e2.fontSize), e2.fontWeight && (Y.actorFontWeight = Y.noteFontWeight = Y.messageFontWeight = e2.fontWeight);
}, `setConf`), Ve = y(function(e2) {
  return X.activations.filter(function(t2) {
    return t2.actor === e2;
  });
}, `actorActivations`), He = y(function(e2, t2) {
  let n2 = t2.get(e2), r2 = Ve(e2);
  return [r2.reduce(function(e3, t3) {
    return m.getMin(e3, t3.startx);
  }, n2.x + n2.width / 2 - 1), r2.reduce(function(e3, t3) {
    return m.getMax(e3, t3.stopx);
  }, n2.x + n2.width / 2 + 1)];
}, `activationBounds`);
function $(e2, t2, n2, r2, i2) {
  X.bumpVerticalPos(n2);
  let a2 = r2;
  if (t2.id && t2.message && e2[t2.id]) {
    let n3 = e2[t2.id].width, i3 = Z(Y);
    t2.message = x.wrapLabel(`[${t2.message}]`, n3 - 2 * Y.wrapPadding, i3), t2.width = n3, t2.wrap = true;
    let o2 = x.calculateTextDimensions(t2.message, i3), s2 = m.getMax(o2.height, Y.labelBoxHeight);
    a2 = r2 + s2, v.debug(`${s2} - ${t2.message}`);
  }
  i2(t2), X.bumpVerticalPos(a2);
}
y($, `adjustLoopHeightForWrap`);
function Ue(e2, t2, n2, r2, i2, a2, o2) {
  function s2(n3, r3) {
    n3.x < i2.get(e2.from).x ? (X.insert(t2.stopx - r3, t2.starty, t2.startx, t2.stopy + n3.height / 2 + Y.noteMargin), t2.stopx += r3) : (X.insert(t2.startx, t2.starty, t2.stopx + r3, t2.stopy + n3.height / 2 + Y.noteMargin), t2.stopx -= r3);
  }
  y(s2, `receiverAdjustment`);
  function c2(n3, r3) {
    n3.x < i2.get(e2.to).x ? (X.insert(t2.startx - r3, t2.starty, t2.stopx, t2.stopy + n3.height / 2 + Y.noteMargin), t2.startx += r3) : (X.insert(t2.stopx, t2.starty, t2.startx + r3, t2.stopy + n3.height / 2 + Y.noteMargin), t2.startx -= r3);
  }
  y(c2, `senderAdjustment`);
  let l2 = [z.ACTOR, z.CONTROL, z.ENTITY, z.DATABASE];
  if (a2.get(e2.to) == r2) {
    let t3 = i2.get(e2.to);
    s2(t3, l2.includes(t3.type) ? V / 2 + 3 : t3.width / 2 + 3), t3.starty = n2 - t3.height / 2, X.bumpVerticalPos(t3.height / 2);
  } else if (o2.get(e2.from) == r2) {
    let t3 = i2.get(e2.from);
    Y.mirrorActors && c2(t3, l2.includes(t3.type) ? V / 2 : t3.width / 2), t3.stopy = n2 - t3.height / 2, X.bumpVerticalPos(t3.height / 2);
  } else if (o2.get(e2.to) == r2) {
    let t3 = i2.get(e2.to);
    Y.mirrorActors && s2(t3, l2.includes(t3.type) ? V / 2 + 3 : t3.width / 2 + 3), t3.stopy = n2 - t3.height / 2, X.bumpVerticalPos(t3.height / 2);
  }
}
y(Ue, `adjustCreatedDestroyedData`);
var We = y(async function(e2, t2, n2, r2) {
  let { securityLevel: i2, sequence: a2 } = u();
  Y = a2;
  let o2;
  i2 === `sandbox` && (o2 = b(`#i` + t2));
  let s2 = b(i2 === `sandbox` ? o2.nodes()[0].contentDocument.body : `body`), c2 = i2 === `sandbox` ? o2.nodes()[0].contentDocument : document;
  X.init(), v.debug(r2.db);
  let l2 = i2 === `sandbox` ? s2.select(`[id="${t2}"]`) : b(`[id="${t2}"]`), f2 = r2.db.getActors(), p2 = r2.db.getCreatedActors(), m2 = r2.db.getDestroyedActors(), h2 = r2.db.getBoxes(), g2 = r2.db.getActorKeys(), _2 = r2.db.getMessages(), x2 = r2.db.getDiagramTitle(), S2 = r2.db.hasAtLeastOneBox(), C2 = r2.db.hasAtLeastOneBoxWithTitle(), w2 = await Ge(f2, _2, r2);
  if (Y.height = await qe(f2, w2, h2), J.insertComputerIcon(l2), J.insertDatabaseIcon(l2), J.insertClockIcon(l2), S2 && (X.bumpVerticalPos(Y.boxMargin), C2 && X.bumpVerticalPos(h2[0].textMaxHeight)), Y.hideUnusedParticipants === true) {
    let e3 = /* @__PURE__ */ new Set();
    _2.forEach((t3) => {
      e3.add(t3.from), e3.add(t3.to);
    }), g2 = g2.filter((t3) => e3.has(t3));
  }
  Le(l2, f2, p2, g2, 0, _2, false);
  let T2 = await Xe(_2, f2, w2, r2);
  J.insertArrowHead(l2), J.insertArrowCrossHead(l2), J.insertArrowFilledHead(l2), J.insertSequenceNumber(l2);
  function E2(e3, t3) {
    let n3 = X.endActivation(e3);
    n3.starty + 18 > t3 && (n3.starty = t3 - 6, t3 += 12), J.drawActivation(l2, n3, t3, Y, Ve(e3.from).length), X.insert(n3.startx, t3 - 10, n3.stopx, t3);
  }
  y(E2, `activeEnd`);
  let D2 = 1, O2 = 1, k2 = [], A2 = [], j2 = 0;
  for (let e3 of _2) {
    let t3, n3, i3;
    switch (e3.type) {
      case r2.db.LINETYPE.NOTE:
        X.resetVerticalPos(), n3 = e3.noteModel, await Ne(l2, n3);
        break;
      case r2.db.LINETYPE.ACTIVE_START:
        X.newActivation(e3, l2, f2);
        break;
      case r2.db.LINETYPE.ACTIVE_END:
        E2(e3, X.getVerticalPos());
        break;
      case r2.db.LINETYPE.LOOP_START:
        $(T2, e3, Y.boxMargin, Y.boxMargin + Y.boxTextMargin, (e4) => X.newLoop(e4));
        break;
      case r2.db.LINETYPE.LOOP_END:
        t3 = X.endLoop(), await J.drawLoop(l2, t3, `loop`, Y), X.bumpVerticalPos(t3.stopy - X.getVerticalPos()), X.models.addLoop(t3);
        break;
      case r2.db.LINETYPE.RECT_START:
        $(T2, e3, Y.boxMargin, Y.boxMargin, (e4) => X.newLoop(void 0, e4.message));
        break;
      case r2.db.LINETYPE.RECT_END:
        t3 = X.endLoop(), A2.push(t3), X.models.addLoop(t3), X.bumpVerticalPos(t3.stopy - X.getVerticalPos());
        break;
      case r2.db.LINETYPE.OPT_START:
        $(T2, e3, Y.boxMargin, Y.boxMargin + Y.boxTextMargin, (e4) => X.newLoop(e4));
        break;
      case r2.db.LINETYPE.OPT_END:
        t3 = X.endLoop(), await J.drawLoop(l2, t3, `opt`, Y), X.bumpVerticalPos(t3.stopy - X.getVerticalPos()), X.models.addLoop(t3);
        break;
      case r2.db.LINETYPE.ALT_START:
        $(T2, e3, Y.boxMargin, Y.boxMargin + Y.boxTextMargin, (e4) => X.newLoop(e4));
        break;
      case r2.db.LINETYPE.ALT_ELSE:
        $(T2, e3, Y.boxMargin + Y.boxTextMargin, Y.boxMargin, (e4) => X.addSectionToLoop(e4));
        break;
      case r2.db.LINETYPE.ALT_END:
        t3 = X.endLoop(), await J.drawLoop(l2, t3, `alt`, Y), X.bumpVerticalPos(t3.stopy - X.getVerticalPos()), X.models.addLoop(t3);
        break;
      case r2.db.LINETYPE.PAR_START:
      case r2.db.LINETYPE.PAR_OVER_START:
        $(T2, e3, Y.boxMargin, Y.boxMargin + Y.boxTextMargin, (e4) => X.newLoop(e4)), X.saveVerticalPos();
        break;
      case r2.db.LINETYPE.PAR_AND:
        $(T2, e3, Y.boxMargin + Y.boxTextMargin, Y.boxMargin, (e4) => X.addSectionToLoop(e4));
        break;
      case r2.db.LINETYPE.PAR_END:
        t3 = X.endLoop(), await J.drawLoop(l2, t3, `par`, Y), X.bumpVerticalPos(t3.stopy - X.getVerticalPos()), X.models.addLoop(t3);
        break;
      case r2.db.LINETYPE.AUTONUMBER:
        D2 = e3.message.start || D2, O2 = e3.message.step || O2, e3.message.visible ? r2.db.enableSequenceNumbers() : r2.db.disableSequenceNumbers();
        break;
      case r2.db.LINETYPE.CRITICAL_START:
        $(T2, e3, Y.boxMargin, Y.boxMargin + Y.boxTextMargin, (e4) => X.newLoop(e4));
        break;
      case r2.db.LINETYPE.CRITICAL_OPTION:
        $(T2, e3, Y.boxMargin + Y.boxTextMargin, Y.boxMargin, (e4) => X.addSectionToLoop(e4));
        break;
      case r2.db.LINETYPE.CRITICAL_END:
        t3 = X.endLoop(), await J.drawLoop(l2, t3, `critical`, Y), X.bumpVerticalPos(t3.stopy - X.getVerticalPos()), X.models.addLoop(t3);
        break;
      case r2.db.LINETYPE.BREAK_START:
        $(T2, e3, Y.boxMargin, Y.boxMargin + Y.boxTextMargin, (e4) => X.newLoop(e4));
        break;
      case r2.db.LINETYPE.BREAK_END:
        t3 = X.endLoop(), await J.drawLoop(l2, t3, `break`, Y), X.bumpVerticalPos(t3.stopy - X.getVerticalPos()), X.models.addLoop(t3);
        break;
      default:
        try {
          i3 = e3.msgModel, i3.starty = X.getVerticalPos(), i3.sequenceIndex = D2, i3.sequenceVisible = r2.db.showSequenceNumbers();
          let t4 = await Fe(l2, i3);
          Ue(e3, i3, t4, j2, f2, p2, m2), k2.push({ messageModel: i3, lineStartY: t4 }), X.models.addMessage(i3);
        } catch (e4) {
          v.error(`error while drawing message`, e4);
        }
    }
    [r2.db.LINETYPE.SOLID_OPEN, r2.db.LINETYPE.DOTTED_OPEN, r2.db.LINETYPE.SOLID, r2.db.LINETYPE.DOTTED, r2.db.LINETYPE.SOLID_CROSS, r2.db.LINETYPE.DOTTED_CROSS, r2.db.LINETYPE.SOLID_POINT, r2.db.LINETYPE.DOTTED_POINT, r2.db.LINETYPE.BIDIRECTIONAL_SOLID, r2.db.LINETYPE.BIDIRECTIONAL_DOTTED].includes(e3.type) && (D2 += O2), j2++;
  }
  v.debug(`createdActors`, p2), v.debug(`destroyedActors`, m2), await Re(l2, f2, g2, false);
  for (let e3 of k2) await Ie(l2, e3.messageModel, e3.lineStartY, r2);
  Y.mirrorActors && await Re(l2, f2, g2, true), A2.forEach((e3) => J.drawBackgroundRect(l2, e3)), ce(l2, f2, g2, Y);
  for (let e3 of X.models.boxes) {
    e3.height = X.getVerticalPos() - e3.y, X.insert(e3.x, e3.y, e3.x + e3.width, e3.height);
    let t3 = Y.boxMargin * 2;
    e3.startx = e3.x - t3, e3.starty = e3.y - t3 * 0.25, e3.stopx = e3.startx + e3.width + 2 * t3, e3.stopy = e3.starty + e3.height + t3 * 0.75, e3.stroke = `rgb(0,0,0, 0.5)`, J.drawBox(l2, e3, Y);
  }
  S2 && X.bumpVerticalPos(Y.boxMargin);
  let M2 = ze(l2, f2, g2, c2), { bounds: N2 } = X.getBounds();
  N2.startx === void 0 && (N2.startx = 0), N2.starty === void 0 && (N2.starty = 0), N2.stopx === void 0 && (N2.stopx = 0), N2.stopy === void 0 && (N2.stopy = 0);
  let P2 = N2.stopy - N2.starty;
  P2 < M2.maxHeight && (P2 = M2.maxHeight);
  let F2 = P2 + 2 * Y.diagramMarginY;
  Y.mirrorActors && (F2 = F2 - Y.boxMargin + Y.bottomMarginAdj);
  let I2 = N2.stopx - N2.startx;
  I2 < M2.maxWidth && (I2 = M2.maxWidth);
  let L2 = I2 + 2 * Y.diagramMarginX;
  x2 && l2.append(`text`).text(x2).attr(`x`, (N2.stopx - N2.startx) / 2 - 2 * Y.diagramMarginX).attr(`y`, -25), d(l2, F2, L2, Y.useMaxWidth);
  let R2 = x2 ? 40 : 0;
  l2.attr(`viewBox`, N2.startx - Y.diagramMarginX + ` -` + (Y.diagramMarginY + R2) + ` ` + L2 + ` ` + (F2 + R2)), v.debug(`models:`, X.models);
}, `draw`);
async function Ge(e2, t2, n2) {
  let r2 = {};
  for (let i2 of t2) if (e2.get(i2.to) && e2.get(i2.from)) {
    let t3 = e2.get(i2.to);
    if (i2.placement === n2.db.PLACEMENT.LEFTOF && !t3.prevActor || i2.placement === n2.db.PLACEMENT.RIGHTOF && !t3.nextActor) continue;
    let a2 = i2.placement !== void 0, s2 = !a2, c2 = a2 ? Q(Y) : Z(Y), l2 = i2.wrap ? x.wrapLabel(i2.message, Y.width - 2 * Y.wrapPadding, c2) : i2.message, d2 = (o(l2) ? await f(i2.message, u()) : x.calculateTextDimensions(l2, c2)).width + 2 * Y.wrapPadding;
    s2 && i2.from === t3.nextActor ? r2[i2.to] = m.getMax(r2[i2.to] || 0, d2) : s2 && i2.from === t3.prevActor ? r2[i2.from] = m.getMax(r2[i2.from] || 0, d2) : s2 && i2.from === i2.to ? (r2[i2.from] = m.getMax(r2[i2.from] || 0, d2 / 2), r2[i2.to] = m.getMax(r2[i2.to] || 0, d2 / 2)) : i2.placement === n2.db.PLACEMENT.RIGHTOF ? r2[i2.from] = m.getMax(r2[i2.from] || 0, d2) : i2.placement === n2.db.PLACEMENT.LEFTOF ? r2[t3.prevActor] = m.getMax(r2[t3.prevActor] || 0, d2) : i2.placement === n2.db.PLACEMENT.OVER && (t3.prevActor && (r2[t3.prevActor] = m.getMax(r2[t3.prevActor] || 0, d2 / 2)), t3.nextActor && (r2[i2.from] = m.getMax(r2[i2.from] || 0, d2 / 2)));
  }
  return v.debug(`maxMessageWidthPerActor:`, r2), r2;
}
y(Ge, `getMaxMessageWidthPerActor`);
var Ke = y(function(e2) {
  let t2 = 0, n2 = Pe(Y);
  for (let r2 in e2.links) {
    let e3 = x.calculateTextDimensions(r2, n2).width + 2 * Y.wrapPadding + 2 * Y.boxMargin;
    t2 < e3 && (t2 = e3);
  }
  return t2;
}, `getRequiredPopupWidth`);
async function qe(e2, t2, n2) {
  let r2 = 0;
  for (let t3 of e2.keys()) {
    let n3 = e2.get(t3);
    n3.wrap && (n3.description = x.wrapLabel(n3.description, Y.width - 2 * Y.wrapPadding, Pe(Y)));
    let i3 = o(n3.description) ? await f(n3.description, u()) : x.calculateTextDimensions(n3.description, Pe(Y));
    n3.width = n3.wrap ? Y.width : m.getMax(Y.width, i3.width + 2 * Y.wrapPadding), n3.height = n3.wrap ? m.getMax(i3.height, Y.height) : Y.height, r2 = m.getMax(r2, n3.height);
  }
  for (let n3 in t2) {
    let r3 = e2.get(n3);
    if (!r3) continue;
    let i3 = e2.get(r3.nextActor);
    if (!i3) {
      let e3 = t2[n3] + Y.actorMargin - r3.width / 2;
      r3.margin = m.getMax(e3, Y.actorMargin);
      continue;
    }
    let a2 = t2[n3] + Y.actorMargin - r3.width / 2 - i3.width / 2;
    r3.margin = m.getMax(a2, Y.actorMargin);
  }
  let i2 = 0;
  return n2.forEach((t3) => {
    let n3 = Z(Y), r3 = t3.actorKeys.reduce((t4, n4) => t4 += e2.get(n4).width + (e2.get(n4).margin || 0), 0), a2 = Y.boxMargin * 8;
    r3 += a2, r3 -= 2 * Y.boxTextMargin, t3.wrap && (t3.name = x.wrapLabel(t3.name, r3 - 2 * Y.wrapPadding, n3));
    let o2 = x.calculateTextDimensions(t3.name, n3);
    i2 = m.getMax(o2.height, i2);
    let s2 = m.getMax(r3, o2.width + 2 * Y.wrapPadding);
    if (t3.margin = Y.boxTextMargin, r3 < s2) {
      let e3 = (s2 - r3) / 2;
      t3.margin += e3;
    }
  }), n2.forEach((e3) => e3.textMaxHeight = i2), m.getMax(r2, Y.height);
}
y(qe, `calculateActorMargins`);
var Je = y(async function(e2, t2, n2) {
  let r2 = t2.get(e2.from), i2 = t2.get(e2.to), a2 = r2.x, s2 = i2.x, c2 = e2.wrap && e2.message, l2 = o(e2.message) ? await f(e2.message, u()) : x.calculateTextDimensions(c2 ? x.wrapLabel(e2.message, Y.width, Q(Y)) : e2.message, Q(Y)), d2 = { width: c2 ? Y.width : m.getMax(Y.width, l2.width + 2 * Y.noteMargin), height: 0, startx: r2.x, stopx: 0, starty: 0, stopy: 0, message: e2.message };
  return e2.placement === n2.db.PLACEMENT.RIGHTOF ? (d2.width = c2 ? m.getMax(Y.width, l2.width) : m.getMax(r2.width / 2 + i2.width / 2, l2.width + 2 * Y.noteMargin), d2.startx = a2 + (r2.width + Y.actorMargin) / 2) : e2.placement === n2.db.PLACEMENT.LEFTOF ? (d2.width = c2 ? m.getMax(Y.width, l2.width + 2 * Y.noteMargin) : m.getMax(r2.width / 2 + i2.width / 2, l2.width + 2 * Y.noteMargin), d2.startx = a2 - d2.width + (r2.width - Y.actorMargin) / 2) : e2.to === e2.from ? (l2 = x.calculateTextDimensions(c2 ? x.wrapLabel(e2.message, m.getMax(Y.width, r2.width), Q(Y)) : e2.message, Q(Y)), d2.width = c2 ? m.getMax(Y.width, r2.width) : m.getMax(r2.width, Y.width, l2.width + 2 * Y.noteMargin), d2.startx = a2 + (r2.width - d2.width) / 2) : (d2.width = Math.abs(a2 + r2.width / 2 - (s2 + i2.width / 2)) + Y.actorMargin, d2.startx = a2 < s2 ? a2 + r2.width / 2 - Y.actorMargin / 2 : s2 + i2.width / 2 - Y.actorMargin / 2), c2 && (d2.message = x.wrapLabel(e2.message, d2.width - 2 * Y.wrapPadding, Q(Y))), v.debug(`NM:[${d2.startx},${d2.stopx},${d2.starty},${d2.stopy}:${d2.width},${d2.height}=${e2.message}]`), d2;
}, `buildNoteModel`), Ye = y(function(e2, t2, n2) {
  if (![n2.db.LINETYPE.SOLID_OPEN, n2.db.LINETYPE.DOTTED_OPEN, n2.db.LINETYPE.SOLID, n2.db.LINETYPE.DOTTED, n2.db.LINETYPE.SOLID_CROSS, n2.db.LINETYPE.DOTTED_CROSS, n2.db.LINETYPE.SOLID_POINT, n2.db.LINETYPE.DOTTED_POINT, n2.db.LINETYPE.BIDIRECTIONAL_SOLID, n2.db.LINETYPE.BIDIRECTIONAL_DOTTED].includes(e2.type)) return {};
  let [r2, i2] = He(e2.from, t2), [a2, o2] = He(e2.to, t2), s2 = r2 <= a2, c2 = s2 ? i2 : r2, l2 = s2 ? a2 : o2, u2 = Math.abs(a2 - o2) > 2, d2 = y((e3) => s2 ? -e3 : e3, `adjustValue`);
  e2.from === e2.to ? l2 = c2 : (e2.activate && !u2 && (l2 += d2(Y.activationWidth / 2 - 1)), [n2.db.LINETYPE.SOLID_OPEN, n2.db.LINETYPE.DOTTED_OPEN].includes(e2.type) || (l2 += d2(3)), [n2.db.LINETYPE.BIDIRECTIONAL_SOLID, n2.db.LINETYPE.BIDIRECTIONAL_DOTTED].includes(e2.type) && (c2 -= d2(3)));
  let f2 = [r2, i2, a2, o2], p2 = Math.abs(c2 - l2);
  e2.wrap && e2.message && (e2.message = x.wrapLabel(e2.message, m.getMax(p2 + 2 * Y.wrapPadding, Y.width), Z(Y)));
  let h2 = x.calculateTextDimensions(e2.message, Z(Y));
  return { width: m.getMax(e2.wrap ? 0 : h2.width + 2 * Y.wrapPadding, p2 + 2 * Y.wrapPadding, Y.width), height: 0, startx: c2, stopx: l2, starty: 0, stopy: 0, message: e2.message, type: e2.type, wrap: e2.wrap, fromBounds: Math.min.apply(null, f2), toBounds: Math.max.apply(null, f2) };
}, `buildMessageModel`), Xe = y(async function(e2, t2, n2, r2) {
  let i2 = {}, a2 = [], o2, s2, c2;
  for (let n3 of e2) {
    switch (n3.type) {
      case r2.db.LINETYPE.LOOP_START:
      case r2.db.LINETYPE.ALT_START:
      case r2.db.LINETYPE.OPT_START:
      case r2.db.LINETYPE.PAR_START:
      case r2.db.LINETYPE.PAR_OVER_START:
      case r2.db.LINETYPE.CRITICAL_START:
      case r2.db.LINETYPE.BREAK_START:
        a2.push({ id: n3.id, msg: n3.message, from: 2 ** 53 - 1, to: -(2 ** 53 - 1), width: 0 });
        break;
      case r2.db.LINETYPE.ALT_ELSE:
      case r2.db.LINETYPE.PAR_AND:
      case r2.db.LINETYPE.CRITICAL_OPTION:
        n3.message && (o2 = a2.pop(), i2[o2.id] = o2, i2[n3.id] = o2, a2.push(o2));
        break;
      case r2.db.LINETYPE.LOOP_END:
      case r2.db.LINETYPE.ALT_END:
      case r2.db.LINETYPE.OPT_END:
      case r2.db.LINETYPE.PAR_END:
      case r2.db.LINETYPE.CRITICAL_END:
      case r2.db.LINETYPE.BREAK_END:
        o2 = a2.pop(), i2[o2.id] = o2;
        break;
      case r2.db.LINETYPE.ACTIVE_START:
        {
          let e3 = t2.get(n3.from ? n3.from : n3.to.actor), r3 = Ve(n3.from ? n3.from : n3.to.actor).length, i3 = e3.x + e3.width / 2 + (r3 - 1) * Y.activationWidth / 2, a3 = { startx: i3, stopx: i3 + Y.activationWidth, actor: n3.from, enabled: true };
          X.activations.push(a3);
        }
        break;
      case r2.db.LINETYPE.ACTIVE_END:
        {
          let e3 = X.activations.map((e4) => e4.actor).lastIndexOf(n3.from);
          X.activations.splice(e3, 1).splice(0, 1);
        }
        break;
    }
    n3.placement === void 0 ? (c2 = Ye(n3, t2, r2), n3.msgModel = c2, c2.startx && c2.stopx && a2.length > 0 && a2.forEach((e3) => {
      if (o2 = e3, c2.startx === c2.stopx) {
        let e4 = t2.get(n3.from), r3 = t2.get(n3.to);
        o2.from = m.getMin(e4.x - c2.width / 2, e4.x - e4.width / 2, o2.from), o2.to = m.getMax(r3.x + c2.width / 2, r3.x + e4.width / 2, o2.to), o2.width = m.getMax(o2.width, Math.abs(o2.to - o2.from)) - Y.labelBoxWidth;
      } else o2.from = m.getMin(c2.startx, o2.from), o2.to = m.getMax(c2.stopx, o2.to), o2.width = m.getMax(o2.width, c2.width) - Y.labelBoxWidth;
    })) : (s2 = await Je(n3, t2, r2), n3.noteModel = s2, a2.forEach((e3) => {
      o2 = e3, o2.from = m.getMin(o2.from, s2.startx), o2.to = m.getMax(o2.to, s2.startx + s2.width), o2.width = m.getMax(o2.width, Math.abs(o2.from - o2.to)) - Y.labelBoxWidth;
    }));
  }
  return X.activations = [], v.debug(`Loop type widths:`, i2), i2;
}, `calculateLoopBounds`), Ze = { parser: I, get db() {
  return new te();
}, renderer: { bounds: X, drawActors: Re, drawActorsPopup: ze, setConf: Be, draw: We }, styles: B, init: y((e2) => {
  e2.sequence || (e2.sequence = {}), e2.wrap && (e2.sequence.wrap = e2.wrap, r({ sequence: { wrap: e2.wrap } }));
}, `init`) };
export {
  Ze as diagram
};
